<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Merge.Mergeblob3</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier">Mergeblob3</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeMergeblob3"><span class="hs-identifier">makeMergeblob3</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapped</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Align</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">align</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifoldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bifoldMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NESet</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set.NonEmpty</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.These</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">These</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decl</span></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DataDeclaration</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DeclNameLookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DeclNameLookup</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">expectConstructorNames</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DeclNameLookup</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DeclNameLookup</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html"><span class="hs-identifier">Unison.Merge.Mergeblob2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier">Mergeblob2</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.PartialDeclNameLookup.html"><span class="hs-identifier">Unison.Merge.PartialDeclNameLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.PartialDeclNameLookup.html#PartialDeclNameLookup"><span class="hs-identifier">PartialDeclNameLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html"><span class="hs-identifier">Unison.Merge.ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier">ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html"><span class="hs-identifier">Unison.Merge.ThreeWay</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ThreeWay</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html"><span class="hs-identifier">Unison.Merge.TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier">TwoWay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html"><span class="hs-identifier">Unison.Merge.TwoWay</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TwoWay</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html"><span class="hs-identifier">Unison.Merge.Unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier">Unconflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html"><span class="hs-identifier">Unison.Merge.Unconflicts</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Unconflicts</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrettyPrintEnvDecl</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.FilePrinter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">renderDefnsForUnisonFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Name</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Defns</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defnsAreEmpty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith3</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">zipDefnsWith4</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ColorText</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Pretty</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Relation</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="Mergeblob3"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier hs-var">Mergeblob3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Mergeblob3"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier hs-var">Mergeblob3</span></a></span></span><span>
</span><span id="line-55"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Alibdeps%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; Names
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3Alibdeps%3AMergeblob3"><span class="hs-identifier hs-var hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span id="%24sel%3AstageOne%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; DefnsF (Map Name) Referent TypeReference
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AstageOne%3AMergeblob3"><span class="hs-identifier hs-var hs-var">stageOne</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span id="%24sel%3AstageTwo%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; DefnsF (Map Name) Referent TypeReference
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AstageTwo%3AMergeblob3"><span class="hs-identifier hs-var hs-var">stageTwo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span id="%24sel%3AuniqueTypeGuids%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; Map Name Text
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AuniqueTypeGuids%3AMergeblob3"><span class="hs-identifier hs-var hs-var">uniqueTypeGuids</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-comment">-- `unparsedFile` (no mergetool) xor `unparsedSoloFiles` (yes mergetool) are ultimately given to the user</span><span>
</span><span id="line-60"></span><span>    </span><span id="%24sel%3AunparsedFile%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AunparsedFile%3AMergeblob3"><span class="hs-identifier hs-var hs-var">unparsedFile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span id="%24sel%3AunparsedSoloFiles%3AMergeblob3"><span class="annot"><span class="annottext">Mergeblob3 -&gt; ThreeWay (Pretty ColorText)
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AunparsedSoloFiles%3AMergeblob3"><span class="hs-identifier hs-var hs-var">unparsedSoloFiles</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span id="local-6989586621679197481"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeMergeblob3"><span class="hs-identifier hs-type">makeMergeblob3</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Unison.Merge.Mergeblob2.html#Mergeblob2"><span class="hs-identifier hs-type">Mergeblob2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197481"><span class="hs-identifier hs-type">libdep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier hs-type">Mergeblob3</span></a></span></span><span>
</span><span id="line-71"></span><span id="makeMergeblob3"><span class="annot"><span class="annottext">makeMergeblob3 :: forall libdep.
Mergeblob2 libdep
-&gt; TwoWay (DefnsF Set TermReferenceId TermReferenceId)
-&gt; Names
-&gt; Names
-&gt; TwoWay Text
-&gt; Mergeblob3
</span><a href="Unison.Merge.Mergeblob3.html#makeMergeblob3"><span class="hs-identifier hs-var hs-var">makeMergeblob3</span></a></span></span><span> </span><span id="local-6989586621679197967"><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span></span><span> </span><span id="local-6989586621679197968"><span class="annot"><span class="annottext">TwoWay (DefnsF Set TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679197968"><span class="hs-identifier hs-var">dependents0</span></a></span></span><span> </span><span id="local-6989586621679197969"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679197969"><span class="hs-identifier hs-var">libdeps</span></a></span></span><span> </span><span id="local-6989586621679197970"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679197970"><span class="hs-identifier hs-var">lcaLibdeps</span></a></span></span><span> </span><span id="local-6989586621679197971"><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679197971"><span class="hs-identifier hs-var">authors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679197972"><span class="hs-identifier hs-type">conflictsNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>      </span><span id="local-6989586621679197972"><span class="annot"><span class="annottext">conflictsNames :: TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197972"><span class="hs-identifier hs-var hs-var">conflictsNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="annottext">(Map Name TermReferenceId -&gt; Set Name)
-&gt; (Map Name TermReferenceId -&gt; Set Name)
-&gt; Defns (Map Name TermReferenceId) (Map Name TermReferenceId)
-&gt; Defns (Set Name) (Set Name)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Map Name TermReferenceId -&gt; Set Name
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map Name TermReferenceId -&gt; Set Name
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">(Defns (Map Name TermReferenceId) (Map Name TermReferenceId)
 -&gt; Defns (Set Name) (Set Name))
-&gt; TwoWay
     (Defns (Map Name TermReferenceId) (Map Name TermReferenceId))
-&gt; TwoWay (Defns (Set Name) (Set Name))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">conflicts</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>      </span><span class="hs-comment">-- Identify the unconflicted dependents we need to pull into the Unison file (either first for typechecking, if</span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-comment">-- there aren't conflicts, or else for manual conflict resolution without a typechecking step, if there are)</span><span>
</span><span id="line-78"></span><span>      </span><span class="annot"><a href="#local-6989586621679197976"><span class="hs-identifier hs-type">dependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>      </span><span id="local-6989586621679197976"><span class="annot"><span class="annottext">dependents :: TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197976"><span class="hs-identifier hs-var hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay (Defns (Set Name) (Set Name))
forall name.
Ord name =&gt;
TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
</span><a href="Unison.Merge.Mergeblob3.html#filterDependents"><span class="hs-identifier hs-var">filterDependents</span></a></span><span>
</span><span id="line-81"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197972"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-82"></span><span>          </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">soloUpdatesAndDeletes</span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679197978"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-84"></span><span>                </span><span id="local-6989586621679197978"><span class="annot"><span class="annottext">f :: Set TermReferenceId -&gt; Referent -&gt; NESet Name -&gt; Set Name
</span><a href="#local-6989586621679197978"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679197979"><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679197979"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621679197980"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679197980"><span class="hs-identifier hs-var">defn0</span></a></span></span><span> </span><span id="local-6989586621679197981"><span class="annot"><span class="annottext">NESet Name
</span><a href="#local-6989586621679197981"><span class="hs-identifier hs-var">names</span></a></span></span><span>
</span><span id="line-85"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679197982"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197982"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Maybe TermReferenceId
</span><span class="hs-identifier hs-var">Referent.toTermReferenceId</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679197980"><span class="hs-identifier hs-var">defn0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>                    </span><span class="annot"><span class="annottext">TermReferenceId -&gt; Set TermReferenceId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197982"><span class="hs-identifier hs-var">defn</span></a></span><span> </span><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679197979"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>                      </span><span class="annot"><span class="annottext">NESet Name -&gt; Set Name
forall a. NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.NonEmpty.toSet</span></span><span> </span><span class="annot"><span class="annottext">NESet Name
</span><a href="#local-6989586621679197981"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-88"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-89"></span><span>                </span><span class="annot"><a href="#local-6989586621679197987"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-90"></span><span>                </span><span id="local-6989586621679197987"><span class="annot"><span class="annottext">g :: Set TermReferenceId -&gt; TypeReference -&gt; NESet Name -&gt; Set Name
</span><a href="#local-6989586621679197987"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679197988"><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679197988"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621679197989"><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679197989"><span class="hs-identifier hs-var">defn0</span></a></span></span><span> </span><span id="local-6989586621679197990"><span class="annot"><span class="annottext">NESet Name
</span><a href="#local-6989586621679197990"><span class="hs-identifier hs-var">names</span></a></span></span><span>
</span><span id="line-91"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReferenceDerived</span></span><span> </span><span id="local-6989586621679197992"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197992"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeReference
</span><a href="#local-6989586621679197989"><span class="hs-identifier hs-var">defn0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>                    </span><span class="annot"><span class="annottext">TermReferenceId -&gt; Set TermReferenceId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197992"><span class="hs-identifier hs-var">defn</span></a></span><span> </span><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679197988"><span class="hs-identifier hs-var">deps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>                      </span><span class="annot"><span class="annottext">NESet Name -&gt; Set Name
forall a. NESet a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.NonEmpty.toSet</span></span><span> </span><span class="annot"><span class="annottext">NESet Name
</span><a href="#local-6989586621679197990"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-94"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-95"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(BiMultimap Referent Name -&gt; Set TermReferenceId -&gt; Set Name)
-&gt; (BiMultimap TypeReference Name
    -&gt; Set TermReferenceId -&gt; Set Name)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; DefnsF Set TermReferenceId TermReferenceId
-&gt; Defns (Set Name) (Set Name)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span>
</span><span id="line-96"></span><span>                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679197993"><span class="annot"><span class="annottext">BiMultimap Referent Name
</span><a href="#local-6989586621679197993"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621679197994"><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679197994"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; NESet Name -&gt; Set Name)
-&gt; Map Referent (NESet Name) -&gt; Set Name
forall m k a. Monoid m =&gt; (k -&gt; a -&gt; m) -&gt; Map k a -&gt; m
</span><span class="hs-identifier hs-var">Map.foldMapWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set TermReferenceId -&gt; Referent -&gt; NESet Name -&gt; Set Name
</span><a href="#local-6989586621679197978"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679197994"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Map Referent (NESet Name)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><span class="hs-identifier hs-var">BiMultimap.domain</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent Name
</span><a href="#local-6989586621679197993"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679197997"><span class="annot"><span class="annottext">BiMultimap TypeReference Name
</span><a href="#local-6989586621679197997"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621679197998"><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679197998"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TypeReference -&gt; NESet Name -&gt; Set Name)
-&gt; Map TypeReference (NESet Name) -&gt; Set Name
forall m k a. Monoid m =&gt; (k -&gt; a -&gt; m) -&gt; Map k a -&gt; m
</span><span class="hs-identifier hs-var">Map.foldMapWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set TermReferenceId -&gt; TypeReference -&gt; NESet Name -&gt; Set Name
</span><a href="#local-6989586621679197987"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Set TermReferenceId
</span><a href="#local-6989586621679197998"><span class="hs-identifier hs-var">deps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap TypeReference Name -&gt; Map TypeReference (NESet Name)
forall a b. BiMultimap a b -&gt; Map a (NESet b)
</span><span class="hs-identifier hs-var">BiMultimap.domain</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap TypeReference Name
</span><a href="#local-6989586621679197997"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>                  </span><span class="annot"><span class="annottext">(Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
 -&gt; DefnsF Set TermReferenceId TermReferenceId
 -&gt; Defns (Set Name) (Set Name))
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay
     (DefnsF Set TermReferenceId TermReferenceId
      -&gt; Defns (Set Name) (Set Name))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span>
</span><span id="line-99"></span><span>                  </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF Set TermReferenceId TermReferenceId
   -&gt; Defns (Set Name) (Set Name))
-&gt; TwoWay (DefnsF Set TermReferenceId TermReferenceId)
-&gt; TwoWay (Defns (Set Name) (Set Name))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF Set TermReferenceId TermReferenceId)
</span><a href="#local-6989586621679197968"><span class="hs-identifier hs-var">dependents0</span></a></span><span>
</span><span id="line-100"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><a href="#local-6989586621679198000"><span class="hs-identifier hs-type">ppe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span>
</span><span id="line-103"></span><span>      </span><span id="local-6989586621679198000"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679198000"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><span class="annottext">ThreeWay Names -&gt; Names -&gt; Names -&gt; PrettyPrintEnvDecl
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyPrintEnv"><span class="hs-identifier hs-var">makePrettyPrintEnv</span></a></span><span>
</span><span id="line-105"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; Names
</span><a href="Unison.Merge.Mergeblob3.html#defnsToNames"><span class="hs-identifier hs-var">defnsToNames</span></a></span><span> </span><span class="annot"><span class="annottext">(Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
 -&gt; Names)
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; ThreeWay Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>          </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679197969"><span class="hs-identifier hs-var">libdeps</span></a></span><span>
</span><span id="line-107"></span><span>          </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679197970"><span class="hs-identifier hs-var">lcaLibdeps</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><a href="#local-6989586621679198003"><span class="hs-identifier hs-type">renderedConflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><a href="#local-6989586621679198004"><span class="hs-identifier hs-type">renderedDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679198003"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198003"><span class="hs-identifier hs-var">renderedConflicts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679198004"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198004"><span class="hs-identifier hs-var">renderedDependents</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; PrettyPrintEnvDecl
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
    TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
</span><a href="Unison.Merge.Mergeblob3.html#renderConflictsAndDependents"><span class="hs-identifier hs-var">renderConflictsAndDependents</span></a></span><span>
</span><span id="line-113"></span><span>          </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">declNameLookups</span><span>
</span><span id="line-114"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">hydratedDefns</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197972"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-116"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197976"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-117"></span><span>          </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679198000"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>      </span><span class="annot"><a href="#local-6989586621679198006"><span class="hs-identifier hs-type">renderedLcaConflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>      </span><span id="local-6989586621679198006"><span class="annot"><span class="annottext">renderedLcaConflicts :: DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198006"><span class="hs-identifier hs-var hs-var">renderedLcaConflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="annottext">PartialDeclNameLookup
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; PrettyPrintEnvDecl
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="Unison.Merge.Mergeblob3.html#renderLcaConflicts"><span class="hs-identifier hs-var">renderLcaConflicts</span></a></span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lcaDeclNameLookup</span><span>
</span><span id="line-123"></span><span>          </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">hydratedDefns</span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span>
</span><span id="line-124"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197972"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-125"></span><span>          </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679198000"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-126"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#Mergeblob3"><span class="hs-identifier hs-type">Mergeblob3</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Names
$sel:libdeps:Mergeblob3 :: Names
libdeps :: Names
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3Alibdeps%3AMergeblob3"><span class="hs-identifier hs-var hs-var">libdeps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>          </span><span class="annot"><span class="annottext">$sel:stageOne:Mergeblob3 :: DefnsF (Map Name) Referent TypeReference
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AstageOne%3AMergeblob3"><span class="hs-identifier hs-var">stageOne</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>            </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF Unconflicts Referent TypeReference
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF (Map Name) Referent TypeReference
-&gt; DefnsF (Map Name) Referent TypeReference
forall term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOne"><span class="hs-identifier hs-var">makeStageOne</span></a></span><span>
</span><span id="line-130"></span><span>              </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">declNameLookups</span><span>
</span><span id="line-131"></span><span>              </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197972"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-132"></span><span>              </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">unconflicts</span><span>
</span><span id="line-133"></span><span>              </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197976"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-134"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BiMultimap Referent Name -&gt; Map Name Referent)
-&gt; (BiMultimap TypeReference Name -&gt; Map Name TypeReference)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; DefnsF (Map Name) Referent TypeReference
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Map Name Referent
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap TypeReference Name -&gt; Map Name TypeReference
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>          </span><span class="annot"><span class="annottext">$sel:uniqueTypeGuids:Mergeblob3 :: Map Name Text
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AuniqueTypeGuids%3AMergeblob3"><span class="hs-identifier hs-var">uniqueTypeGuids</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
-&gt; Map Name Text
</span><a href="Unison.Merge.Mergeblob3.html#makeUniqueTypeGuids"><span class="hs-identifier hs-var">makeUniqueTypeGuids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">hydratedDefns</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>          </span><span class="annot"><span class="annottext">$sel:stageTwo:Mergeblob3 :: DefnsF (Map Name) Referent TypeReference
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AstageTwo%3AMergeblob3"><span class="hs-identifier hs-var">stageTwo</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>            </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF Unconflicts Referent TypeReference
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; ThreeWay (DefnsF (Map Name) Referent TypeReference)
-&gt; DefnsF (Map Name) Referent TypeReference
forall term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; ThreeWay (DefnsF (Map Name) term typ)
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwo"><span class="hs-identifier hs-var">makeStageTwo</span></a></span><span>
</span><span id="line-138"></span><span>              </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">declNameLookups</span><span>
</span><span id="line-139"></span><span>              </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197972"><span class="hs-identifier hs-var">conflictsNames</span></a></span><span>
</span><span id="line-140"></span><span>              </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">unconflicts</span><span>
</span><span id="line-141"></span><span>              </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679197976"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-142"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(BiMultimap Referent Name -&gt; Map Name Referent)
-&gt; (BiMultimap TypeReference Name -&gt; Map Name TypeReference)
-&gt; Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; DefnsF (Map Name) Referent TypeReference
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Map Name Referent
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">BiMultimap TypeReference Name -&gt; Map Name TypeReference
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">(Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
 -&gt; DefnsF (Map Name) Referent TypeReference)
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name))
-&gt; ThreeWay (DefnsF (Map Name) Referent TypeReference)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Mergeblob2 libdep
</span><a href="#local-6989586621679197967"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><span class="annottext">$sel:unparsedFile:Mergeblob3 :: Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AunparsedFile%3AMergeblob3"><span class="hs-identifier hs-var">unparsedFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay Text
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyUnisonFile"><span class="hs-identifier hs-var">makePrettyUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679197971"><span class="hs-identifier hs-var">authors</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198003"><span class="hs-identifier hs-var">renderedConflicts</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198004"><span class="hs-identifier hs-var">renderedDependents</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>          </span><span class="annot"><span class="annottext">$sel:unparsedSoloFiles:Mergeblob3 :: ThreeWay (Pretty ColorText)
</span><a href="Unison.Merge.Mergeblob3.html#%24sel%3AunparsedSoloFiles%3AMergeblob3"><span class="hs-identifier hs-var">unparsedSoloFiles</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>            </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span>
</span><span id="line-146"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:alice:ThreeWay :: DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198014"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198003"><span class="hs-identifier hs-var">renderedConflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>                </span><span class="annot"><span class="annottext">$sel:bob:ThreeWay :: DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198015"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198003"><span class="hs-identifier hs-var">renderedConflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">,</span><span>
</span><span id="line-148"></span><span>                </span><span class="annot"><span class="annottext">$sel:lca:ThreeWay :: DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198016"><span class="hs-identifier hs-var">lca</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198006"><span class="hs-identifier hs-var">renderedLcaConflicts</span></a></span><span>
</span><span id="line-149"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-150"></span><span>              </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
    -&gt; Pretty ColorText)
-&gt; ThreeWay (Pretty ColorText)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679198018"><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198018"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettySoloUnisonFile"><span class="hs-identifier hs-var">makePrettySoloUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198018"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198004"><span class="hs-identifier hs-var">renderedDependents</span></a></span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span id="local-6989586621679197499"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#filterDependents"><span class="hs-identifier hs-type">filterDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197499"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-159"></span><span id="filterDependents"><span class="annot"><span class="annottext">filterDependents :: forall name.
Ord name =&gt;
TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
-&gt; TwoWay (DefnsF Set name name)
</span><a href="Unison.Merge.Mergeblob3.html#filterDependents"><span class="hs-identifier hs-var hs-var">filterDependents</span></a></span></span><span> </span><span id="local-6989586621679198057"><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198057"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679198058"><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198058"><span class="hs-identifier hs-var">soloUpdatesAndDeletes</span></a></span></span><span> </span><span id="local-6989586621679198059"><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198059"><span class="hs-identifier hs-var">dependents0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-comment">-- There is some subset of Alice's dependents (and ditto for Bob of course) that we don't ultimately want/need to put</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-comment">-- into the scratch file: those for which any of the following are true:</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-comment">--   1. It is Alice-conflicted (since we only want to return *unconflicted* things).</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-comment">--   2. It was deleted by Bob.</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-comment">--   3. It was updated by Bob and not updated by Alice.</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198060"><span class="annot"><span class="annottext">dependents1 :: TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198060"><span class="hs-identifier hs-var hs-var">dependents1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>        </span><span class="annot"><span class="annottext">(Set name -&gt; Set name -&gt; Set name)
-&gt; (Set name -&gt; Set name -&gt; Set name)
-&gt; Defns (Set name) (Set name)
-&gt; Defns (Set name) (Set name)
-&gt; Defns (Set name) (Set name)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Set name -&gt; Set name -&gt; Set name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Set name -&gt; Set name -&gt; Set name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span>
</span><span id="line-168"></span><span>          </span><span class="annot"><span class="annottext">(Defns (Set name) (Set name)
 -&gt; Defns (Set name) (Set name) -&gt; Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay
     (Defns (Set name) (Set name) -&gt; Defns (Set name) (Set name))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198059"><span class="hs-identifier hs-var">dependents0</span></a></span><span>
</span><span id="line-169"></span><span>          </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name) -&gt; Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198057"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
forall a. TwoWay a -&gt; TwoWay a
</span><a href="Unison.Merge.TwoWay.html#swap"><span class="hs-identifier hs-var">TwoWay.swap</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198058"><span class="hs-identifier hs-var">soloUpdatesAndDeletes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-comment">-- Of the remaining dependents, it's still possible that the maps are not disjoint. But whenever the same name key</span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-comment">-- exists in Alice's and Bob's dependents, the value will either be equal (by Unison hash)...</span><span>
</span><span id="line-173"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-174"></span><span>      </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-comment">--   { bob   = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-177"></span><span>      </span><span class="hs-comment">-- ...or synhash-equal (i.e. the term or type received different auto-propagated updates)...</span><span>
</span><span id="line-178"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-comment">--   { bob   = { terms = {&quot;foo&quot; =&gt; #bob}   } }</span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span>      </span><span class="hs-comment">-- So, we can arbitrarily keep Alice's, because they will render the same.</span><span>
</span><span id="line-183"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span>      </span><span class="hs-comment">--   { alice = { terms = {&quot;foo&quot; =&gt; #alice} } }</span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-comment">--   { bob   = { terms = {}                } }</span><span>
</span><span id="line-186"></span><span>      </span><span id="local-6989586621679198063"><span class="annot"><span class="annottext">dependents2 :: TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198063"><span class="hs-identifier hs-var hs-var">dependents2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198060"><span class="hs-identifier hs-var">dependents1</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
-&gt; (TwoWay (Defns (Set name) (Set name))
    -&gt; TwoWay (Defns (Set name) (Set name)))
-&gt; TwoWay (Defns (Set name) (Set name))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (TwoWay (Defns (Set name) (Set name)))
  (TwoWay (Defns (Set name) (Set name)))
  (Defns (Set name) (Set name))
  (Defns (Set name) (Set name))
-&gt; (Defns (Set name) (Set name) -&gt; Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
-&gt; TwoWay (Defns (Set name) (Set name))
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (TwoWay (Defns (Set name) (Set name)))
  (TwoWay (Defns (Set name) (Set name)))
  (Defns (Set name) (Set name))
  (Defns (Set name) (Set name))
</span><span class="">#bob</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679198066"><span class="annot"><span class="annottext">Defns (Set name) (Set name)
</span><a href="#local-6989586621679198066"><span class="hs-identifier hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>          </span><span class="annot"><span class="annottext">(Set name -&gt; Set name -&gt; Set name)
-&gt; (Set name -&gt; Set name -&gt; Set name)
-&gt; Defns (Set name) (Set name)
-&gt; Defns (Set name) (Set name)
-&gt; Defns (Set name) (Set name)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Set name -&gt; Set name -&gt; Set name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Set name -&gt; Set name -&gt; Set name
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Defns (Set name) (Set name)
</span><a href="#local-6989586621679198066"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198060"><span class="hs-identifier hs-var">dependents1</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-189"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set name) (Set name))
</span><a href="#local-6989586621679198063"><span class="hs-identifier hs-var">dependents2</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span id="local-6989586621679197520"><span id="local-6989586621679197521"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeStageOne"><span class="hs-identifier hs-type">makeStageOne</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-193"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197520"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197521"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679197520"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197521"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679197520"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197521"><span class="hs-identifier hs-type">typ</span></a></span></span></span><span>
</span><span id="line-198"></span><span id="makeStageOne"><span class="annot"><span class="annottext">makeStageOne :: forall term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOne"><span class="hs-identifier hs-var hs-var">makeStageOne</span></a></span></span><span> </span><span id="local-6989586621679198074"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679198074"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span id="local-6989586621679198075"><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198075"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679198076"><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621679198076"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621679198077"><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198077"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><span class="annottext">(Unconflicts term -&gt; Set Name -&gt; Map Name term -&gt; Map Name term)
-&gt; (Unconflicts typ -&gt; Set Name -&gt; Map Name typ -&gt; Map Name typ)
-&gt; DefnsF Unconflicts term typ
-&gt; Defns (Set Name) (Set Name)
-&gt; Defns (Map Name term) (Map Name typ)
-&gt; Defns (Map Name term) (Map Name typ)
forall tm1 tm2 tm3 tm4 ty1 ty2 ty3 ty4.
(tm1 -&gt; tm2 -&gt; tm3 -&gt; tm4)
-&gt; (ty1 -&gt; ty2 -&gt; ty3 -&gt; ty4)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
-&gt; Defns tm4 ty4
</span><span class="hs-identifier hs-var">zipDefnsWith3</span></span><span> </span><span class="annot"><span class="annottext">Unconflicts term -&gt; Set Name -&gt; Map Name term -&gt; Map Name term
forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOneV"><span class="hs-identifier hs-var">makeStageOneV</span></a></span><span> </span><span class="annot"><span class="annottext">Unconflicts typ -&gt; Set Name -&gt; Map Name typ -&gt; Map Name typ
forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOneV"><span class="hs-identifier hs-var">makeStageOneV</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621679198076"><span class="hs-identifier hs-var">unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name)) -&gt; Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198079"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198075"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Defns (Set Name) (Set Name)
-&gt; Defns (Set Name) (Set Name) -&gt; Defns (Set Name) (Set Name)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name)) -&gt; Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198079"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198077"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><a href="#local-6989586621679198079"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621679198079"><span class="annot"><span class="annottext">f :: TwoWay (Defns (Set Name) (Set Name)) -&gt; Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198079"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679198080"><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198080"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-203"></span><span>      </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name)) -&gt; Defns (Set Name) (Set Name)
forall m. Monoid m =&gt; TwoWay m -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeclNameLookup
-&gt; Defns (Set Name) (Set Name) -&gt; Defns (Set Name) (Set Name)
</span><a href="Unison.Merge.Mergeblob3.html#refIdsToNames"><span class="hs-identifier hs-var">refIdsToNames</span></a></span><span> </span><span class="annot"><span class="annottext">(DeclNameLookup
 -&gt; Defns (Set Name) (Set Name) -&gt; Defns (Set Name) (Set Name))
-&gt; TwoWay DeclNameLookup
-&gt; TwoWay
     (Defns (Set Name) (Set Name) -&gt; Defns (Set Name) (Set Name))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679198074"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name) -&gt; Defns (Set Name) (Set Name))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay (Defns (Set Name) (Set Name))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198080"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span id="local-6989586621679197570"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeStageOneV"><span class="hs-identifier hs-type">makeStageOneV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197570"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679197570"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679197570"><span class="hs-identifier hs-type">v</span></a></span></span><span>
</span><span id="line-206"></span><span id="makeStageOneV"><span class="annot"><span class="annottext">makeStageOneV :: forall v. Unconflicts v -&gt; Set Name -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageOneV"><span class="hs-identifier hs-var hs-var">makeStageOneV</span></a></span></span><span> </span><span id="local-6989586621679198084"><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621679198084"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621679198085"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198085"><span class="hs-identifier hs-var">namesToDelete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name v -&gt; Set Name -&gt; Map Name v
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.withoutKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198085"><span class="hs-identifier hs-var">namesToDelete</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map Name v -&gt; Map Name v)
-&gt; (Map Name v -&gt; Map Name v) -&gt; Map Name v -&gt; Map Name v
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Unconflicts v -&gt; Map Name v -&gt; Map Name v
forall v. Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Unconflicts.html#apply"><span class="hs-identifier hs-var">Unconflicts.apply</span></a></span><span> </span><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621679198084"><span class="hs-identifier hs-var">unconflicts</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeStageTwo"><span class="hs-identifier hs-type">makeStageTwo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679197524"><span class="annot"><a href="#local-6989586621679197524"><span class="hs-identifier hs-type">term</span></a></span></span><span> </span><span id="local-6989586621679197525"><span class="annot"><a href="#local-6989586621679197525"><span class="hs-identifier hs-type">typ</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197524"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197525"><span class="hs-identifier hs-type">typ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679197524"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197525"><span class="hs-identifier hs-type">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679197524"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197525"><span class="hs-identifier hs-type">typ</span></a></span><span>
</span><span id="line-217"></span><span id="makeStageTwo"><span class="annot"><span class="annottext">makeStageTwo :: forall term typ.
TwoWay DeclNameLookup
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; DefnsF Unconflicts term typ
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; ThreeWay (DefnsF (Map Name) term typ)
-&gt; DefnsF (Map Name) term typ
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwo"><span class="hs-identifier hs-var hs-var">makeStageTwo</span></a></span></span><span> </span><span id="local-6989586621679198109"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679198109"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span id="local-6989586621679198110"><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198110"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679198111"><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621679198111"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621679198112"><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198112"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span id="local-6989586621679198113"><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621679198113"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-218"></span><span>  </span><span class="annot"><span class="annottext">(Map Name term
 -&gt; Map Name term
 -&gt; Unconflicts term
 -&gt; Map Name term
 -&gt; Map Name term)
-&gt; (Map Name typ
    -&gt; Map Name typ -&gt; Unconflicts typ -&gt; Map Name typ -&gt; Map Name typ)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF Unconflicts term typ
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
forall tm1 tm2 tm3 tm4 tm5 ty1 ty2 ty3 ty4 ty5.
(tm1 -&gt; tm2 -&gt; tm3 -&gt; tm4 -&gt; tm5)
-&gt; (ty1 -&gt; ty2 -&gt; ty3 -&gt; ty4 -&gt; ty5)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
-&gt; Defns tm4 ty4
-&gt; Defns tm5 ty5
</span><span class="hs-identifier hs-var">zipDefnsWith4</span></span><span> </span><span class="annot"><span class="annottext">Map Name term
-&gt; Map Name term
-&gt; Unconflicts term
-&gt; Map Name term
-&gt; Map Name term
forall v.
Map Name v
-&gt; Map Name v -&gt; Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwoV"><span class="hs-identifier hs-var">makeStageTwoV</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name typ
-&gt; Map Name typ -&gt; Unconflicts typ -&gt; Map Name typ -&gt; Map Name typ
forall v.
Map Name v
-&gt; Map Name v -&gt; Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwoV"><span class="hs-identifier hs-var">makeStageTwoV</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621679198113"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) term typ
</span><a href="#local-6989586621679198115"><span class="hs-identifier hs-var">aliceBiasedDependents</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF Unconflicts term typ
</span><a href="#local-6989586621679198111"><span class="hs-identifier hs-var">unconflicts</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) term typ
</span><a href="#local-6989586621679198116"><span class="hs-identifier hs-var">aliceConflicts</span></a></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="#local-6989586621679198116"><span class="hs-identifier hs-type">aliceConflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679197524"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197525"><span class="hs-identifier hs-type">typ</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621679198116"><span class="annot"><span class="annottext">aliceConflicts :: DefnsF (Map Name) term typ
</span><a href="#local-6989586621679198116"><span class="hs-identifier hs-var hs-var">aliceConflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="annottext">(Map Name term -&gt; Set Name -&gt; Map Name term)
-&gt; (Map Name typ -&gt; Set Name -&gt; Map Name typ)
-&gt; DefnsF (Map Name) term typ
-&gt; Defns (Set Name) (Set Name)
-&gt; DefnsF (Map Name) term typ
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679198117"><span class="annot"><span class="annottext">Map Name term
</span><a href="#local-6989586621679198117"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span id="local-6989586621679198118"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198118"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Name term -&gt; Set Name -&gt; Map Name term
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name term
</span><a href="#local-6989586621679198117"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198118"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Set Name -&gt; Set Name
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198120"><span class="hs-identifier hs-var">aliceConstructorsOfTypeConflicts</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="annottext">Map Name typ -&gt; Set Name -&gt; Map Name typ
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621679198113"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198110"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="#local-6989586621679198120"><span class="hs-identifier hs-type">aliceConstructorsOfTypeConflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621679198120"><span class="annot"><span class="annottext">aliceConstructorsOfTypeConflicts :: Set Name
</span><a href="#local-6989586621679198120"><span class="hs-identifier hs-var hs-var">aliceConstructorsOfTypeConflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>      </span><span class="annot"><span class="annottext">(Name -&gt; Set Name) -&gt; Set Name -&gt; Set Name
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Set Name) -&gt; (Name -&gt; [Name]) -&gt; Name -&gt; Set Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclNameLookup -&gt; Name -&gt; [Name]
DeclNameLookup -&gt; Name -&gt; [Name]
</span><span class="hs-identifier hs-var">DeclNameLookup.expectConstructorNames</span></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679198109"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198110"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><a href="#local-6989586621679198115"><span class="hs-identifier hs-type">aliceBiasedDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679197524"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197525"><span class="hs-identifier hs-type">typ</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621679198115"><span class="annot"><span class="annottext">aliceBiasedDependents :: DefnsF (Map Name) term typ
</span><a href="#local-6989586621679198115"><span class="hs-identifier hs-var hs-var">aliceBiasedDependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>      </span><span class="annot"><span class="annottext">(DefnsF (Map Name) term typ
 -&gt; DefnsF (Map Name) term typ -&gt; DefnsF (Map Name) term typ)
-&gt; TwoWay (DefnsF (Map Name) term typ)
-&gt; DefnsF (Map Name) term typ
forall a b. (a -&gt; a -&gt; b) -&gt; TwoWay a -&gt; b
</span><a href="Unison.Merge.TwoWay.html#twoWay"><span class="hs-identifier hs-var">TwoWay.twoWay</span></a></span><span>
</span><span id="line-237"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name term -&gt; Map Name term -&gt; Map Name term)
-&gt; (Map Name typ -&gt; Map Name typ -&gt; Map Name typ)
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
-&gt; DefnsF (Map Name) term typ
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(term -&gt; term -&gt; term)
-&gt; Map Name term -&gt; Map Name term -&gt; Map Name term
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">term -&gt; term -&gt; term
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(typ -&gt; typ -&gt; typ) -&gt; Map Name typ -&gt; Map Name typ -&gt; Map Name typ
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">typ -&gt; typ -&gt; typ
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name term -&gt; Set Name -&gt; Map Name term)
-&gt; (Map Name typ -&gt; Set Name -&gt; Map Name typ)
-&gt; DefnsF (Map Name) term typ
-&gt; Defns (Set Name) (Set Name)
-&gt; DefnsF (Map Name) term typ
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name term -&gt; Set Name -&gt; Map Name term
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name typ -&gt; Set Name -&gt; Map Name typ
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">(DefnsF (Map Name) term typ
 -&gt; Defns (Set Name) (Set Name) -&gt; DefnsF (Map Name) term typ)
-&gt; TwoWay (DefnsF (Map Name) term typ)
-&gt; TwoWay
     (Defns (Set Name) (Set Name) -&gt; DefnsF (Map Name) term typ)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
-&gt; TwoWay (DefnsF (Map Name) term typ)
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay (DefnsF (Map Name) term typ)
</span><a href="#local-6989586621679198113"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name) -&gt; DefnsF (Map Name) term typ)
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay (DefnsF (Map Name) term typ)
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198112"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span id="local-6989586621679197592"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeStageTwoV"><span class="hs-identifier hs-type">makeStageTwoV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679197592"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679197592"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197592"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679197592"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679197592"><span class="hs-identifier hs-type">v</span></a></span></span><span>
</span><span id="line-241"></span><span id="makeStageTwoV"><span class="annot"><span class="annottext">makeStageTwoV :: forall v.
Map Name v
-&gt; Map Name v -&gt; Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Mergeblob3.html#makeStageTwoV"><span class="hs-identifier hs-var hs-var">makeStageTwoV</span></a></span></span><span> </span><span id="local-6989586621679198128"><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679198128"><span class="hs-identifier hs-var">lca</span></a></span></span><span> </span><span id="local-6989586621679198129"><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679198129"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span id="local-6989586621679198130"><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621679198130"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span> </span><span id="local-6989586621679198131"><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679198131"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-242"></span><span>  </span><span class="annot"><span class="annottext">(v -&gt; v -&gt; v) -&gt; Map Name v -&gt; Map Name v -&gt; Map Name v
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; v -&gt; v
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679198131"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unconflicts v -&gt; Map Name v -&gt; Map Name v
forall v. Unconflicts v -&gt; Map Name v -&gt; Map Name v
</span><a href="Unison.Merge.Unconflicts.html#apply"><span class="hs-identifier hs-var">Unconflicts.apply</span></a></span><span> </span><span class="annot"><span class="annottext">Unconflicts v
</span><a href="#local-6989586621679198130"><span class="hs-identifier hs-var">unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(v -&gt; v -&gt; v) -&gt; Map Name v -&gt; Map Name v -&gt; Map Name v
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; v -&gt; v
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679198129"><span class="hs-identifier hs-var">dependents</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name v
</span><a href="#local-6989586621679198128"><span class="hs-identifier hs-var">lca</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- Given just named term/type reference ids, fill out all names that occupy the term and type namespaces. This is simply</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- the given names plus all of the types' constructors.</span><span>
</span><span id="line-246"></span><span class="hs-comment">--</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- For example, if the input is</span><span>
</span><span id="line-248"></span><span class="hs-comment">--</span><span>
</span><span id="line-249"></span><span class="hs-comment">--   declNameLookup = {</span><span>
</span><span id="line-250"></span><span class="hs-comment">--     &quot;Maybe&quot; =&gt; [&quot;Maybe.Nothing&quot;, &quot;Maybe.Just&quot;]</span><span>
</span><span id="line-251"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-252"></span><span class="hs-comment">--   defns = {</span><span>
</span><span id="line-253"></span><span class="hs-comment">--     terms = { &quot;foo&quot; =&gt; #foo }</span><span>
</span><span id="line-254"></span><span class="hs-comment">--     types = { &quot;Maybe&quot; =&gt; #Maybe }</span><span>
</span><span id="line-255"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-256"></span><span class="hs-comment">--</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- then the output is</span><span>
</span><span id="line-258"></span><span class="hs-comment">--</span><span>
</span><span id="line-259"></span><span class="hs-comment">--   defns = {</span><span>
</span><span id="line-260"></span><span class="hs-comment">--     terms = { &quot;foo&quot;, &quot;Maybe.Nothing&quot;, &quot;Maybe.Just&quot; }</span><span>
</span><span id="line-261"></span><span class="hs-comment">--     types = { &quot;Maybe&quot; }</span><span>
</span><span id="line-262"></span><span class="hs-comment">--   }</span><span>
</span><span id="line-263"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#refIdsToNames"><span class="hs-identifier hs-type">refIdsToNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-264"></span><span id="refIdsToNames"><span class="annot"><span class="annottext">refIdsToNames :: DeclNameLookup
-&gt; Defns (Set Name) (Set Name) -&gt; Defns (Set Name) (Set Name)
</span><a href="Unison.Merge.Mergeblob3.html#refIdsToNames"><span class="hs-identifier hs-var hs-var">refIdsToNames</span></a></span></span><span> </span><span id="local-6989586621679198132"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679198132"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><span class="annottext">(Set Name -&gt; Defns (Set Name) (Set Name))
-&gt; (Set Name -&gt; Defns (Set Name) (Set Name))
-&gt; Defns (Set Name) (Set Name)
-&gt; Defns (Set Name) (Set Name)
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198133"><span class="hs-identifier hs-var">goTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198134"><span class="hs-identifier hs-var">goTypes</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621679198133"><span class="hs-identifier hs-type">goTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621679198133"><span class="annot"><span class="annottext">goTerms :: Set Name -&gt; Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198133"><span class="hs-identifier hs-var hs-var">goTerms</span></a></span></span><span> </span><span id="local-6989586621679198135"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198135"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Set Name
terms :: Set Name
$sel:terms:Defns :: Set Name
</span><a href="#local-6989586621679198135"><span class="hs-identifier hs-var hs-var">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:types:Defns :: Set Name
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">}</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="#local-6989586621679198134"><span class="hs-identifier hs-type">goTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621679198134"><span class="annot"><span class="annottext">goTypes :: Set Name -&gt; Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198134"><span class="hs-identifier hs-var hs-var">goTypes</span></a></span></span><span> </span><span id="local-6989586621679198139"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198139"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:terms:Defns :: Set Name
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Set Name) -&gt; Set Name -&gt; Set Name
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; Set Name) -&gt; (Name -&gt; [Name]) -&gt; Name -&gt; Set Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; DeclNameLookup -&gt; Name -&gt; [Name]
DeclNameLookup -&gt; Name -&gt; [Name]
</span><span class="hs-identifier hs-var">expectConstructorNames</span></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679198132"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198139"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>          </span><span class="annot"><span class="annottext">Set Name
$sel:types:Defns :: Set Name
types :: Set Name
</span><span class="hs-identifier hs-var hs-var">types</span></span><span>
</span><span id="line-276"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#renderConflictsAndDependents"><span class="hs-identifier hs-type">renderConflictsAndDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span id="renderConflictsAndDependents"><span class="annot"><span class="annottext">renderConflictsAndDependents :: TwoWay DeclNameLookup
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; PrettyPrintEnvDecl
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
    TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
</span><a href="Unison.Merge.Mergeblob3.html#renderConflictsAndDependents"><span class="hs-identifier hs-var hs-var">renderConflictsAndDependents</span></a></span></span><span> </span><span id="local-6989586621679198140"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679198140"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span id="local-6989586621679198141"><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679198141"><span class="hs-identifier hs-var">hydratedDefns</span></a></span></span><span> </span><span id="local-6989586621679198142"><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198142"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679198143"><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198143"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span id="local-6989586621679198144"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679198144"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
   DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
    TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
forall a b. TwoWay (a, b) -&gt; (TwoWay a, TwoWay b)
forall (f :: * -&gt; *) a b. Unzip f =&gt; f (a, b) -&gt; (f a, f b)
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">(TwoWay
   (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
    DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
 -&gt; (TwoWay
       (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
     TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))))
-&gt; TwoWay
     (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
      DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)),
    TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679198145"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679198145"><span class="hs-identifier hs-var">declNameLookup</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679198146"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198146"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679198147"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198147"><span class="hs-identifier hs-var">dependents</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-290"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198148"><span class="annot"><span class="annottext">render :: DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198148"><span class="hs-identifier hs-var hs-var">render</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
-&gt; PrettyPrintEnvDecl
-&gt; DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall a v.
(Var v, Monoid a) =&gt;
DeclNameLookup
-&gt; PrettyPrintEnvDecl
-&gt; DefnsF
     (Map Name) (Term v a, Type v a) (TermReferenceId, Decl v a)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><span class="hs-identifier hs-var">renderDefnsForUnisonFile</span></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679198145"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679198144"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">(DefnsF
   (Map Name)
   (Term Symbol Ann, Type Symbol Ann)
   (TermReferenceId, Decl Symbol Ann)
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
    -&gt; DefnsF
         (Map Name)
         (Term Symbol Ann, Type Symbol Ann)
         (TermReferenceId, Decl Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
  (DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann))
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (Term Symbol Ann, Type Symbol Ann)
-&gt; ((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
    -&gt; (Term Symbol Ann, Type Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; Identity
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
</span><span class="">#terms</span></span><span> </span><span class="annot"><span class="annottext">((Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
 -&gt; DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
 -&gt; Identity
      (DefnsF
         (Map Name)
         (Term Symbol Ann, Type Symbol Ann)
         (TermReferenceId, Decl Symbol Ann)))
-&gt; (((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     -&gt; Identity (Term Symbol Ann, Type Symbol Ann))
    -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
    -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
-&gt; ASetter
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (Term Symbol Ann, Type Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Identity (Term Symbol Ann, Type Symbol Ann))
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann))
Setter
  (Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
  (Map Name (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (Term Symbol Ann, Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; Setter (f a) (f b) a b
</span><span class="hs-identifier hs-var">mapped</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; (Term Symbol Ann, Type Symbol Ann)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-291"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198148"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198146"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198148"><span class="hs-identifier hs-var">render</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198147"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><span class="annottext">(DeclNameLookup
 -&gt; (DefnsF
       (Map Name)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
       (TermReferenceId, Decl Symbol Ann),
     DefnsF
       (Map Name)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
       (TermReferenceId, Decl Symbol Ann))
 -&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
     DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
-&gt; TwoWay DeclNameLookup
-&gt; TwoWay
     ((DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann),
       DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann))
      -&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
          DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679198140"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span>
</span><span id="line-294"></span><span>      </span><span class="annot"><span class="annottext">TwoWay
  ((DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann),
    DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann))
   -&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
       DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)))
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann),
      DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay
     (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText),
      DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann),
   DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679198150"><span class="hs-identifier hs-var">hydratedConflictsAndDependents</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><a href="#local-6989586621679198150"><span class="hs-identifier hs-type">hydratedConflictsAndDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span>
</span><span id="line-298"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-299"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>    </span><span id="local-6989586621679198150"><span class="annot"><span class="annottext">hydratedConflictsAndDependents :: TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann),
   DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679198150"><span class="hs-identifier hs-var hs-var">hydratedConflictsAndDependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679198151"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198151"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621679198152"><span class="annot"><span class="annottext">Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198152"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679198153"><span class="annot"><span class="annottext">Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198153"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-303"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Set Name
 -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
-&gt; (Map Name (TermReferenceId, Decl Symbol Ann)
    -&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; Defns (Set Name) (Set Name)
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Set Name
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198151"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198152"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Set Name
 -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
-&gt; (Map Name (TermReferenceId, Decl Symbol Ann)
    -&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; Defns (Set Name) (Set Name)
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Set Name
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198151"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">Defns (Set Name) (Set Name)
</span><a href="#local-6989586621679198153"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-305"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>        </span><span class="annot"><span class="annottext">(DefnsF
   (Map Name)
   (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
   (TermReferenceId, Decl Symbol Ann)
 -&gt; Defns (Set Name) (Set Name)
 -&gt; Defns (Set Name) (Set Name)
 -&gt; (DefnsF
       (Map Name)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
       (TermReferenceId, Decl Symbol Ann),
     DefnsF
       (Map Name)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
       (TermReferenceId, Decl Symbol Ann)))
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; TwoWay
     (Defns (Set Name) (Set Name)
      -&gt; Defns (Set Name) (Set Name)
      -&gt; (DefnsF
            (Map Name)
            (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
            (TermReferenceId, Decl Symbol Ann),
          DefnsF
            (Map Name)
            (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
            (TermReferenceId, Decl Symbol Ann)))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679198141"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="annottext">TwoWay
  (Defns (Set Name) (Set Name)
   -&gt; Defns (Set Name) (Set Name)
   -&gt; (DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann),
       DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann)))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay
     (Defns (Set Name) (Set Name)
      -&gt; (DefnsF
            (Map Name)
            (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
            (TermReferenceId, Decl Symbol Ann),
          DefnsF
            (Map Name)
            (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
            (TermReferenceId, Decl Symbol Ann)))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198142"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="annottext">TwoWay
  (Defns (Set Name) (Set Name)
   -&gt; (DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann),
       DefnsF
         (Map Name)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
         (TermReferenceId, Decl Symbol Ann)))
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; TwoWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann),
      DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
forall a b. TwoWay (a -&gt; b) -&gt; TwoWay a -&gt; TwoWay b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198143"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#renderLcaConflicts"><span class="hs-identifier hs-type">renderLcaConflicts</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-312"></span><span>  </span><span class="annot"><a href="Unison.Merge.PartialDeclNameLookup.html#PartialDeclNameLookup"><span class="hs-identifier hs-type">PartialDeclNameLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-315"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span id="renderLcaConflicts"><span class="annot"><span class="annottext">renderLcaConflicts :: PartialDeclNameLookup
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; TwoWay (Defns (Set Name) (Set Name))
-&gt; PrettyPrintEnvDecl
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="Unison.Merge.Mergeblob3.html#renderLcaConflicts"><span class="hs-identifier hs-var hs-var">renderLcaConflicts</span></a></span></span><span> </span><span id="local-6989586621679198154"><span class="annot"><span class="annottext">PartialDeclNameLookup
</span><a href="#local-6989586621679198154"><span class="hs-identifier hs-var">partialDeclNameLookup</span></a></span></span><span> </span><span id="local-6989586621679198155"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198155"><span class="hs-identifier hs-var">hydratedDefns</span></a></span></span><span> </span><span id="local-6989586621679198156"><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198156"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679198157"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679198157"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198158"><span class="annot"><span class="annottext">hydratedConflicts :: DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198158"><span class="hs-identifier hs-var hs-var">hydratedConflicts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Set Name
 -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
-&gt; (Map Name (TermReferenceId, Decl Symbol Ann)
    -&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; Defns (Set Name) (Set Name)
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Set Name
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; Set Name -&gt; Map Name (TermReferenceId, Decl Symbol Ann)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198155"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name)) -&gt; Defns (Set Name) (Set Name)
forall m. Monoid m =&gt; TwoWay m -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (Set Name) (Set Name))
</span><a href="#local-6989586621679198156"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
-&gt; PrettyPrintEnvDecl
-&gt; DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall a v.
(Var v, Monoid a) =&gt;
DeclNameLookup
-&gt; PrettyPrintEnvDecl
-&gt; DefnsF
     (Map Name) (Term v a, Type v a) (TermReferenceId, Decl v a)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><span class="hs-identifier hs-var">renderDefnsForUnisonFile</span></span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679198159"><span class="hs-identifier hs-var">declNameLookup</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679198157"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
  (DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann))
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (Term Symbol Ann, Type Symbol Ann)
-&gt; ((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
    -&gt; (Term Symbol Ann, Type Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; DefnsF
     (Map Name)
     (Term Symbol Ann, Type Symbol Ann)
     (TermReferenceId, Decl Symbol Ann)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; Identity
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
</span><span class="">#terms</span></span><span> </span><span class="annot"><span class="annottext">((Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
 -&gt; DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
 -&gt; Identity
      (DefnsF
         (Map Name)
         (Term Symbol Ann, Type Symbol Ann)
         (TermReferenceId, Decl Symbol Ann)))
-&gt; (((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     -&gt; Identity (Term Symbol Ann, Type Symbol Ann))
    -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
    -&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann)))
-&gt; ASetter
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
     (DefnsF
        (Map Name)
        (Term Symbol Ann, Type Symbol Ann)
        (TermReferenceId, Decl Symbol Ann))
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (Term Symbol Ann, Type Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Identity (Term Symbol Ann, Type Symbol Ann))
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Identity (Map Name (Term Symbol Ann, Type Symbol Ann))
Setter
  (Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
  (Map Name (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (Term Symbol Ann, Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; Setter (f a) (f b) a b
</span><span class="hs-identifier hs-var">mapped</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; (Term Symbol Ann, Type Symbol Ann)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679198158"><span class="hs-identifier hs-var">hydratedConflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-comment">-- We allow the LCA of a merge to have missing constructor names, yet we do need to render *something* in a file</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-comment">-- for a mergetool (if one is configured). So, we make the partial decl name lookup total by making bogus</span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-comment">-- constructor names as necessary.</span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><a href="#local-6989586621679198159"><span class="hs-identifier hs-type">declNameLookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span>
</span><span id="line-325"></span><span>    </span><span id="local-6989586621679198159"><span class="annot"><span class="annottext">declNameLookup :: DeclNameLookup
</span><a href="#local-6989586621679198159"><span class="hs-identifier hs-var hs-var">declNameLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-326"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:constructorToDecl:DeclNameLookup :: Map Name Name
</span><span class="hs-identifier hs-var">constructorToDecl</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartialDeclNameLookup
</span><a href="#local-6989586621679198154"><span class="hs-identifier hs-var">partialDeclNameLookup</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">constructorToDecl</span><span class="hs-special">,</span><span>
</span><span id="line-328"></span><span>          </span><span class="annot"><span class="annottext">$sel:declToConstructors:DeclNameLookup :: Map Name [Name]
</span><span class="hs-identifier hs-var">declToConstructors</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-329"></span><span>            </span><span class="annot"><span class="annottext">[Maybe Name] -&gt; [Name]
</span><a href="#local-6989586621679198163"><span class="hs-identifier hs-var">makeTotal</span></a></span><span> </span><span class="annot"><span class="annottext">([Maybe Name] -&gt; [Name])
-&gt; Map Name [Maybe Name] -&gt; Map Name [Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PartialDeclNameLookup
</span><a href="#local-6989586621679198154"><span class="hs-identifier hs-var">partialDeclNameLookup</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">declToConstructors</span><span>
</span><span id="line-330"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><a href="#local-6989586621679198163"><span class="hs-identifier hs-type">makeTotal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-333"></span><span>        </span><span id="local-6989586621679198163"><span class="annot"><span class="annottext">makeTotal :: [Maybe Name] -&gt; [Name]
</span><a href="#local-6989586621679198163"><span class="hs-identifier hs-var hs-var">makeTotal</span></a></span></span><span> </span><span id="local-6989586621679198164"><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621679198164"><span class="hs-identifier hs-var">names0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Maybe Name] -&gt; Maybe [Name]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621679198164"><span class="hs-identifier hs-var">names0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-335"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679198166"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679198166"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679198166"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-336"></span><span>            </span><span class="annot"><span class="annottext">Maybe [Name]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-337"></span><span>              </span><span class="annot"><span class="annottext">(Set Name, [Name]) -&gt; [Name]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Set Name, [Name]) -&gt; [Name]) -&gt; (Set Name, [Name]) -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-338"></span><span>                </span><span class="annot"><span class="annottext">(Set Name -&gt; Maybe Name -&gt; (Set Name, Name))
-&gt; Set Name -&gt; [Maybe Name] -&gt; (Set Name, [Name])
forall (t :: * -&gt; *) s a b.
Traversable t =&gt;
(s -&gt; a -&gt; (s, b)) -&gt; s -&gt; t a -&gt; (s, t b)
</span><span class="hs-identifier hs-var">List.mapAccumL</span></span><span>
</span><span id="line-339"></span><span>                  </span><span class="annot"><span class="annottext">Set Name -&gt; Maybe Name -&gt; (Set Name, Name)
</span><a href="#local-6989586621679198168"><span class="hs-identifier hs-var">makeSomethingUp</span></a></span><span>
</span><span id="line-340"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe Name -&gt; Set Name) -&gt; [Maybe Name] -&gt; Set Name
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name -&gt; (Name -&gt; Set Name) -&gt; Maybe Name -&gt; Set Name
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Set Name
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621679198164"><span class="hs-identifier hs-var">names0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>                  </span><span class="annot"><span class="annottext">[Maybe Name]
</span><a href="#local-6989586621679198164"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-342"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><a href="#local-6989586621679198168"><span class="hs-identifier hs-type">makeSomethingUp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>            </span><span id="local-6989586621679198168"><span class="annot"><span class="annottext">makeSomethingUp :: Set Name -&gt; Maybe Name -&gt; (Set Name, Name)
</span><a href="#local-6989586621679198168"><span class="hs-identifier hs-var hs-var">makeSomethingUp</span></a></span></span><span> </span><span id="local-6989586621679198171"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198171"><span class="hs-identifier hs-var">taken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-345"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679198172"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679198172"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198171"><span class="hs-identifier hs-var">taken</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679198172"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>              </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-347"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198175"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679198175"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Name
</span><a href="#local-6989586621679198176"><span class="hs-identifier hs-var">freshen</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unnamed&quot;</span></span><span>
</span><span id="line-348"></span><span>                    </span><span class="hs-glyph">!</span><span id="local-6989586621679198177"><span class="annot"><span class="annottext">taken1 :: Set Name
</span><a href="#local-6989586621679198177"><span class="hs-identifier hs-var hs-var">taken1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Set Name
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679198175"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198171"><span class="hs-identifier hs-var">taken</span></a></span><span>
</span><span id="line-349"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198177"><span class="hs-identifier hs-var">taken1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679198175"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-351"></span><span>                </span><span class="annot"><a href="#local-6989586621679198176"><span class="hs-identifier hs-type">freshen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-352"></span><span>                </span><span id="local-6989586621679198176"><span class="annot"><span class="annottext">freshen :: Int -&gt; Text -&gt; Name
</span><a href="#local-6989586621679198176"><span class="hs-identifier hs-var hs-var">freshen</span></a></span></span><span> </span><span id="local-6989586621679198179"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679198179"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679198180"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679198180"><span class="hs-identifier hs-var">name0</span></a></span></span><span>
</span><span id="line-353"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Set Name -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679198181"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679198171"><span class="hs-identifier hs-var">taken</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Name
</span><a href="#local-6989586621679198176"><span class="hs-identifier hs-var">freshen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679198179"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679198180"><span class="hs-identifier hs-var">name0</span></a></span><span>
</span><span id="line-354"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679198181"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-355"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-356"></span><span>                    </span><span class="annot"><a href="#local-6989586621679198181"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-357"></span><span>                    </span><span id="local-6989586621679198181"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679198181"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-358"></span><span>                      </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Name
Text -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeParseText</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679198180"><span class="hs-identifier hs-var">name0</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679198179"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier hs-var">Text.empty</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679198179"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-comment">-- Create a PPE that uses Alice's names whenever possible, falling back to Bob's names only when Alice doesn't have any,</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- and falling back to the LCA after that.</span><span>
</span><span id="line-362"></span><span class="hs-comment">--</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- This results in a file that &quot;looks familiar&quot; to Alice (the one merging in Bob's changes), and avoids superfluous</span><span>
</span><span id="line-364"></span><span class="hs-comment">-- textual conflicts that would arise from preferring Bob's names for Bob's code (where his names differ).</span><span>
</span><span id="line-365"></span><span class="hs-comment">--</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- The LCA names are not used unless we need to render LCA definitions for a mergetool, but we add them to the PPE in</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- all cases anyway. If this is very expensive, we could consider omitting them in the case that no mergetool is</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- configured.</span><span>
</span><span id="line-369"></span><span class="hs-comment">--</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- Note that LCA names can make name quality slightly worse. For example, &quot;foo.bar&quot; might exist in the LCA, but deleted</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- in Alice and Bob, and nonetheless prevent some &quot;qux.bar&quot; from rendering as &quot;bar&quot;. That seems fine.</span><span>
</span><span id="line-372"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makePrettyPrintEnv"><span class="hs-identifier hs-type">makePrettyPrintEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PrettyPrintEnvDecl</span></span><span>
</span><span id="line-373"></span><span id="makePrettyPrintEnv"><span class="annot"><span class="annottext">makePrettyPrintEnv :: ThreeWay Names -&gt; Names -&gt; Names -&gt; PrettyPrintEnvDecl
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyPrintEnv"><span class="hs-identifier hs-var hs-var">makePrettyPrintEnv</span></a></span></span><span> </span><span id="local-6989586621679198187"><span class="annot"><span class="annottext">ThreeWay Names
</span><a href="#local-6989586621679198187"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679198188"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679198188"><span class="hs-identifier hs-var">libdepsNames</span></a></span></span><span> </span><span id="local-6989586621679198189"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679198189"><span class="hs-identifier hs-var">lcaLibdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-374"></span><span>  </span><span class="annot"><span class="annottext">Namer -&gt; Suffixifier -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.makePPED</span></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Namer
</span><span class="hs-identifier hs-var">PPE.namer</span></span><span>
</span><span id="line-376"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.preferring</span></span><span>
</span><span id="line-377"></span><span>            </span><span class="hs-comment">-- Here it might be slightly more comfortable to Alice if we prefer her names and _her_ libdeps, not the</span><span>
</span><span id="line-378"></span><span>            </span><span class="hs-comment">-- combined Alice+Bob libdep, because that might bring in a Bob name that Alice isn't yet familiar with</span><span>
</span><span id="line-379"></span><span>            </span><span class="hs-comment">-- (even though it will be in her merge result at the end). However, that would require a bit of simple</span><span>
</span><span id="line-380"></span><span>            </span><span class="hs-comment">-- refactoring (just need to delay the combining of libdeps until at least here), and doesn't seem worth it</span><span>
</span><span id="line-381"></span><span>            </span><span class="hs-comment">-- over this quick fix of just &quot;prefer Alice + any libdep name over names that only Bob's project has&quot;.</span><span>
</span><span id="line-382"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.preferring</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreeWay Names
</span><a href="#local-6989586621679198187"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679198188"><span class="hs-identifier hs-var">libdepsNames</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThreeWay Names
</span><a href="#local-6989586621679198187"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreeWay Names
</span><a href="#local-6989586621679198187"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679198189"><span class="hs-identifier hs-var">lcaLibdeps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Suffixifier
</span><span class="hs-identifier hs-var">PPE.suffixifyByName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreeWay Names -&gt; Names
forall m. Monoid m =&gt; ThreeWay m -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay Names
</span><a href="#local-6989586621679198187"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679198188"><span class="hs-identifier hs-var">libdepsNames</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#defnsToNames"><span class="hs-identifier hs-type">defnsToNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-389"></span><span id="defnsToNames"><span class="annot"><span class="annottext">defnsToNames :: Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
-&gt; Names
</span><a href="Unison.Merge.Mergeblob3.html#defnsToNames"><span class="hs-identifier hs-var hs-var">defnsToNames</span></a></span></span><span> </span><span id="local-6989586621679198194"><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621679198194"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:terms:Names :: Relation Name Referent
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name Referent -&gt; Relation Name Referent
forall a b. (Ord a, Ord b) =&gt; Map a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap Referent Name -&gt; Map Name Referent
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621679198194"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-392"></span><span>      </span><span class="annot"><span class="annottext">$sel:types:Names :: Relation Name TypeReference
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Name TypeReference -&gt; Relation Name TypeReference
forall a b. (Ord a, Ord b) =&gt; Map a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">Relation.fromMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BiMultimap TypeReference Name -&gt; Map Name TypeReference
forall a b. BiMultimap a b -&gt; Map b a
</span><span class="hs-identifier hs-var">BiMultimap.range</span></span><span> </span><span class="annot"><span class="annottext">Defns (BiMultimap Referent Name) (BiMultimap TypeReference Name)
</span><a href="#local-6989586621679198194"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makePrettyUnisonFile"><span class="hs-identifier hs-type">makePrettyUnisonFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-396"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-398"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-399"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span>
</span><span id="line-400"></span><span id="makePrettyUnisonFile"><span class="annot"><span class="annottext">makePrettyUnisonFile :: TwoWay Text
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyUnisonFile"><span class="hs-identifier hs-var hs-var">makePrettyUnisonFile</span></a></span></span><span> </span><span id="local-6989586621679198199"><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679198199"><span class="hs-identifier hs-var">authors</span></a></span></span><span> </span><span id="local-6989586621679198200"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198200"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679198201"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198201"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-401"></span><span>  </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198200"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-comment">-- Merge the two maps together into one, remembering who authored what</span><span>
</span><span id="line-404"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (TwoWay
      (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
    -&gt; Defns
         (Map Name (These (Pretty ColorText) (Pretty ColorText)))
         (Map Name (These (Pretty ColorText) (Pretty ColorText))))
-&gt; Defns
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; Defns
      (Map Name (These (Pretty ColorText) (Pretty ColorText)))
      (Map Name (These (Pretty ColorText) (Pretty ColorText))))
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Defns
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
forall a b. (a -&gt; a -&gt; b) -&gt; TwoWay a -&gt; b
</span><a href="Unison.Merge.TwoWay.html#twoWay"><span class="hs-identifier hs-var">TwoWay.twoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name (Pretty ColorText)
 -&gt; Map Name (Pretty ColorText)
 -&gt; Map Name (These (Pretty ColorText) (Pretty ColorText)))
-&gt; (Map Name (Pretty ColorText)
    -&gt; Map Name (Pretty ColorText)
    -&gt; Map Name (These (Pretty ColorText) (Pretty ColorText)))
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; Defns
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
     (Map Name (These (Pretty ColorText) (Pretty ColorText)))
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
-&gt; Map Name (Pretty ColorText)
-&gt; Map Name (These (Pretty ColorText) (Pretty ColorText))
forall a b. Map Name a -&gt; Map Name b -&gt; Map Name (These a b)
forall (f :: * -&gt; *) a b.
Semialign f =&gt;
f a -&gt; f b -&gt; f (These a b)
</span><span class="hs-identifier hs-var">align</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
-&gt; Map Name (Pretty ColorText)
-&gt; Map Name (These (Pretty ColorText) (Pretty ColorText))
forall a b. Map Name a -&gt; Map Name b -&gt; Map Name (These a b)
forall (f :: * -&gt; *) a b.
Semialign f =&gt;
f a -&gt; f b -&gt; f (These a b)
</span><span class="hs-identifier hs-var">align</span></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-comment">-- Sort alphabetically</span><span>
</span><span id="line-406"></span><span>        </span><span class="annot"><span class="annottext">Defns
  (Map Name (These (Pretty ColorText) (Pretty ColorText)))
  (Map Name (These (Pretty ColorText) (Pretty ColorText)))
-&gt; (Defns
      (Map Name (These (Pretty ColorText) (Pretty ColorText)))
      (Map Name (These (Pretty ColorText) (Pretty ColorText)))
    -&gt; DefnsF
         []
         (These (Pretty ColorText) (Pretty ColorText))
         (These (Pretty ColorText) (Pretty ColorText)))
-&gt; DefnsF
     []
     (These (Pretty ColorText) (Pretty ColorText))
     (These (Pretty ColorText) (Pretty ColorText))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Defns
  (Map Name (These (Pretty ColorText) (Pretty ColorText)))
  (Map Name (These (Pretty ColorText) (Pretty ColorText)))
-&gt; DefnsF
     []
     (These (Pretty ColorText) (Pretty ColorText))
     (These (Pretty ColorText) (Pretty ColorText))
forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="Unison.Merge.Mergeblob3.html#inAlphabeticalOrder"><span class="hs-identifier hs-var">inAlphabeticalOrder</span></a></span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-comment">-- Render each conflict, types then terms (even though a type can conflict with a term, in which case they</span><span>
</span><span id="line-408"></span><span>        </span><span class="hs-comment">-- would not be adjacent in the file), with an author comment above each conflicted thing</span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><span class="annottext">DefnsF
  []
  (These (Pretty ColorText) (Pretty ColorText))
  (These (Pretty ColorText) (Pretty ColorText))
-&gt; (DefnsF
      []
      (These (Pretty ColorText) (Pretty ColorText))
      (These (Pretty ColorText) (Pretty ColorText))
    -&gt; Pretty ColorText)
-&gt; Pretty ColorText
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198203"><span class="annot"><span class="annottext">f :: [These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198203"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-410"></span><span>                  </span><span class="annot"><span class="annottext">(These (Pretty ColorText) (Pretty ColorText) -&gt; Pretty ColorText)
-&gt; [These (Pretty ColorText) (Pretty ColorText)]
-&gt; Pretty ColorText
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-411"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">This</span></span><span> </span><span id="local-6989586621679198205"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679198205"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679198206"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679198205"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-412"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">That</span></span><span> </span><span id="local-6989586621679198208"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679198208"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679198209"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679198208"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-413"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">These</span></span><span> </span><span id="local-6989586621679198211"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679198211"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679198212"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679198212"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679198206"><span class="hs-identifier hs-var">alice</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679198211"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679198209"><span class="hs-identifier hs-var">bob</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679198212"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-414"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-415"></span><span>                    </span><span id="local-6989586621679198206"><span class="annot"><span class="annottext">alice :: Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679198206"><span class="hs-identifier hs-var hs-var">alice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Pretty ColorText) -&gt; Pretty ColorText -&gt; Pretty ColorText
forall {m}. (Monoid m, IsString m) =&gt; Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621679198213"><span class="hs-identifier hs-var">prettyBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Maybe (Pretty ColorText)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">Pretty.text</span></span><span> </span><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679198199"><span class="hs-identifier hs-var">authors</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>                    </span><span id="local-6989586621679198209"><span class="annot"><span class="annottext">bob :: Pretty ColorText -&gt; Pretty ColorText
</span><a href="#local-6989586621679198209"><span class="hs-identifier hs-var hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Pretty ColorText) -&gt; Pretty ColorText -&gt; Pretty ColorText
forall {m}. (Monoid m, IsString m) =&gt; Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621679198213"><span class="hs-identifier hs-var">prettyBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Maybe (Pretty ColorText)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pretty ColorText
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">Pretty.text</span></span><span> </span><span class="annot"><span class="annottext">TwoWay Text
</span><a href="#local-6989586621679198199"><span class="hs-identifier hs-var">authors</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">([These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText)
-&gt; ([These (Pretty ColorText) (Pretty ColorText)]
    -&gt; Pretty ColorText)
-&gt; DefnsF
     []
     (These (Pretty ColorText) (Pretty ColorText))
     (These (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">[These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198203"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[These (Pretty ColorText) (Pretty ColorText)] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198203"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-418"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-comment">-- Show message that delineates where conflicts end and dependents begin only when there are both conflicts and</span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-comment">-- dependents</span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198220"><span class="annot"><span class="annottext">thereAre :: TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621679198220"><span class="hs-identifier hs-var hs-var">thereAre</span></a></span></span><span> </span><span id="local-6989586621679198221"><span class="annot"><span class="annottext">TwoWay (Defns (f a) (g b))
</span><a href="#local-6989586621679198221"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay Bool -&gt; Bool
</span><a href="Unison.Merge.TwoWay.html#or"><span class="hs-identifier hs-var">TwoWay.or</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (Defns (f a) (g b) -&gt; Bool) -&gt; Defns (f a) (g b) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Defns (f a) (g b) -&gt; Bool
forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">(Defns (f a) (g b) -&gt; Bool)
-&gt; TwoWay (Defns (f a) (g b)) -&gt; TwoWay Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (Defns (f a) (g b))
</span><a href="#local-6989586621679198221"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Bool
forall {f :: * -&gt; *} {g :: * -&gt; *} {a} {b}.
(Foldable f, Foldable g) =&gt;
TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621679198220"><span class="hs-identifier hs-var">thereAre</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198200"><span class="hs-identifier hs-var">conflicts</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Bool
forall {f :: * -&gt; *} {g :: * -&gt; *} {a} {b}.
(Foldable f, Foldable g) =&gt;
TwoWay (Defns (f a) (g b)) -&gt; Bool
</span><a href="#local-6989586621679198220"><span class="hs-identifier hs-var">thereAre</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198201"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-423"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-424"></span><span>              </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-425"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;-- The definitions below are not conflicted, but they each depend on one or more\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-426"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;-- conflicted definitions above.\n\n&quot;</span></span><span>
</span><span id="line-427"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-428"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-429"></span><span>      </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyDependents"><span class="hs-identifier hs-var">makePrettyDependents</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198201"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-432"></span><span>    </span><span id="local-6989586621679198213"><span class="annot"><span class="annottext">prettyBinding :: Maybe m -&gt; m -&gt; m
</span><a href="#local-6989586621679198213"><span class="hs-identifier hs-var hs-var">prettyBinding</span></a></span></span><span> </span><span id="local-6989586621679198239"><span class="annot"><span class="annottext">Maybe m
</span><a href="#local-6989586621679198239"><span class="hs-identifier hs-var">maybeComment</span></a></span></span><span> </span><span id="local-6989586621679198240"><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621679198240"><span class="hs-identifier hs-var">binding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-433"></span><span>      </span><span class="annot"><span class="annottext">[m] -&gt; m
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-434"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe m
</span><a href="#local-6989586621679198239"><span class="hs-identifier hs-var">maybeComment</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-435"></span><span>            </span><span class="annot"><span class="annottext">Maybe m
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-436"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679198241"><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621679198241"><span class="hs-identifier hs-var">comment</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;-- &quot;</span></span><span> </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621679198241"><span class="hs-identifier hs-var">comment</span></a></span><span> </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-437"></span><span>          </span><span class="annot"><span class="annottext">m
</span><a href="#local-6989586621679198240"><span class="hs-identifier hs-var">binding</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-438"></span><span>          </span><span class="annot"><span class="annottext">m
</span><span class="hs-string">&quot;\n\n&quot;</span></span><span>
</span><span id="line-439"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makePrettySoloUnisonFile"><span class="hs-identifier hs-type">makePrettySoloUnisonFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-442"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-444"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span>
</span><span id="line-445"></span><span id="makePrettySoloUnisonFile"><span class="annot"><span class="annottext">makePrettySoloUnisonFile :: DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettySoloUnisonFile"><span class="hs-identifier hs-var hs-var">makePrettySoloUnisonFile</span></a></span></span><span> </span><span id="local-6989586621679198242"><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198242"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span> </span><span id="local-6989586621679198243"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198243"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-446"></span><span>  </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198242"><span class="hs-identifier hs-var">conflicts</span></a></span><span>
</span><span id="line-448"></span><span>        </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
    -&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText))
-&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText)
forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="Unison.Merge.Mergeblob3.html#inAlphabeticalOrder"><span class="hs-identifier hs-var">inAlphabeticalOrder</span></a></span><span>
</span><span id="line-449"></span><span>        </span><span class="annot"><span class="annottext">DefnsF [] (Pretty ColorText) (Pretty ColorText)
-&gt; (DefnsF [] (Pretty ColorText) (Pretty ColorText)
    -&gt; Pretty ColorText)
-&gt; Pretty ColorText
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198249"><span class="annot"><span class="annottext">f :: [Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198249"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; [Pretty ColorText] -&gt; Pretty ColorText
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;\n\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; ([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText)
-&gt; Pretty ColorText
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198249"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198249"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-450"></span><span>      </span><span class="hs-comment">-- Show message that delineates where conflicts end and dependents begin only when there are both conflicts and</span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-comment">-- dependents</span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText) -&gt; Bool
forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
</span><a href="#local-6989586621679198242"><span class="hs-identifier hs-var">conflicts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay Bool -&gt; Bool
</span><a href="Unison.Merge.TwoWay.html#or"><span class="hs-identifier hs-var">TwoWay.or</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
    -&gt; Bool)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText) -&gt; Bool
forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Foldable f, Foldable g) =&gt;
Defns (f a) (g b) -&gt; Bool
</span><span class="hs-identifier hs-var">defnsAreEmpty</span></span><span> </span><span class="annot"><span class="annottext">(DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText) -&gt; Bool)
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; TwoWay Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198243"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-454"></span><span>          </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span>
</span><span id="line-455"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;-- The definitions below are not conflicted, but they each depend on one or more\n&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-456"></span><span>              </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;-- conflicted definitions.\n\n&quot;</span></span><span>
</span><span id="line-457"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-458"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-459"></span><span>      </span><span class="hs-comment">-- Include all dependents when invoking this function with alice/bob/lca conflicts, because we don't want any diff</span><span>
</span><span id="line-460"></span><span>      </span><span class="hs-comment">-- here &#8211; we want the mergetool to copy over all dependents after resolving the real conflicts above the fold.</span><span>
</span><span id="line-461"></span><span>      </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyDependents"><span class="hs-identifier hs-var">makePrettyDependents</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
</span><a href="#local-6989586621679198243"><span class="hs-identifier hs-var">dependents</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makePrettyDependents"><span class="hs-identifier hs-type">makePrettyDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ColorText</span></span><span>
</span><span id="line-465"></span><span id="makePrettyDependents"><span class="annot"><span class="annottext">makePrettyDependents :: TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
</span><a href="Unison.Merge.Mergeblob3.html#makePrettyDependents"><span class="hs-identifier hs-var hs-var">makePrettyDependents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-comment">-- Merge dependents together into one map (they are disjoint)</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><span class="annottext">(DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall a b. (a -&gt; a -&gt; b) -&gt; TwoWay a -&gt; b
</span><a href="Unison.Merge.TwoWay.html#twoWay"><span class="hs-identifier hs-var">TwoWay.twoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Name (Pretty ColorText)
 -&gt; Map Name (Pretty ColorText) -&gt; Map Name (Pretty ColorText))
-&gt; (Map Name (Pretty ColorText)
    -&gt; Map Name (Pretty ColorText) -&gt; Map Name (Pretty ColorText))
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
forall tm1 tm2 tm3 ty1 ty2 ty3.
(tm1 -&gt; tm2 -&gt; tm3)
-&gt; (ty1 -&gt; ty2 -&gt; ty3)
-&gt; Defns tm1 ty1
-&gt; Defns tm2 ty2
-&gt; Defns tm3 ty3
</span><span class="hs-identifier hs-var">zipDefnsWith</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
-&gt; Map Name (Pretty ColorText) -&gt; Map Name (Pretty ColorText)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">Map Name (Pretty ColorText)
-&gt; Map Name (Pretty ColorText) -&gt; Map Name (Pretty ColorText)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><span class="annottext">(TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
 -&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
    -&gt; Pretty ColorText)
-&gt; TwoWay (DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText))
-&gt; Pretty ColorText
forall {k} (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-comment">-- Sort alphabetically</span><span>
</span><span id="line-470"></span><span>    </span><span class="annot"><span class="annottext">DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText)
forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="Unison.Merge.Mergeblob3.html#inAlphabeticalOrder"><span class="hs-identifier hs-var">inAlphabeticalOrder</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-comment">-- Render each dependent, types then terms, without bothering to comment attribution</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><span class="annottext">(DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
 -&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText))
-&gt; (DefnsF [] (Pretty ColorText) (Pretty ColorText)
    -&gt; Pretty ColorText)
-&gt; DefnsF (Map Name) (Pretty ColorText) (Pretty ColorText)
-&gt; Pretty ColorText
forall {k} (cat :: k -&gt; k -&gt; *) (a :: k) (b :: k) (c :: k).
Category cat =&gt;
cat a b -&gt; cat b c -&gt; cat a c
</span><span class="hs-operator hs-var">&gt;&gt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198257"><span class="annot"><span class="annottext">f :: [Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198257"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Pretty ColorText)
-&gt; [Pretty ColorText] -&gt; Pretty ColorText
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;\n\n&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; ([Pretty ColorText] -&gt; Pretty ColorText)
-&gt; DefnsF [] (Pretty ColorText) (Pretty ColorText)
-&gt; Pretty ColorText
forall m a b. Monoid m =&gt; (a -&gt; m) -&gt; (b -&gt; m) -&gt; Defns a b -&gt; m
forall (p :: * -&gt; * -&gt; *) m a b.
(Bifoldable p, Monoid m) =&gt;
(a -&gt; m) -&gt; (b -&gt; m) -&gt; p a b -&gt; m
</span><span class="hs-identifier hs-var">bifoldMap</span></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198257"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
</span><a href="#local-6989586621679198257"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span id="local-6989586621679197644"><span id="local-6989586621679197645"><span class="annot"><a href="Unison.Merge.Mergeblob3.html#inAlphabeticalOrder"><span class="hs-identifier hs-type">inAlphabeticalOrder</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679197644"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197645"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679197644"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197645"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-475"></span><span id="inAlphabeticalOrder"><span class="annot"><span class="annottext">inAlphabeticalOrder :: forall a b. DefnsF (Map Name) a b -&gt; DefnsF [] a b
</span><a href="Unison.Merge.Mergeblob3.html#inAlphabeticalOrder"><span class="hs-identifier hs-var hs-var">inAlphabeticalOrder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-476"></span><span>  </span><span class="annot"><span class="annottext">(Map Name a -&gt; [a])
-&gt; (Map Name b -&gt; [b])
-&gt; Defns (Map Name a) (Map Name b)
-&gt; Defns [a] [b]
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Defns a c -&gt; Defns b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">Map Name a -&gt; [a]
forall {b}. Map Name b -&gt; [b]
</span><a href="#local-6989586621679198259"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name b -&gt; [b]
forall {b}. Map Name b -&gt; [b]
</span><a href="#local-6989586621679198259"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-478"></span><span>    </span><span id="local-6989586621679198259"><span class="annot"><span class="annottext">f :: Map Name b -&gt; [b]
</span><a href="#local-6989586621679198259"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, b) -&gt; b) -&gt; [(Name, b)] -&gt; [b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Name, b)] -&gt; [b])
-&gt; (Map Name b -&gt; [(Name, b)]) -&gt; Map Name b -&gt; [b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, b) -&gt; Text) -&gt; [(Name, b)] -&gt; [(Name, b)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Text
</span><span class="hs-identifier hs-var">Name.toText</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Text) -&gt; ((Name, b) -&gt; Name) -&gt; (Name, b) -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Name, b) -&gt; Name
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, b)] -&gt; [(Name, b)])
-&gt; (Map Name b -&gt; [(Name, b)]) -&gt; Map Name b -&gt; [(Name, b)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name b -&gt; [(Name, b)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="hs-comment">-- Given Alice's and Bob's hydrated defns, make a mapping from unique type name to unique type GUID, preferring Alice's</span><span>
</span><span id="line-481"></span><span class="hs-comment">-- GUID if they both have one.</span><span>
</span><span id="line-482"></span><span class="annot"><a href="Unison.Merge.Mergeblob3.html#makeUniqueTypeGuids"><span class="hs-identifier hs-type">makeUniqueTypeGuids</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-483"></span><span>  </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span>
</span><span id="line-485"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-489"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-490"></span><span id="makeUniqueTypeGuids"><span class="annot"><span class="annottext">makeUniqueTypeGuids :: TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
-&gt; Map Name Text
</span><a href="Unison.Merge.Mergeblob3.html#makeUniqueTypeGuids"><span class="hs-identifier hs-var hs-var">makeUniqueTypeGuids</span></a></span></span><span> </span><span id="local-6989586621679198265"><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679198265"><span class="hs-identifier hs-var">hydratedDefns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-491"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Start off with just Alice's GUIDs</span><span>
</span><span id="line-492"></span><span>      </span><span class="annot"><a href="#local-6989586621679198266"><span class="hs-identifier hs-type">aliceGuids</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-493"></span><span>      </span><span id="local-6989586621679198266"><span class="annot"><span class="annottext">aliceGuids :: Map Name Text
</span><a href="#local-6989586621679198266"><span class="hs-identifier hs-var hs-var">aliceGuids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-494"></span><span>        </span><span class="annot"><span class="annottext">((TermReferenceId, Decl Symbol Ann) -&gt; Maybe Text)
-&gt; Map Name (TermReferenceId, Decl Symbol Ann) -&gt; Map Name Text
forall a b k. (a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; Maybe Text
forall v a. Decl v a -&gt; Maybe Text
</span><a href="#local-6989586621679198268"><span class="hs-identifier hs-var">declGuid</span></a></span><span> </span><span class="annot"><span class="annottext">(Decl Symbol Ann -&gt; Maybe Text)
-&gt; ((TermReferenceId, Decl Symbol Ann) -&gt; Decl Symbol Ann)
-&gt; (TermReferenceId, Decl Symbol Ann)
-&gt; Maybe Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TermReferenceId, Decl Symbol Ann) -&gt; Decl Symbol Ann
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679198265"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-comment">-- Define a helper that adds a Bob GUID only if it's not already in the map (so, preferring Alice)</span><span>
</span><span id="line-497"></span><span>      </span><span class="annot"><a href="#local-6989586621679198269"><span class="hs-identifier hs-type">addBobGuid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-498"></span><span>      </span><span id="local-6989586621679198269"><span class="annot"><span class="annottext">addBobGuid :: Map Name Text
-&gt; (Name, (TermReferenceId, Decl Symbol Ann)) -&gt; Map Name Text
</span><a href="#local-6989586621679198269"><span class="hs-identifier hs-var hs-var">addBobGuid</span></a></span></span><span> </span><span id="local-6989586621679198270"><span class="annot"><span class="annottext">Map Name Text
</span><a href="#local-6989586621679198270"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679198271"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679198271"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermReferenceId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679198272"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679198272"><span class="hs-identifier hs-var">bobDecl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-499"></span><span>        </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Maybe Text)
-&gt; Name -&gt; Map Name Text -&gt; Map Name Text
forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.alter</span></span><span>
</span><span id="line-500"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-501"></span><span>              </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679198274"><span class="hs-identifier hs-var">bobGuid</span></a></span><span>
</span><span id="line-502"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679198275"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679198275"><span class="hs-identifier hs-var">aliceGuid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679198275"><span class="hs-identifier hs-var">aliceGuid</span></a></span><span>
</span><span id="line-503"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>          </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679198271"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-505"></span><span>          </span><span class="annot"><span class="annottext">Map Name Text
</span><a href="#local-6989586621679198270"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-506"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-507"></span><span>          </span><span class="annot"><a href="#local-6989586621679198274"><span class="hs-identifier hs-type">bobGuid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-508"></span><span>          </span><span id="local-6989586621679198274"><span class="annot"><span class="annottext">bobGuid :: Maybe Text
</span><a href="#local-6989586621679198274"><span class="hs-identifier hs-var hs-var">bobGuid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-509"></span><span>            </span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; Maybe Text
forall v a. Decl v a -&gt; Maybe Text
</span><a href="#local-6989586621679198268"><span class="hs-identifier hs-var">declGuid</span></a></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679198272"><span class="hs-identifier hs-var">bobDecl</span></a></span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span>      </span><span class="hs-comment">-- Tumble in all of Bob's GUIDs with that helper</span><span>
</span><span id="line-512"></span><span>      </span><span class="annot"><a href="#local-6989586621679198276"><span class="hs-identifier hs-type">allTheGuids</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-513"></span><span>      </span><span id="local-6989586621679198276"><span class="annot"><span class="annottext">allTheGuids :: Map Name Text
</span><a href="#local-6989586621679198276"><span class="hs-identifier hs-var hs-var">allTheGuids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-514"></span><span>        </span><span class="annot"><span class="annottext">(Map Name Text
 -&gt; (Name, (TermReferenceId, Decl Symbol Ann)) -&gt; Map Name Text)
-&gt; Map Name Text
-&gt; [(Name, (TermReferenceId, Decl Symbol Ann))]
-&gt; Map Name Text
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map Name Text
-&gt; (Name, (TermReferenceId, Decl Symbol Ann)) -&gt; Map Name Text
</span><a href="#local-6989586621679198269"><span class="hs-identifier hs-var">addBobGuid</span></a></span><span> </span><span class="annot"><span class="annottext">Map Name Text
</span><a href="#local-6989586621679198266"><span class="hs-identifier hs-var">aliceGuids</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; [(Name, (TermReferenceId, Decl Symbol Ann))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">TwoWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679198265"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Map Name Text
</span><a href="#local-6989586621679198276"><span class="hs-identifier hs-var">allTheGuids</span></a></span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-517"></span><span>    </span><span id="local-6989586621679197678"><span id="local-6989586621679197679"><span class="annot"><a href="#local-6989586621679198268"><span class="hs-identifier hs-type">declGuid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><a href="#local-6989586621679197678"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679197679"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span></span><span>
</span><span id="line-518"></span><span>    </span><span id="local-6989586621679198268"><span class="annot"><span class="annottext">declGuid :: forall v a. Decl v a -&gt; Maybe Text
</span><a href="#local-6989586621679198268"><span class="hs-identifier hs-var hs-var">declGuid</span></a></span></span><span> </span><span id="local-6989586621679198279"><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621679198279"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-519"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decl v a -&gt; DataDeclaration v a
forall v a. Decl v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var">DataDeclaration.asDataDecl</span></span><span> </span><span class="annot"><span class="annottext">Decl v a
</span><a href="#local-6989586621679198279"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span class="hs-operator">.</span><span class="hs-identifier">modifier</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-520"></span><span>        </span><span class="annot"><span class="annottext">Modifier
</span><span class="hs-identifier hs-var">DataDeclaration.Structural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-521"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">DataDeclaration.Unique</span></span><span> </span><span id="local-6989586621679198283"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679198283"><span class="hs-identifier hs-var">guid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679198283"><span class="hs-identifier hs-var">guid</span></a></span><span>
</span><span id="line-522"></span></pre></body></html>