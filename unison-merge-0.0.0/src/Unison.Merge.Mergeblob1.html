<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Merge.Mergeblob1</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#Mergeblob1"><span class="hs-identifier">Mergeblob1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#hydratedDefnsLabeledDependencies"><span class="hs-identifier">hydratedDefnsLabeledDependencies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#makeMergeblob1"><span class="hs-identifier">makeMergeblob1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">where</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Decl</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DataDeclaration</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration.Dependencies</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Decl</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DeclNameLookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DeclNameLookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.LabeledDependency</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LD</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.CombineDiffs.html"><span class="hs-identifier">Unison.Merge.CombineDiffs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.CombineDiffs.html#CombinedDiffOp"><span class="hs-identifier">CombinedDiffOp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Merge.CombineDiffs.html#combineDiffs"><span class="hs-identifier">combineDiffs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.DeclCoherencyCheck.html"><span class="hs-identifier">Unison.Merge.DeclCoherencyCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.DeclCoherencyCheck.html#IncoherentDeclReason"><span class="hs-identifier">IncoherentDeclReason</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Merge.DeclCoherencyCheck.html#checkDeclCoherency"><span class="hs-identifier">checkDeclCoherency</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Merge.DeclCoherencyCheck.html#lenientCheckDeclCoherency"><span class="hs-identifier">lenientCheckDeclCoherency</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Diff.html"><span class="hs-identifier">Unison.Merge.Diff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Diff.html#humanizeDiffs"><span class="hs-identifier">humanizeDiffs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Merge.Diff.html#nameBasedNamespaceDiff"><span class="hs-identifier">nameBasedNamespaceDiff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.DiffOp.html"><span class="hs-identifier">Unison.Merge.DiffOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.DiffOp.html#DiffOp"><span class="hs-identifier">DiffOp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.EitherWay.html"><span class="hs-identifier">Unison.Merge.EitherWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.EitherWay.html#EitherWay"><span class="hs-identifier">EitherWay</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.HumanDiffOp.html"><span class="hs-identifier">Unison.Merge.HumanDiffOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.HumanDiffOp.html#HumanDiffOp"><span class="hs-identifier">HumanDiffOp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Libdeps.html"><span class="hs-identifier">Unison.Merge.Libdeps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Libdeps.html#applyLibdepsDiff"><span class="hs-identifier">applyLibdepsDiff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Merge.Libdeps.html#diffLibdeps"><span class="hs-identifier">diffLibdeps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Merge.Libdeps.html#getTwoFreshLibdepNames"><span class="hs-identifier">getTwoFreshLibdepNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Merge.Libdeps.html#mergeLibdepsDiffs"><span class="hs-identifier">mergeLibdepsDiffs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Mergeblob0.html"><span class="hs-identifier">Unison.Merge.Mergeblob0</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Mergeblob0.html#Mergeblob0"><span class="hs-identifier">Mergeblob0</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.PartialDeclNameLookup.html"><span class="hs-identifier">Unison.Merge.PartialDeclNameLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.PartialDeclNameLookup.html#PartialDeclNameLookup"><span class="hs-identifier">PartialDeclNameLookup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.PartitionCombinedDiffs.html"><span class="hs-identifier">Unison.Merge.PartitionCombinedDiffs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.PartitionCombinedDiffs.html#partitionCombinedDiffs"><span class="hs-identifier">partitionCombinedDiffs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Synhashed.html"><span class="hs-identifier">Unison.Merge.Synhashed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Synhashed.html#Synhashed"><span class="hs-identifier">Synhashed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html"><span class="hs-identifier">Unison.Merge.ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier">ThreeWay</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.ThreeWay.html"><span class="hs-identifier">Unison.Merge.ThreeWay</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ThreeWay</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html"><span class="hs-identifier">Unison.Merge.TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html"><span class="hs-identifier">Unison.Merge.Unconflicts</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier">Unconflicts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl.Names</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReferenceId</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.BiMultimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BiMultimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Defns</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DefnsF3</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">data</span><span> </span><span id="Mergeblob1"><span class="annot"><a href="Unison.Merge.Mergeblob1.html#Mergeblob1"><span class="hs-identifier hs-var">Mergeblob1</span></a></span></span><span> </span><span id="local-6989586621679196723"><span class="annot"><a href="#local-6989586621679196723"><span class="hs-identifier hs-type">libdep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Mergeblob1"><span class="annot"><a href="Unison.Merge.Mergeblob1.html#Mergeblob1"><span class="hs-identifier hs-var">Mergeblob1</span></a></span></span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aconflicts%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep.
Mergeblob1 libdep
-&gt; TwoWay (DefnsF (Map Name) TermReference TermReference)
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Aconflicts%3AMergeblob1"><span class="hs-identifier hs-var hs-var">conflicts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span id="%24sel%3AdeclNameLookups%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep. Mergeblob1 libdep -&gt; TwoWay DeclNameLookup
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AdeclNameLookups%3AMergeblob1"><span class="hs-identifier hs-var hs-var">declNameLookups</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DeclNameLookup</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span id="%24sel%3Adefns%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep.
Mergeblob1 libdep
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Adefns%3AMergeblob1"><span class="hs-identifier hs-var hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BiMultimap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span id="%24sel%3Adiff%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep.
Mergeblob1 libdep
-&gt; DefnsF2 (Map Name) CombinedDiffOp Referent TermReference
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Adiff%3AMergeblob1"><span class="hs-identifier hs-var hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Unison.Merge.CombineDiffs.html#CombinedDiffOp"><span class="hs-identifier hs-type">CombinedDiffOp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span id="%24sel%3AdiffsFromLCA%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep.
Mergeblob1 libdep
-&gt; TwoWay
     (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AdiffsFromLCA%3AMergeblob1"><span class="hs-identifier hs-var hs-var">diffsFromLCA</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Unison.Merge.DiffOp.html#DiffOp"><span class="hs-identifier hs-type">DiffOp</span></a></span><span> </span><span class="annot"><a href="Unison.Merge.Synhashed.html#Synhashed"><span class="hs-identifier hs-type">Synhashed</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span id="%24sel%3AhumanDiffsFromLCA%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep.
Mergeblob1 libdep
-&gt; TwoWay (DefnsF2 (Map Name) HumanDiffOp Referent TermReference)
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AhumanDiffsFromLCA%3AMergeblob1"><span class="hs-identifier hs-var hs-var">humanDiffsFromLCA</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DefnsF2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Unison.Merge.HumanDiffOp.html#HumanDiffOp"><span class="hs-identifier hs-type">HumanDiffOp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span id="%24sel%3AhydratedDefns%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep.
Mergeblob1 libdep
-&gt; ThreeWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AhydratedDefns%3AMergeblob1"><span class="hs-identifier hs-var hs-var">hydratedDefns</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span>
</span><span id="line-60"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span>
</span><span id="line-61"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>        </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>    </span><span id="%24sel%3AlcaDeclNameLookup%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep. Mergeblob1 libdep -&gt; PartialDeclNameLookup
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AlcaDeclNameLookup%3AMergeblob1"><span class="hs-identifier hs-var hs-var">lcaDeclNameLookup</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.PartialDeclNameLookup.html#PartialDeclNameLookup"><span class="hs-identifier hs-type">PartialDeclNameLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>    </span><span id="%24sel%3AlcaLibdeps%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep. Mergeblob1 libdep -&gt; Map NameSegment libdep
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AlcaLibdeps%3AMergeblob1"><span class="hs-identifier hs-var hs-var">lcaLibdeps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679196723"><span class="hs-identifier hs-type">libdep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span id="%24sel%3Alibdeps%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep. Mergeblob1 libdep -&gt; Map NameSegment libdep
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Alibdeps%3AMergeblob1"><span class="hs-identifier hs-var hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679196723"><span class="hs-identifier hs-type">libdep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span id="%24sel%3AlibdepsDiffs%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep.
Mergeblob1 libdep -&gt; TwoWay (Map NameSegment (DiffOp libdep))
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AlibdepsDiffs%3AMergeblob1"><span class="hs-identifier hs-var hs-var">libdepsDiffs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.DiffOp.html#DiffOp"><span class="hs-identifier hs-type">DiffOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679196723"><span class="hs-identifier hs-type">libdep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span id="%24sel%3Aunconflicts%3AMergeblob1"><span class="annot"><span class="annottext">forall libdep.
Mergeblob1 libdep -&gt; DefnsF Unconflicts Referent TermReference
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Aunconflicts%3AMergeblob1"><span class="hs-identifier hs-var hs-var">unconflicts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span> </span><span class="annot"><a href="Unison.Merge.Unconflicts.html#Unconflicts"><span class="hs-identifier hs-type">Unconflicts</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><span class="hs-comment">-- | Get a names object for all the hydrated definitions AND their direct dependencies</span></span><span>
</span><span id="line-73"></span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#hydratedDefnsLabeledDependencies"><span class="hs-identifier hs-type">hydratedDefnsLabeledDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LD.LabeledDependency</span></span><span>
</span><span id="line-79"></span><span id="hydratedDefnsLabeledDependencies"><span class="annot"><span class="annottext">hydratedDefnsLabeledDependencies :: DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
-&gt; Set LabeledDependency
</span><a href="Unison.Merge.Mergeblob1.html#hydratedDefnsLabeledDependencies"><span class="hs-identifier hs-var hs-var">hydratedDefnsLabeledDependencies</span></a></span></span><span> </span><span id="local-6989586621679196918"><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679196918"><span class="hs-identifier hs-var">defns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679196919"><span class="hs-identifier hs-type">termDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LD.LabeledDependency</span></span><span>
</span><span id="line-81"></span><span>      </span><span id="local-6989586621679196919"><span class="annot"><span class="annottext">termDeps :: Set LabeledDependency
</span><a href="#local-6989586621679196919"><span class="hs-identifier hs-var hs-var">termDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><span class="annottext">Getting
  (Set LabeledDependency)
  (Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
  (Set LabeledDependency)
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Set LabeledDependency
forall a s. Getting a s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">foldOf</span></span><span>
</span><span id="line-83"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Const
      (Set LabeledDependency)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
-&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Const
     (Set LabeledDependency)
     (Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
forall (f :: * -&gt; *) a. Foldable f =&gt; IndexedFold Int (f a) a
IndexedFold
  Int
  (Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
</span><span class="hs-identifier hs-var">folded</span></span><span>
</span><span id="line-84"></span><span>              </span><span class="annot"><span class="annottext">(((TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  -&gt; Const
       (Set LabeledDependency)
       (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
 -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Const
      (Set LabeledDependency)
      (Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))))
-&gt; ((Set LabeledDependency
     -&gt; Const (Set LabeledDependency) (Set LabeledDependency))
    -&gt; (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
    -&gt; Const
         (Set LabeledDependency)
         (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
-&gt; Getting
     (Set LabeledDependency)
     (Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
     (Set LabeledDependency)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Optical
  (-&gt;)
  (-&gt;)
  (Const (Set LabeledDependency))
  TermReferenceId
  TermReferenceId
  (Set LabeledDependency)
  (Set LabeledDependency)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     (Term Symbol Ann, Type Symbol Ann)
     (Term Symbol Ann, Type Symbol Ann)
     (Set LabeledDependency)
     (Set LabeledDependency)
-&gt; (Set LabeledDependency
    -&gt; Const (Set LabeledDependency) (Set LabeledDependency))
-&gt; (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; Const
     (Set LabeledDependency)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
forall (q :: * -&gt; * -&gt; *) (f :: * -&gt; *) (r :: * -&gt; * -&gt; *)
       (p :: * -&gt; * -&gt; *) s t a b s' t'.
(Representable q, Applicative (Rep q), Applicative f,
 Bitraversable r) =&gt;
Optical p q f s t a b
-&gt; Optical p q f s' t' a b -&gt; Optical p q f (r s s') (r t t') a b
</span><span class="hs-identifier hs-var">beside</span></span><span>
</span><span id="line-85"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TermReferenceId -&gt; TermReference)
-&gt; Optic'
     (-&gt;) (Const (Set LabeledDependency)) TermReferenceId TermReference
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId -&gt; TermReference
forall h t. Id' h -&gt; Reference' t h
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  (-&gt;) (Const (Set LabeledDependency)) TermReferenceId TermReference
-&gt; ((Set LabeledDependency
     -&gt; Const (Set LabeledDependency) (Set LabeledDependency))
    -&gt; TermReference -&gt; Const (Set LabeledDependency) TermReference)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     TermReferenceId
     TermReferenceId
     (Set LabeledDependency)
     (Set LabeledDependency)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TermReference -&gt; LabeledDependency)
-&gt; Optic'
     (-&gt;)
     (Const (Set LabeledDependency))
     TermReference
     LabeledDependency
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">TermReference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.TermReference</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  (-&gt;)
  (Const (Set LabeledDependency))
  TermReference
  LabeledDependency
-&gt; ((Set LabeledDependency
     -&gt; Const (Set LabeledDependency) (Set LabeledDependency))
    -&gt; LabeledDependency
    -&gt; Const (Set LabeledDependency) LabeledDependency)
-&gt; (Set LabeledDependency
    -&gt; Const (Set LabeledDependency) (Set LabeledDependency))
-&gt; TermReference
-&gt; Const (Set LabeledDependency) TermReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LabeledDependency -&gt; Set LabeledDependency)
-&gt; (Set LabeledDependency
    -&gt; Const (Set LabeledDependency) (Set LabeledDependency))
-&gt; LabeledDependency
-&gt; Const (Set LabeledDependency) LabeledDependency
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">LabeledDependency -&gt; Set LabeledDependency
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optical
  (-&gt;)
  (-&gt;)
  (Const (Set LabeledDependency))
  (Term Symbol Ann)
  (Term Symbol Ann)
  (Set LabeledDependency)
  (Set LabeledDependency)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     (Type Symbol Ann)
     (Type Symbol Ann)
     (Set LabeledDependency)
     (Set LabeledDependency)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     (Term Symbol Ann, Type Symbol Ann)
     (Term Symbol Ann, Type Symbol Ann)
     (Set LabeledDependency)
     (Set LabeledDependency)
forall (q :: * -&gt; * -&gt; *) (f :: * -&gt; *) (r :: * -&gt; * -&gt; *)
       (p :: * -&gt; * -&gt; *) s t a b s' t'.
(Representable q, Applicative (Rep q), Applicative f,
 Bitraversable r) =&gt;
Optical p q f s t a b
-&gt; Optical p q f s' t' a b -&gt; Optical p q f (r s s') (r t t') a b
</span><span class="hs-identifier hs-var">beside</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; Set LabeledDependency)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     (Term Symbol Ann)
     (Term Symbol Ann)
     (Set LabeledDependency)
     (Set LabeledDependency)
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Set LabeledDependency
forall v vt at ap a.
(Ord v, Ord vt) =&gt;
Term2 vt at ap v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Term.labeledDependencies</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type Symbol Ann -&gt; Set LabeledDependency)
-&gt; Optical
     (-&gt;)
     (-&gt;)
     (Const (Set LabeledDependency))
     (Type Symbol Ann)
     (Type Symbol Ann)
     (Set LabeledDependency)
     (Set LabeledDependency)
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Set LabeledDependency
forall v a. Ord v =&gt; Type v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Type.labeledDependencies</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>          </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679196918"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><a href="#local-6989586621679196930"><span class="hs-identifier hs-type">typeDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LD.LabeledDependency</span></span><span>
</span><span id="line-91"></span><span>      </span><span id="local-6989586621679196930"><span class="annot"><span class="annottext">typeDeps :: Set LabeledDependency
</span><a href="#local-6989586621679196930"><span class="hs-identifier hs-var hs-var">typeDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><span class="annottext">DefnsF
  (Map Name)
  (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
  (TermReferenceId, Decl Symbol Ann)
</span><a href="#local-6989586621679196918"><span class="hs-identifier hs-var">defns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span>
</span><span id="line-93"></span><span>          </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; (Map Name (TermReferenceId, Decl Symbol Ann)
    -&gt; Set LabeledDependency)
-&gt; Set LabeledDependency
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((TermReferenceId, Decl Symbol Ann) -&gt; Set LabeledDependency)
-&gt; Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; Set LabeledDependency
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Map Name a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679196933"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679196933"><span class="hs-identifier hs-var">typeRefId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679196934"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679196934"><span class="hs-identifier hs-var">typeDecl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-94"></span><span>            </span><span class="annot"><span class="annottext">TermReference -&gt; Decl Symbol Ann -&gt; Set LabeledDependency
forall v a.
Var v =&gt;
TermReference -&gt; Decl v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Decl.labeledDeclDependenciesIncludingSelfAndFieldAccessors</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermReferenceId -&gt; TermReference
forall h t. Id' h -&gt; Reference' t h
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679196933"><span class="hs-identifier hs-var">typeRefId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679196934"><span class="hs-identifier hs-var">typeDecl</span></a></span><span>
</span><span id="line-95"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679196919"><span class="hs-identifier hs-var">termDeps</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679196930"><span class="hs-identifier hs-var">typeDeps</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#makeMergeblob1"><span class="hs-identifier hs-type">makeMergeblob1</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679196799"><span class="annot"><a href="#local-6989586621679196799"><span class="hs-identifier hs-type">libdep</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679196799"><span class="hs-identifier hs-type">libdep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Unison.Merge.Mergeblob0.html#Mergeblob0"><span class="hs-identifier hs-type">Mergeblob0</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679196799"><span class="hs-identifier hs-type">libdep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-comment">{- Names for _at least_ every reference in 'hydratedDefnDependencies' -}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DefnsF</span></span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.EitherWay.html#EitherWay"><span class="hs-identifier hs-type">EitherWay</span></a></span><span> </span><span class="annot"><a href="Unison.Merge.DeclCoherencyCheck.html#IncoherentDeclReason"><span class="hs-identifier hs-type">IncoherentDeclReason</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#Mergeblob1"><span class="hs-identifier hs-type">Mergeblob1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679196799"><span class="hs-identifier hs-type">libdep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span id="makeMergeblob1"><span class="annot"><span class="annottext">makeMergeblob1 :: forall libdep.
Eq libdep =&gt;
Mergeblob0 libdep
-&gt; ThreeWay Names
-&gt; ThreeWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; Either (EitherWay IncoherentDeclReason) (Mergeblob1 libdep)
</span><a href="Unison.Merge.Mergeblob1.html#makeMergeblob1"><span class="hs-identifier hs-var hs-var">makeMergeblob1</span></a></span></span><span> </span><span id="local-6989586621679196999"><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span></span><span> </span><span id="local-6989586621679197000"><span class="annot"><span class="annottext">ThreeWay Names
</span><a href="#local-6989586621679197000"><span class="hs-identifier hs-var">names3</span></a></span></span><span> </span><span id="local-6989586621679197001"><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679197001"><span class="hs-identifier hs-var">hydratedDefns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679197002"><span class="hs-identifier hs-type">ppeds3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.Internal.Types.html#ThreeWay"><span class="hs-identifier hs-type">ThreeWay</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPED.PrettyPrintEnvDecl</span></span><span>
</span><span id="line-111"></span><span>      </span><span id="local-6989586621679197002"><span class="annot"><span class="annottext">ppeds3 :: ThreeWay PrettyPrintEnvDecl
</span><a href="#local-6989586621679197002"><span class="hs-identifier hs-var hs-var">ppeds3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreeWay Names
</span><a href="#local-6989586621679197000"><span class="hs-identifier hs-var">names3</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay Names
-&gt; (Names -&gt; PrettyPrintEnvDecl) -&gt; ThreeWay PrettyPrintEnvDecl
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679197004"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679197004"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Namer -&gt; Suffixifier -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.makePPED</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Namer
</span><span class="hs-identifier hs-var">PPE.namer</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679197004"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Suffixifier
</span><span class="hs-identifier hs-var">PPE.suffixifyByHash</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679197004"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-comment">-- Make one big constructor count lookup for all type decls</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679197008"><span class="annot"><span class="annottext">numConstructors :: Map TermReferenceId Int
</span><a href="#local-6989586621679197008"><span class="hs-identifier hs-var hs-var">numConstructors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">Map TermReferenceId Int
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-115"></span><span>          </span><span class="annot"><span class="annottext">Map TermReferenceId Int
-&gt; (Map TermReferenceId Int -&gt; Map TermReferenceId Int)
-&gt; Map TermReferenceId Int
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(TermReferenceId, Decl Symbol Ann)]
-&gt; Map TermReferenceId Int -&gt; Map TermReferenceId Int
</span><a href="#local-6989586621679197010"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; [(TermReferenceId, Decl Symbol Ann)]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679197001"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>          </span><span class="annot"><span class="annottext">Map TermReferenceId Int
-&gt; (Map TermReferenceId Int -&gt; Map TermReferenceId Int)
-&gt; Map TermReferenceId Int
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(TermReferenceId, Decl Symbol Ann)]
-&gt; Map TermReferenceId Int -&gt; Map TermReferenceId Int
</span><a href="#local-6989586621679197010"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; [(TermReferenceId, Decl Symbol Ann)]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679197001"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>          </span><span class="annot"><span class="annottext">Map TermReferenceId Int
-&gt; (Map TermReferenceId Int -&gt; Map TermReferenceId Int)
-&gt; Map TermReferenceId Int
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(TermReferenceId, Decl Symbol Ann)]
-&gt; Map TermReferenceId Int -&gt; Map TermReferenceId Int
</span><a href="#local-6989586621679197010"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; [(TermReferenceId, Decl Symbol Ann)]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679197001"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>          </span><span class="annot"><a href="#local-6989586621679197010"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReferenceId</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-120"></span><span>          </span><span id="local-6989586621679197010"><span class="annot"><span class="annottext">f :: [(TermReferenceId, Decl Symbol Ann)]
-&gt; Map TermReferenceId Int -&gt; Map TermReferenceId Int
</span><a href="#local-6989586621679197010"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679197012"><span class="annot"><span class="annottext">[(TermReferenceId, Decl Symbol Ann)]
</span><a href="#local-6989586621679197012"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621679197013"><span class="annot"><span class="annottext">Map TermReferenceId Int
</span><a href="#local-6989586621679197013"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><span class="annottext">(Map TermReferenceId Int
 -&gt; (TermReferenceId, Decl Symbol Ann) -&gt; Map TermReferenceId Int)
-&gt; Map TermReferenceId Int
-&gt; [(TermReferenceId, Decl Symbol Ann)]
-&gt; Map TermReferenceId Int
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span>
</span><span id="line-122"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679197015"><span class="annot"><span class="annottext">Map TermReferenceId Int
</span><a href="#local-6989586621679197015"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679197016"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197016"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679197017"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679197017"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-123"></span><span>                  </span><span class="annot"><span class="annottext">TermReferenceId
-&gt; Int -&gt; Map TermReferenceId Int -&gt; Map TermReferenceId Int
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197016"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; Int
forall v a. DataDeclaration v a -&gt; Int
</span><span class="hs-identifier hs-var">DataDeclaration.constructorCount</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v a. Decl v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var">DataDeclaration.asDataDecl</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679197017"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TermReferenceId Int
</span><a href="#local-6989586621679197015"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-124"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>              </span><span class="annot"><span class="annottext">Map TermReferenceId Int
</span><a href="#local-6989586621679197013"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-126"></span><span>              </span><span class="annot"><span class="annottext">[(TermReferenceId, Decl Symbol Ann)]
</span><a href="#local-6989586621679197012"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-comment">-- Make Alice/Bob decl name lookups, which can fail if either have an incoherent decl</span><span>
</span><span id="line-129"></span><span>  </span><span id="local-6989586621679197021"><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679197021"><span class="hs-identifier hs-var">declNameLookups</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679197022"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679197022"><span class="hs-identifier hs-var">alice</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
Nametree (DefnsF (Map NameSegment) Referent TermReference)
-&gt; Map TermReferenceId Int
-&gt; Either IncoherentDeclReason DeclNameLookup
Nametree (DefnsF (Map NameSegment) Referent TermReference)
-&gt; Map TermReferenceId Int
-&gt; Either IncoherentDeclReason DeclNameLookup
</span><a href="Unison.Merge.DeclCoherencyCheck.html#checkDeclCoherency"><span class="hs-identifier hs-var">checkDeclCoherency</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">nametrees</span><span class="hs-operator">.</span><span class="hs-identifier">alice</span><span> </span><span class="annot"><span class="annottext">Map TermReferenceId Int
</span><a href="#local-6989586621679197008"><span class="hs-identifier hs-var">numConstructors</span></a></span><span> </span><span class="annot"><span class="annottext">Either IncoherentDeclReason DeclNameLookup
-&gt; (Either IncoherentDeclReason DeclNameLookup
    -&gt; Either (EitherWay IncoherentDeclReason) DeclNameLookup)
-&gt; Either (EitherWay IncoherentDeclReason) DeclNameLookup
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(IncoherentDeclReason -&gt; EitherWay IncoherentDeclReason)
-&gt; Either IncoherentDeclReason DeclNameLookup
-&gt; Either (EitherWay IncoherentDeclReason) DeclNameLookup
forall a c b. (a -&gt; c) -&gt; Either a b -&gt; Either c b
</span><span class="hs-identifier hs-var">mapLeft</span></span><span> </span><span class="annot"><span class="annottext">IncoherentDeclReason -&gt; EitherWay IncoherentDeclReason
forall a. a -&gt; EitherWay a
</span><a href="Unison.Merge.EitherWay.html#Alice"><span class="hs-identifier hs-var">Alice</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679197025"><span class="annot"><span class="annottext">DeclNameLookup
</span><a href="#local-6989586621679197025"><span class="hs-identifier hs-var">bob</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
Nametree (DefnsF (Map NameSegment) Referent TermReference)
-&gt; Map TermReferenceId Int
-&gt; Either IncoherentDeclReason DeclNameLookup
Nametree (DefnsF (Map NameSegment) Referent TermReference)
-&gt; Map TermReferenceId Int
-&gt; Either IncoherentDeclReason DeclNameLookup
</span><a href="Unison.Merge.DeclCoherencyCheck.html#checkDeclCoherency"><span class="hs-identifier hs-var">checkDeclCoherency</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">nametrees</span><span class="hs-operator">.</span><span class="hs-identifier">bob</span><span> </span><span class="annot"><span class="annottext">Map TermReferenceId Int
</span><a href="#local-6989586621679197008"><span class="hs-identifier hs-var">numConstructors</span></a></span><span> </span><span class="annot"><span class="annottext">Either IncoherentDeclReason DeclNameLookup
-&gt; (Either IncoherentDeclReason DeclNameLookup
    -&gt; Either (EitherWay IncoherentDeclReason) DeclNameLookup)
-&gt; Either (EitherWay IncoherentDeclReason) DeclNameLookup
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(IncoherentDeclReason -&gt; EitherWay IncoherentDeclReason)
-&gt; Either IncoherentDeclReason DeclNameLookup
-&gt; Either (EitherWay IncoherentDeclReason) DeclNameLookup
forall a c b. (a -&gt; c) -&gt; Either a b -&gt; Either c b
</span><span class="hs-identifier hs-var">mapLeft</span></span><span> </span><span class="annot"><span class="annottext">IncoherentDeclReason -&gt; EitherWay IncoherentDeclReason
forall a. a -&gt; EitherWay a
</span><a href="Unison.Merge.EitherWay.html#Bob"><span class="hs-identifier hs-var">Bob</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">DeclNameLookup
alice :: DeclNameLookup
$sel:alice:TwoWay :: DeclNameLookup
</span><a href="#local-6989586621679197022"><span class="hs-identifier hs-var hs-var">alice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DeclNameLookup
bob :: DeclNameLookup
$sel:bob:TwoWay :: DeclNameLookup
</span><a href="#local-6989586621679197025"><span class="hs-identifier hs-var hs-var">bob</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-comment">-- Make LCA decl name lookup</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679197030"><span class="annot"><span class="annottext">lcaDeclNameLookup :: PartialDeclNameLookup
</span><a href="#local-6989586621679197030"><span class="hs-identifier hs-var hs-var">lcaDeclNameLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">Nametree (DefnsF (Map NameSegment) Referent TermReference)
-&gt; Map TermReferenceId Int -&gt; PartialDeclNameLookup
</span><a href="Unison.Merge.DeclCoherencyCheck.html#lenientCheckDeclCoherency"><span class="hs-identifier hs-var">lenientCheckDeclCoherency</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">nametrees</span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span> </span><span class="annot"><span class="annottext">Map TermReferenceId Int
</span><a href="#local-6989586621679197008"><span class="hs-identifier hs-var">numConstructors</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-comment">-- Diff LCA-&gt;Alice and LCA-&gt;Bob</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679197031"><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
</span><a href="#local-6989586621679197031"><span class="hs-identifier hs-var">diffsFromLCA</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679197032"><span class="annot"><span class="annottext">TwoWay (DefnsF2 (Map Name) Updated Referent TermReference)
</span><a href="#local-6989586621679197032"><span class="hs-identifier hs-var">propagatedUpdates</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">HasCallStack =&gt;
TwoWay DeclNameLookup
-&gt; PartialDeclNameLookup
-&gt; ThreeWay PrettyPrintEnvDecl
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; Defns
     (Map TermReferenceId (Term Symbol Ann))
     (Map TermReferenceId (Decl Symbol Ann))
-&gt; (TwoWay
      (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference),
    TwoWay (DefnsF2 (Map Name) Updated Referent TermReference))
TwoWay DeclNameLookup
-&gt; PartialDeclNameLookup
-&gt; ThreeWay PrettyPrintEnvDecl
-&gt; ThreeWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; Defns
     (Map TermReferenceId (Term Symbol Ann))
     (Map TermReferenceId (Decl Symbol Ann))
-&gt; (TwoWay
      (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference),
    TwoWay (DefnsF2 (Map Name) Updated Referent TermReference))
</span><a href="Unison.Merge.Diff.html#nameBasedNamespaceDiff"><span class="hs-identifier hs-var">nameBasedNamespaceDiff</span></a></span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679197021"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span>
</span><span id="line-142"></span><span>          </span><span class="annot"><span class="annottext">PartialDeclNameLookup
</span><a href="#local-6989586621679197030"><span class="hs-identifier hs-var">lcaDeclNameLookup</span></a></span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><span class="annottext">ThreeWay PrettyPrintEnvDecl
</span><a href="#local-6989586621679197002"><span class="hs-identifier hs-var">ppeds3</span></a></span><span>
</span><span id="line-144"></span><span>          </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span>
</span><span id="line-145"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Defns</span></span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:terms:Defns :: Map TermReferenceId (Term Symbol Ann)
</span><span class="hs-identifier hs-var">terms</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-147"></span><span>                </span><span class="annot"><span class="annottext">(DefnsF
   (Map Name)
   (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
   (TermReferenceId, Decl Symbol Ann)
 -&gt; Map TermReferenceId (Term Symbol Ann))
-&gt; ThreeWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; Map TermReferenceId (Term Symbol Ann)
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ThreeWay a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-148"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map TermReferenceId (Term Symbol Ann)
 -&gt; (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; Map TermReferenceId (Term Symbol Ann))
-&gt; Map TermReferenceId (Term Symbol Ann)
-&gt; [(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))]
-&gt; Map TermReferenceId (Term Symbol Ann)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679197035"><span class="annot"><span class="annottext">Map TermReferenceId (Term Symbol Ann)
</span><a href="#local-6989586621679197035"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679197036"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197036"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679197037"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679197037"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermReferenceId
-&gt; Term Symbol Ann
-&gt; Map TermReferenceId (Term Symbol Ann)
-&gt; Map TermReferenceId (Term Symbol Ann)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197036"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679197037"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">Map TermReferenceId (Term Symbol Ann)
</span><a href="#local-6989586621679197035"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TermReferenceId (Term Symbol Ann)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">([(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))]
 -&gt; Map TermReferenceId (Term Symbol Ann))
-&gt; (DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
    -&gt; [(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))])
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; Map TermReferenceId (Term Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
-&gt; [(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
 -&gt; [(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))])
-&gt; (DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
    -&gt; Map Name (TermReferenceId, (Term Symbol Ann, Type Symbol Ann)))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; [(TermReferenceId, (Term Symbol Ann, Type Symbol Ann))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-identifier">terms</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>                  </span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679197001"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>              </span><span class="annot"><span class="annottext">$sel:types:Defns :: Map TermReferenceId (Decl Symbol Ann)
</span><span class="hs-identifier hs-var">types</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>                </span><span class="annot"><span class="annottext">(DefnsF
   (Map Name)
   (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
   (TermReferenceId, Decl Symbol Ann)
 -&gt; Map TermReferenceId (Decl Symbol Ann))
-&gt; ThreeWay
     (DefnsF
        (Map Name)
        (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
        (TermReferenceId, Decl Symbol Ann))
-&gt; Map TermReferenceId (Decl Symbol Ann)
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; ThreeWay a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-152"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map TermReferenceId (Decl Symbol Ann)
 -&gt; (TermReferenceId, Decl Symbol Ann)
 -&gt; Map TermReferenceId (Decl Symbol Ann))
-&gt; Map TermReferenceId (Decl Symbol Ann)
-&gt; [(TermReferenceId, Decl Symbol Ann)]
-&gt; Map TermReferenceId (Decl Symbol Ann)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">List.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679197039"><span class="annot"><span class="annottext">Map TermReferenceId (Decl Symbol Ann)
</span><a href="#local-6989586621679197039"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679197040"><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197040"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679197041"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679197041"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TermReferenceId
-&gt; Decl Symbol Ann
-&gt; Map TermReferenceId (Decl Symbol Ann)
-&gt; Map TermReferenceId (Decl Symbol Ann)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">TermReferenceId
</span><a href="#local-6989586621679197040"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679197041"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Map TermReferenceId (Decl Symbol Ann)
</span><a href="#local-6989586621679197039"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TermReferenceId (Decl Symbol Ann)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">([(TermReferenceId, Decl Symbol Ann)]
 -&gt; Map TermReferenceId (Decl Symbol Ann))
-&gt; (DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
    -&gt; [(TermReferenceId, Decl Symbol Ann)])
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; Map TermReferenceId (Decl Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Name (TermReferenceId, Decl Symbol Ann)
-&gt; [(TermReferenceId, Decl Symbol Ann)]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map Name (TermReferenceId, Decl Symbol Ann)
 -&gt; [(TermReferenceId, Decl Symbol Ann)])
-&gt; (DefnsF
      (Map Name)
      (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
      (TermReferenceId, Decl Symbol Ann)
    -&gt; Map Name (TermReferenceId, Decl Symbol Ann))
-&gt; DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann)
-&gt; [(TermReferenceId, Decl Symbol Ann)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-operator">.</span><span class="hs-identifier">types</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>                  </span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="#local-6989586621679197001"><span class="hs-identifier hs-var">hydratedDefns</span></a></span><span>
</span><span id="line-154"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-comment">-- Combine the LCA-&gt;Alice and LCA-&gt;Bob diffs together</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679197042"><span class="annot"><span class="annottext">diff :: DefnsF2 (Map Name) CombinedDiffOp Referent TermReference
</span><a href="#local-6989586621679197042"><span class="hs-identifier hs-var hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
-&gt; DefnsF2 (Map Name) CombinedDiffOp Referent TermReference
</span><a href="Unison.Merge.CombineDiffs.html#combineDiffs"><span class="hs-identifier hs-var">combineDiffs</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
</span><a href="#local-6989586621679197031"><span class="hs-identifier hs-var">diffsFromLCA</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679197043"><span class="annot"><span class="annottext">humanDiffsFromLCA :: TwoWay (DefnsF2 (Map Name) HumanDiffOp Referent TermReference)
</span><a href="#local-6989586621679197043"><span class="hs-identifier hs-var hs-var">humanDiffsFromLCA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreeWay Names
-&gt; TwoWay
     (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
-&gt; TwoWay (DefnsF2 (Map Name) Updated Referent TermReference)
-&gt; TwoWay (DefnsF2 (Map Name) HumanDiffOp Referent TermReference)
</span><a href="Unison.Merge.Diff.html#humanizeDiffs"><span class="hs-identifier hs-var">humanizeDiffs</span></a></span><span> </span><span class="annot"><span class="annottext">ThreeWay Names
</span><a href="#local-6989586621679197000"><span class="hs-identifier hs-var">names3</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
</span><a href="#local-6989586621679197031"><span class="hs-identifier hs-var">diffsFromLCA</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF2 (Map Name) Updated Referent TermReference)
</span><a href="#local-6989586621679197032"><span class="hs-identifier hs-var">propagatedUpdates</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-comment">-- Partition the combined diff into the conflicted things and the unconflicted things</span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679197044"><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReference TermReference)
</span><a href="#local-6989586621679197044"><span class="hs-identifier hs-var">conflicts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679197045"><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TermReference
</span><a href="#local-6989586621679197045"><span class="hs-identifier hs-var">unconflicts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">TwoWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay DeclNameLookup
-&gt; DefnsF2 (Map Name) CombinedDiffOp Referent TermReference
-&gt; (TwoWay (DefnsF (Map Name) TermReference TermReference),
    DefnsF Unconflicts Referent TermReference)
</span><a href="Unison.Merge.PartitionCombinedDiffs.html#partitionCombinedDiffs"><span class="hs-identifier hs-var">partitionCombinedDiffs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
-&gt; TwoWay
     (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
forall a. ThreeWay a -&gt; TwoWay a
</span><a href="Unison.Merge.ThreeWay.html#forgetLca"><span class="hs-identifier hs-var">ThreeWay.forgetLca</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
</span><a href="#local-6989586621679197021"><span class="hs-identifier hs-var">declNameLookups</span></a></span><span> </span><span class="annot"><span class="annottext">DefnsF2 (Map Name) CombinedDiffOp Referent TermReference
</span><a href="#local-6989586621679197042"><span class="hs-identifier hs-var">diff</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-comment">-- Diff and merge libdeps</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679197047"><span class="hs-identifier hs-type">libdepsDiffs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Merge.TwoWay.html#TwoWay"><span class="hs-identifier hs-type">TwoWay</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Merge.DiffOp.html#DiffOp"><span class="hs-identifier hs-type">DiffOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679196799"><span class="hs-identifier hs-type">libdep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>      </span><span id="local-6989586621679197047"><span class="annot"><span class="annottext">libdepsDiffs :: TwoWay (Map NameSegment (DiffOp libdep))
</span><a href="#local-6989586621679197047"><span class="hs-identifier hs-var hs-var">libdepsDiffs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><span class="annottext">ThreeWay (Map NameSegment libdep)
-&gt; TwoWay (Map NameSegment (DiffOp libdep))
forall k v.
(Ord k, Eq v) =&gt;
ThreeWay (Map k v) -&gt; TwoWay (Map k (DiffOp v))
</span><a href="Unison.Merge.Libdeps.html#diffLibdeps"><span class="hs-identifier hs-var">diffLibdeps</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">libdeps</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679197048"><span class="hs-identifier hs-type">libdeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="annot"><a href="#local-6989586621679196799"><span class="hs-identifier hs-type">libdep</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span id="local-6989586621679197048"><span class="annot"><span class="annottext">libdeps :: Map NameSegment libdep
</span><a href="#local-6989586621679197048"><span class="hs-identifier hs-var hs-var">libdeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>        </span><span class="annot"><span class="annottext">(Set NameSegment -&gt; NameSegment -&gt; (NameSegment, NameSegment))
-&gt; ThreeWay (Map NameSegment libdep)
-&gt; Map NameSegment (LibdepDiffOp libdep)
-&gt; Map NameSegment libdep
forall k v.
Ord k =&gt;
(Set k -&gt; k -&gt; (k, k))
-&gt; ThreeWay (Map k v) -&gt; Map k (LibdepDiffOp v) -&gt; Map k v
</span><a href="Unison.Merge.Libdeps.html#applyLibdepsDiff"><span class="hs-identifier hs-var">applyLibdepsDiff</span></a></span><span> </span><span class="annot"><span class="annottext">Set NameSegment -&gt; NameSegment -&gt; (NameSegment, NameSegment)
</span><a href="Unison.Merge.Libdeps.html#getTwoFreshLibdepNames"><span class="hs-identifier hs-var">getTwoFreshLibdepNames</span></a></span><span> </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">libdeps</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TwoWay (Map NameSegment (DiffOp libdep))
-&gt; Map NameSegment (LibdepDiffOp libdep)
forall k v.
(Ord k, Eq v) =&gt;
TwoWay (Map k (DiffOp v)) -&gt; Map k (LibdepDiffOp v)
</span><a href="Unison.Merge.Libdeps.html#mergeLibdepsDiffs"><span class="hs-identifier hs-var">mergeLibdepsDiffs</span></a></span><span> </span><span class="annot"><span class="annottext">TwoWay (Map NameSegment (DiffOp libdep))
</span><a href="#local-6989586621679197047"><span class="hs-identifier hs-var">libdepsDiffs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-identifier">pure</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="Unison.Merge.Mergeblob1.html#Mergeblob1"><span class="hs-identifier hs-type">Mergeblob1</span></a></span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TwoWay (DefnsF (Map Name) TermReference TermReference)
$sel:conflicts:Mergeblob1 :: TwoWay (DefnsF (Map Name) TermReference TermReference)
conflicts :: TwoWay (DefnsF (Map Name) TermReference TermReference)
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Aconflicts%3AMergeblob1"><span class="hs-identifier hs-var hs-var">conflicts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">TwoWay DeclNameLookup
$sel:declNameLookups:Mergeblob1 :: TwoWay DeclNameLookup
declNameLookups :: TwoWay DeclNameLookup
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AdeclNameLookups%3AMergeblob1"><span class="hs-identifier hs-var hs-var">declNameLookups</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><span class="annottext">$sel:defns:Mergeblob1 :: ThreeWay
  (Defns (BiMultimap Referent Name) (BiMultimap TermReference Name))
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Adefns%3AMergeblob1"><span class="hs-identifier hs-var">defns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">defns</span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">DefnsF2 (Map Name) CombinedDiffOp Referent TermReference
$sel:diff:Mergeblob1 :: DefnsF2 (Map Name) CombinedDiffOp Referent TermReference
diff :: DefnsF2 (Map Name) CombinedDiffOp Referent TermReference
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Adiff%3AMergeblob1"><span class="hs-identifier hs-var hs-var">diff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
$sel:diffsFromLCA:Mergeblob1 :: TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
diffsFromLCA :: TwoWay (DefnsF3 (Map Name) DiffOp Synhashed Referent TermReference)
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AdiffsFromLCA%3AMergeblob1"><span class="hs-identifier hs-var hs-var">diffsFromLCA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-181"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (DefnsF2 (Map Name) HumanDiffOp Referent TermReference)
$sel:humanDiffsFromLCA:Mergeblob1 :: TwoWay (DefnsF2 (Map Name) HumanDiffOp Referent TermReference)
humanDiffsFromLCA :: TwoWay (DefnsF2 (Map Name) HumanDiffOp Referent TermReference)
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AhumanDiffsFromLCA%3AMergeblob1"><span class="hs-identifier hs-var hs-var">humanDiffsFromLCA</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><span class="annottext">ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
$sel:hydratedDefns:Mergeblob1 :: ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
hydratedDefns :: ThreeWay
  (DefnsF
     (Map Name)
     (TermReferenceId, (Term Symbol Ann, Type Symbol Ann))
     (TermReferenceId, Decl Symbol Ann))
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AhydratedDefns%3AMergeblob1"><span class="hs-identifier hs-var hs-var">hydratedDefns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-183"></span><span>        </span><span class="annot"><span class="annottext">PartialDeclNameLookup
$sel:lcaDeclNameLookup:Mergeblob1 :: PartialDeclNameLookup
lcaDeclNameLookup :: PartialDeclNameLookup
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AlcaDeclNameLookup%3AMergeblob1"><span class="hs-identifier hs-var hs-var">lcaDeclNameLookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><span class="annottext">$sel:lcaLibdeps:Mergeblob1 :: Map NameSegment libdep
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AlcaLibdeps%3AMergeblob1"><span class="hs-identifier hs-var">lcaLibdeps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Mergeblob0 libdep
</span><a href="#local-6989586621679196999"><span class="hs-identifier hs-var">blob</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">libdeps</span><span class="hs-operator">.</span><span class="hs-identifier">lca</span><span class="hs-special">,</span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">Map NameSegment libdep
$sel:libdeps:Mergeblob1 :: Map NameSegment libdep
libdeps :: Map NameSegment libdep
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Alibdeps%3AMergeblob1"><span class="hs-identifier hs-var hs-var">libdeps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-186"></span><span>        </span><span class="annot"><span class="annottext">TwoWay (Map NameSegment (DiffOp libdep))
$sel:libdepsDiffs:Mergeblob1 :: TwoWay (Map NameSegment (DiffOp libdep))
libdepsDiffs :: TwoWay (Map NameSegment (DiffOp libdep))
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3AlibdepsDiffs%3AMergeblob1"><span class="hs-identifier hs-var hs-var">libdepsDiffs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-187"></span><span>        </span><span class="annot"><span class="annottext">DefnsF Unconflicts Referent TermReference
$sel:unconflicts:Mergeblob1 :: DefnsF Unconflicts Referent TermReference
unconflicts :: DefnsF Unconflicts Referent TermReference
</span><a href="Unison.Merge.Mergeblob1.html#%24sel%3Aunconflicts%3AMergeblob1"><span class="hs-identifier hs-var hs-var">unconflicts</span></a></span><span>
</span><span id="line-188"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-189"></span></pre></body></html>