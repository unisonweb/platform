<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE UnboxedTuples #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Runtime.Stack</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier">K</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#GClosure"><span class="hs-identifier">GClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier">Closure</span></a></span><span>
</span><span id="line-11"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#DataC"><span class="hs-identifier">DataC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#PApV"><span class="hs-identifier">PApV</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#CapV"><span class="hs-identifier">CapV</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#PAp"><span class="hs-identifier">PAp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier">Enum</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#Data1"><span class="hs-identifier">Data1</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#Data2"><span class="hs-identifier">Data2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#DataG"><span class="hs-identifier">DataG</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#Captured"><span class="hs-identifier">Captured</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier">Foreign</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-identifier">BlackHole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier">UnboxedTypeTag</span></a></span><span>
</span><span id="line-24"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#closureTag"><span class="hs-identifier">closureTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#unitClosure"><span class="hs-identifier">unitClosure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier">UnboxedTypeTag</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#unboxedTypeTagToInt"><span class="hs-identifier">unboxedTypeTagToInt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#unboxedTypeTagFromInt"><span class="hs-identifier">unboxedTypeTagFromInt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#IxClosure"><span class="hs-identifier">IxClosure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Callback"><span class="hs-identifier">Callback</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Augment"><span class="hs-identifier">Augment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Dump"><span class="hs-identifier">Dump</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier">Stack</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier">XStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier">XStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#packXStack"><span class="hs-identifier">packXStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#unpackXStack"><span class="hs-identifier">unpackXStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#xStackIOToIO"><span class="hs-identifier">xStackIOToIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#stackIOToIOX"><span class="hs-identifier">stackIOToIOX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#estackIOToIOX"><span class="hs-identifier">estackIOToIOX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#exStackIOToIO"><span class="hs-identifier">exStackIOToIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#IOXStack"><span class="hs-identifier">IOXStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#IOEXStack"><span class="hs-identifier">IOEXStack</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#%24sel%3AapX%3AXStack"><span class="hs-identifier">apX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#%24sel%3AfpX%3AXStack"><span class="hs-identifier">fpX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#%24sel%3AspX%3AXStack"><span class="hs-identifier">spX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#%24sel%3AustkX%3AXStack"><span class="hs-identifier">ustkX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#%24sel%3AbstkX%3AXStack"><span class="hs-identifier">bstkX</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier">Off</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier">SZ</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#FP"><span class="hs-identifier">FP</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier">Seg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#USeg"><span class="hs-identifier">USeg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#BSeg"><span class="hs-identifier">BSeg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier">SegList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier">Val</span></a></span><span>
</span><span id="line-58"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#CharVal"><span class="hs-identifier">CharVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#NatVal"><span class="hs-identifier">NatVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#DoubleVal"><span class="hs-identifier">DoubleVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#IntVal"><span class="hs-identifier">IntVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoolVal"><span class="hs-identifier">BoolVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier">UnboxedVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>        </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier">BoxedVal</span></a></span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#emptyVal"><span class="hs-identifier">emptyVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#falseVal"><span class="hs-identifier">falseVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#trueVal"><span class="hs-identifier">trueVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#boxedVal"><span class="hs-identifier">boxedVal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#USeq"><span class="hs-identifier">USeq</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#traceK"><span class="hs-identifier">traceK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#frameDataSize"><span class="hs-identifier">frameDataSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#RuntimePanic"><span class="hs-identifier">RuntimePanic</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#marshalToForeign"><span class="hs-identifier">marshalToForeign</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#marshalUnwrapForeignIO"><span class="hs-identifier">marshalUnwrapForeignIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#unull"><span class="hs-identifier">unull</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#bnull"><span class="hs-identifier">bnull</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#nullSeg"><span class="hs-identifier">nullSeg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekD"><span class="hs-identifier">peekD</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffD"><span class="hs-identifier">peekOffD</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekC"><span class="hs-identifier">peekC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffC"><span class="hs-identifier">peekOffC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#poke"><span class="hs-identifier">poke</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeD"><span class="hs-identifier">pokeD</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffD"><span class="hs-identifier">pokeOffD</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeC"><span class="hs-identifier">pokeC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffC"><span class="hs-identifier">pokeOffC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeBool"><span class="hs-identifier">pokeBool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeTag"><span class="hs-identifier">pokeTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekTag"><span class="hs-identifier">peekTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekTagOff"><span class="hs-identifier">peekTagOff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekI"><span class="hs-identifier">peekI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffI"><span class="hs-identifier">peekOffI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekN"><span class="hs-identifier">peekN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffN"><span class="hs-identifier">peekOffN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeN"><span class="hs-identifier">pokeN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffN"><span class="hs-identifier">pokeOffN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeI"><span class="hs-identifier">pokeI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffI"><span class="hs-identifier">pokeOffI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeByte"><span class="hs-identifier">pokeByte</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekBi"><span class="hs-identifier">peekBi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffBi"><span class="hs-identifier">peekOffBi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeBi"><span class="hs-identifier">pokeBi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffBi"><span class="hs-identifier">pokeOffBi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekBool"><span class="hs-identifier">peekBool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffBool"><span class="hs-identifier">peekOffBool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffS"><span class="hs-identifier">peekOffS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeS"><span class="hs-identifier">pokeS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffS"><span class="hs-identifier">pokeOffS</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#frameView"><span class="hs-identifier">frameView</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#scount"><span class="hs-identifier">scount</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#closureTermRefs"><span class="hs-identifier">closureTermRefs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpAP"><span class="hs-identifier">dumpAP</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpFP"><span class="hs-identifier">dumpFP</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#alloc"><span class="hs-identifier">alloc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peek"><span class="hs-identifier">peek</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#upeek"><span class="hs-identifier">upeek</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#bpeek"><span class="hs-identifier">bpeek</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOff"><span class="hs-identifier">peekOff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#upeekOff"><span class="hs-identifier">upeekOff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#bpeekOff"><span class="hs-identifier">bpeekOff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier">bpoke</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier">bpokeOff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOff"><span class="hs-identifier">pokeOff</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#upokeT"><span class="hs-identifier">upokeT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#upokeOffT"><span class="hs-identifier">upokeOffT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#unsafePokeIasN"><span class="hs-identifier">unsafePokeIasN</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#bump"><span class="hs-identifier">bump</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#bumpn"><span class="hs-identifier">bumpn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#grab"><span class="hs-identifier">grab</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#ensure"><span class="hs-identifier">ensure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#duplicate"><span class="hs-identifier">duplicate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#discardFrame"><span class="hs-identifier">discardFrame</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#saveFrame"><span class="hs-identifier">saveFrame</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#saveArgs"><span class="hs-identifier">saveArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#restoreFrame"><span class="hs-identifier">restoreFrame</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#prepareArgs"><span class="hs-identifier">prepareArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#acceptArgs"><span class="hs-identifier">acceptArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#frameArgs"><span class="hs-identifier">frameArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#augSeg"><span class="hs-identifier">augSeg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpSeg"><span class="hs-identifier">dumpSeg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#adjustArgs"><span class="hs-identifier">adjustArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#fsize"><span class="hs-identifier">fsize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#asize"><span class="hs-identifier">asize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#useg"><span class="hs-identifier">useg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#bseg"><span class="hs-identifier">bseg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Unboxed type tags</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-identifier">natTypeTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#intTypeTag"><span class="hs-identifier">intTypeTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#charTypeTag"><span class="hs-identifier">charTypeTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#floatTypeTag"><span class="hs-identifier">floatTypeTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#hasNoAllocations"><span class="hs-identifier">hasNoAllocations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throw</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Primitive</span></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Char</span></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IORef</span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Primitive</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sizeOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Primitive.ByteArray</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tagged</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tagged</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Base</span></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Exts</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsList</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Inspection</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TI</span></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin.Decls</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ty</span></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference</span></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Runtime.ANF.html"><span class="hs-identifier">Unison.Runtime.ANF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier">PackedTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Runtime.Array.html"><span class="hs-identifier">Unison.Runtime.Array</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Runtime.Foreign.html"><span class="hs-identifier">Unison.Runtime.Foreign</span></a></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html"><span class="hs-identifier">Unison.Runtime.MCode</span></a></span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Runtime.TypeTags.html"><span class="hs-identifier">Unison.Runtime.TypeTags</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TT</span></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ty</span></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.EnumContainers</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EC</span></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">words</span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">{- ORMOLU_DISABLE -}</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">DebugCallStack</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">HasCallStack</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Constraint</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-identifier">unboxedSentinel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span>
</span><span id="line-187"></span><span class="hs-identifier">unboxedSentinel</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">99</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-identifier">boxedSentinel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Closure</span><span>
</span><span id="line-190"></span><span class="hs-identifier">boxedSentinel</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Closure</span><span> </span><span class="hs-identifier">GUnboxedSentinel</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-identifier">assertBumped</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Stack</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Off</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span class="hs-identifier">assertBumped</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Stack</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">sp</span><span> </span><span class="hs-identifier">ustk</span><span> </span><span class="hs-identifier">bstk</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readByteArray</span><span> </span><span class="hs-identifier">ustk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sp</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">BVal</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readArray</span><span> </span><span class="hs-identifier">bstk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sp</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-identifier">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">u</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">unboxedSentinel</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isBoxedSentinel</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>            </span><span class="hs-identifier">error</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;Expected stack slot to have been bumped, but it was:&quot;</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Val</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-identifier">isBoxedSentinel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Closure</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-identifier">isBoxedSentinel</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Closure</span><span> </span><span class="hs-identifier">GUnboxedSentinel</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-identifier">isBoxedSentinel</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Stack</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Off</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Stack</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">sp</span><span> </span><span class="hs-identifier">ustk</span><span> </span><span class="hs-identifier">bstk</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readByteArray</span><span> </span><span class="hs-identifier">ustk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sp</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">readArray</span><span> </span><span class="hs-identifier">bstk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sp</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">i</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-identifier">UnboxedTypeTag</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;Expected stack val to be unboxed, but it was:&quot;</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Val</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-identifier">pokeSentinelOff</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Stack</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Off</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span class="hs-identifier">pokeSentinelOff</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Stack</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">sp</span><span> </span><span class="hs-identifier">ustk</span><span> </span><span class="hs-identifier">bstk</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">off</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-identifier">writeByteArray</span><span> </span><span class="hs-identifier">ustk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sp</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">off</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">unboxedSentinel</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-identifier">writeArray</span><span> </span><span class="hs-identifier">bstk</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">sp</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">off</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">boxedSentinel</span><span class="hs-cpp">
#else
</span><span class="hs-comment">-- Don't track callstacks in production, it's expensive</span><span>
</span><span id="line-217"></span><span class="hs-keyword">type</span><span> </span><span id="DebugCallStack"><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-var">DebugCallStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-comment">{- ORMOLU_ENABLE -}</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-keyword">newtype</span><span> </span><span id="Callback"><span class="annot"><a href="Unison.Runtime.Stack.html#Callback"><span class="hs-identifier hs-var">Callback</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Hook"><span class="annot"><a href="Unison.Runtime.Stack.html#Hook"><span class="hs-identifier hs-var">Hook</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier hs-type">XStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680143925"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Callback"><span class="hs-identifier hs-type">Callback</span></a></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span class="annot"><span class="annottext">Callback
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680143929"><span class="annot"><span class="annottext">== :: Callback -&gt; Callback -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><span class="annottext">Callback
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680143934"><span id="local-6989586621680143938"><span id="local-6989586621680143941"><span id="local-6989586621680143944"><span id="local-6989586621680143947"><span id="local-6989586621680143950"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Callback"><span class="hs-identifier hs-type">Callback</span></a></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680143953"><span class="annot"><span class="annottext">compare :: Callback -&gt; Callback -&gt; Ordering
</span><a href="#local-6989586621680143953"><span class="hs-identifier hs-var hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span class="annot"><span class="annottext">Callback
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Callback
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-- Evaluation stack</span><span>
</span><span id="line-228"></span><span class="hs-keyword">data</span><span> </span><span id="K"><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-var">K</span></a></span></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="KE"><span class="annot"><a href="Unison.Runtime.Stack.html#KE"><span class="hs-identifier hs-var">KE</span></a></span></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- callback hook</span><span>
</span><span id="line-231"></span><span>    </span><span id="CB"><span class="annot"><a href="Unison.Runtime.Stack.html#CB"><span class="hs-identifier hs-var">CB</span></a></span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Callback"><span class="hs-identifier hs-type">Callback</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- mark continuation with a prompt</span><span>
</span><span id="line-233"></span><span>    </span><span id="Mark"><span class="annot"><a href="Unison.Runtime.Stack.html#Mark"><span class="hs-identifier hs-var">Mark</span></a></span></span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- pending args</span><span>
</span><span id="line-235"></span><span>      </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EnumSet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EnumMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-type">K</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- save information about a frame for later resumption</span><span>
</span><span id="line-239"></span><span>    </span><span id="Push"><span class="annot"><a href="Unison.Runtime.Stack.html#Push"><span class="hs-identifier hs-var">Push</span></a></span></span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- frame size</span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- pending args</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.MCode.html#CombIx"><span class="hs-identifier hs-type">CombIx</span></a></span><span> </span><span class="hs-comment">-- resumption section reference</span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-comment">-- stack guard</span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#RSection"><span class="hs-identifier hs-type">RSection</span></a></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- resumption section</span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-type">K</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-keyword">newtype</span><span> </span><span id="Closure"><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Closure"><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AunClosure%3AClosure"><span class="annot"><span class="annottext">BVal -&gt; GClosure (RComb Val)
</span><a href="Unison.Runtime.Stack.html#%24sel%3AunClosure%3AClosure"><span class="hs-identifier hs-var hs-var">unClosure</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GClosure"><span class="hs-identifier hs-type">GClosure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#RComb"><span class="hs-identifier hs-type">RComb</span></a></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680143962"><span id="local-6989586621680143968"><span id="local-6989586621680143972"><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; ShowS
[BVal] -&gt; ShowS
BVal -&gt; String
(Int -&gt; BVal -&gt; ShowS)
-&gt; (BVal -&gt; String) -&gt; ([BVal] -&gt; ShowS) -&gt; Show BVal
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; BVal -&gt; ShowS
showsPrec :: Int -&gt; BVal -&gt; ShowS
$cshow :: BVal -&gt; String
show :: BVal -&gt; String
$cshowList :: [BVal] -&gt; ShowS
showList :: [BVal] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><span class="hs-comment">-- | Implementation for Unison sequences.</span></span><span>
</span><span id="line-251"></span><span class="hs-keyword">type</span><span> </span><span id="USeq"><span class="annot"><a href="Unison.Runtime.Stack.html#USeq"><span class="hs-identifier hs-var">USeq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-keyword">type</span><span> </span><span id="IxClosure"><span class="annot"><a href="Unison.Runtime.Stack.html#IxClosure"><span class="hs-identifier hs-var">IxClosure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#GClosure"><span class="hs-identifier hs-type">GClosure</span></a></span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#CombIx"><span class="hs-identifier hs-type">CombIx</span></a></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span class="hs-comment">-- Don't re-order these, the ord instance affects Universal.compare</span><span>
</span><span id="line-256"></span><span class="hs-keyword">data</span><span> </span><span id="UnboxedTypeTag"><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier hs-var">UnboxedTypeTag</span></a></span></span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CharTag"><span class="annot"><a href="Unison.Runtime.Stack.html#CharTag"><span class="hs-identifier hs-var">CharTag</span></a></span></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="FloatTag"><span class="annot"><a href="Unison.Runtime.Stack.html#FloatTag"><span class="hs-identifier hs-var">FloatTag</span></a></span></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="IntTag"><span class="annot"><a href="Unison.Runtime.Stack.html#IntTag"><span class="hs-identifier hs-var">IntTag</span></a></span></span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NatTag"><span class="annot"><a href="Unison.Runtime.Stack.html#NatTag"><span class="hs-identifier hs-var">NatTag</span></a></span></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680143981"><span id="local-6989586621680143983"><span id="local-6989586621680143987"><span class="annot"><span class="annottext">Int -&gt; UnboxedTypeTag -&gt; ShowS
[UnboxedTypeTag] -&gt; ShowS
UnboxedTypeTag -&gt; String
(Int -&gt; UnboxedTypeTag -&gt; ShowS)
-&gt; (UnboxedTypeTag -&gt; String)
-&gt; ([UnboxedTypeTag] -&gt; ShowS)
-&gt; Show UnboxedTypeTag
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; UnboxedTypeTag -&gt; ShowS
showsPrec :: Int -&gt; UnboxedTypeTag -&gt; ShowS
$cshow :: UnboxedTypeTag -&gt; String
show :: UnboxedTypeTag -&gt; String
$cshowList :: [UnboxedTypeTag] -&gt; ShowS
showList :: [UnboxedTypeTag] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680143990"><span id="local-6989586621680143992"><span class="annot"><span class="annottext">UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
(UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool)
-&gt; (UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool) -&gt; Eq UnboxedTypeTag
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
== :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
$c/= :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
/= :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680143998"><span id="local-6989586621680144000"><span id="local-6989586621680144002"><span id="local-6989586621680144006"><span id="local-6989586621680144009"><span id="local-6989586621680144012"><span id="local-6989586621680144015"><span class="annot"><span class="annottext">Eq UnboxedTypeTag
Eq UnboxedTypeTag =&gt;
(UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Ordering)
-&gt; (UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool)
-&gt; (UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool)
-&gt; (UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool)
-&gt; (UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool)
-&gt; (UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; UnboxedTypeTag)
-&gt; (UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; UnboxedTypeTag)
-&gt; Ord UnboxedTypeTag
UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Ordering
UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; UnboxedTypeTag
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Ordering
compare :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Ordering
$c&lt; :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
&lt; :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
$c&lt;= :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
&lt;= :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
$c&gt; :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
&gt; :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
$c&gt;= :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
&gt;= :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; Bool
$cmax :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; UnboxedTypeTag
max :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; UnboxedTypeTag
$cmin :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; UnboxedTypeTag
min :: UnboxedTypeTag -&gt; UnboxedTypeTag -&gt; UnboxedTypeTag
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><a href="Unison.Runtime.Stack.html#unboxedTypeTagToInt"><span class="hs-identifier hs-type">unboxedTypeTagToInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier hs-type">UnboxedTypeTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-264"></span><span id="unboxedTypeTagToInt"><span class="annot"><span class="annottext">unboxedTypeTagToInt :: UnboxedTypeTag -&gt; Int
</span><a href="Unison.Runtime.Stack.html#unboxedTypeTagToInt"><span class="hs-identifier hs-var hs-var">unboxedTypeTagToInt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#CharTag"><span class="hs-identifier hs-var">CharTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#FloatTag"><span class="hs-identifier hs-var">FloatTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#IntTag"><span class="hs-identifier hs-var">IntTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#NatTag"><span class="hs-identifier hs-var">NatTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><a href="Unison.Runtime.Stack.html#unboxedTypeTagFromInt"><span class="hs-identifier hs-type">unboxedTypeTagFromInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier hs-type">UnboxedTypeTag</span></a></span><span>
</span><span id="line-271"></span><span id="unboxedTypeTagFromInt"><span class="annot"><span class="annottext">unboxedTypeTagFromInt :: HasCallStack =&gt; Int -&gt; UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#unboxedTypeTagFromInt"><span class="hs-identifier hs-var hs-var">unboxedTypeTagFromInt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#CharTag"><span class="hs-identifier hs-var">CharTag</span></a></span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#FloatTag"><span class="hs-identifier hs-var">FloatTag</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#IntTag"><span class="hs-identifier hs-var">IntTag</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#NatTag"><span class="hs-identifier hs-var">NatTag</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; UnboxedTypeTag
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;intToUnboxedTypeTag: invalid tag&quot;</span></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">{- ORMOLU_DISABLE -}</span><span>
</span><span id="line-279"></span><span class="hs-keyword">data</span><span> </span><span id="GClosure"><span class="annot"><a href="Unison.Runtime.Stack.html#GClosure"><span class="hs-identifier hs-var">GClosure</span></a></span></span><span> </span><span id="local-6989586621680143098"><span class="annot"><a href="#local-6989586621680143098"><span class="hs-identifier hs-type">comb</span></a></span></span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="GPAp"><span class="annot"><a href="Unison.Runtime.Stack.html#GPAp"><span class="hs-identifier hs-var">GPAp</span></a></span></span><span>
</span><span id="line-281"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.MCode.html#CombIx"><span class="hs-identifier hs-type">CombIx</span></a></span><span>
</span><span id="line-282"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#GCombInfo"><span class="hs-identifier hs-type">GCombInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680143098"><span class="hs-identifier hs-type">comb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span> </span><span class="hs-comment">-- args</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GEnum"><span class="annot"><a href="Unison.Runtime.Stack.html#GEnum"><span class="hs-identifier hs-var">GEnum</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GData1"><span class="annot"><a href="Unison.Runtime.Stack.html#GData1"><span class="hs-identifier hs-var">GData1</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GData2"><span class="annot"><a href="Unison.Runtime.Stack.html#GData2"><span class="hs-identifier hs-var">GData2</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GDataG"><span class="annot"><a href="Unison.Runtime.Stack.html#GDataG"><span class="hs-identifier hs-var">GDataG</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- code cont, arg size, u/b data stacks</span><span>
</span><span id="line-289"></span><span>    </span><span id="GCaptured"><span class="annot"><a href="Unison.Runtime.Stack.html#GCaptured"><span class="hs-identifier hs-var">GCaptured</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-type">K</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GForeign"><span class="annot"><a href="Unison.Runtime.Stack.html#GForeign"><span class="hs-identifier hs-var">GForeign</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Foreign.html#Foreign"><span class="hs-identifier hs-type">Foreign</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- The type tag for the value in the corresponding unboxed stack slot.</span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-comment">-- We should consider adding separate constructors for common builtin type tags.</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-comment">--  GHC will optimize nullary constructors into singletons.</span><span>
</span><span id="line-294"></span><span>    </span><span id="GUnboxedTypeTag"><span class="annot"><a href="Unison.Runtime.Stack.html#GUnboxedTypeTag"><span class="hs-identifier hs-var">GUnboxedTypeTag</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier hs-type">UnboxedTypeTag</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GBlackHole"><span class="annot"><a href="Unison.Runtime.Stack.html#GBlackHole"><span class="hs-identifier hs-var">GBlackHole</span></a></span></span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">GUnboxedSentinel</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144040"><span id="local-6989586621680144082"><span id="local-6989586621680144085"><span class="annot"><span class="annottext">Int -&gt; GClosure comb -&gt; ShowS
[GClosure comb] -&gt; ShowS
GClosure comb -&gt; String
(Int -&gt; GClosure comb -&gt; ShowS)
-&gt; (GClosure comb -&gt; String)
-&gt; ([GClosure comb] -&gt; ShowS)
-&gt; Show (GClosure comb)
forall comb. Show comb =&gt; Int -&gt; GClosure comb -&gt; ShowS
forall comb. Show comb =&gt; [GClosure comb] -&gt; ShowS
forall comb. Show comb =&gt; GClosure comb -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall comb. Show comb =&gt; Int -&gt; GClosure comb -&gt; ShowS
showsPrec :: Int -&gt; GClosure comb -&gt; ShowS
$cshow :: forall comb. Show comb =&gt; GClosure comb -&gt; String
show :: GClosure comb -&gt; String
$cshowList :: forall comb. Show comb =&gt; [GClosure comb] -&gt; ShowS
showList :: [GClosure comb] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144093"><span id="local-6989586621680144097"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; GClosure a -&gt; GClosure b)
-&gt; (forall a b. a -&gt; GClosure b -&gt; GClosure a) -&gt; Functor GClosure
forall a b. a -&gt; GClosure b -&gt; GClosure a
forall a b. (a -&gt; b) -&gt; GClosure a -&gt; GClosure b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall a b. (a -&gt; b) -&gt; GClosure a -&gt; GClosure b
fmap :: forall a b. (a -&gt; b) -&gt; GClosure a -&gt; GClosure b
$c&lt;$ :: forall a b. a -&gt; GClosure b -&gt; GClosure a
&lt;$ :: forall a b. a -&gt; GClosure b -&gt; GClosure a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144102"><span id="local-6989586621680144108"><span id="local-6989586621680144122"><span id="local-6989586621680144127"><span id="local-6989586621680144130"><span id="local-6989586621680144133"><span id="local-6989586621680144136"><span id="local-6989586621680144139"><span id="local-6989586621680144142"><span id="local-6989586621680144145"><span id="local-6989586621680144148"><span id="local-6989586621680144151"><span id="local-6989586621680144154"><span id="local-6989586621680144159"><span id="local-6989586621680144164"><span id="local-6989586621680144169"><span id="local-6989586621680144174"><span class="annot"><span class="annottext">(forall m. Monoid m =&gt; GClosure m -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; GClosure a -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; GClosure a -&gt; m)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; GClosure a -&gt; b)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; GClosure a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; GClosure a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; GClosure a -&gt; b)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; GClosure a -&gt; a)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; GClosure a -&gt; a)
-&gt; (forall a. GClosure a -&gt; [a])
-&gt; (forall a. GClosure a -&gt; Bool)
-&gt; (forall a. GClosure a -&gt; Int)
-&gt; (forall a. Eq a =&gt; a -&gt; GClosure a -&gt; Bool)
-&gt; (forall a. Ord a =&gt; GClosure a -&gt; a)
-&gt; (forall a. Ord a =&gt; GClosure a -&gt; a)
-&gt; (forall a. Num a =&gt; GClosure a -&gt; a)
-&gt; (forall a. Num a =&gt; GClosure a -&gt; a)
-&gt; Foldable GClosure
forall a. Eq a =&gt; a -&gt; GClosure a -&gt; Bool
forall a. Num a =&gt; GClosure a -&gt; a
forall a. Ord a =&gt; GClosure a -&gt; a
forall m. Monoid m =&gt; GClosure m -&gt; m
forall a. GClosure a -&gt; Bool
forall a. GClosure a -&gt; Int
forall a. GClosure a -&gt; [a]
forall a. (a -&gt; a -&gt; a) -&gt; GClosure a -&gt; a
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; GClosure a -&gt; m
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
forall (t :: * -&gt; *).
(forall m. Monoid m =&gt; t m -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m)
-&gt; (forall m a. Monoid m =&gt; (a -&gt; m) -&gt; t a -&gt; m)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; t a -&gt; a)
-&gt; (forall a. (a -&gt; a -&gt; a) -&gt; t a -&gt; a)
-&gt; (forall a. t a -&gt; [a])
-&gt; (forall a. t a -&gt; Bool)
-&gt; (forall a. t a -&gt; Int)
-&gt; (forall a. Eq a =&gt; a -&gt; t a -&gt; Bool)
-&gt; (forall a. Ord a =&gt; t a -&gt; a)
-&gt; (forall a. Ord a =&gt; t a -&gt; a)
-&gt; (forall a. Num a =&gt; t a -&gt; a)
-&gt; (forall a. Num a =&gt; t a -&gt; a)
-&gt; Foldable t
$cfold :: forall m. Monoid m =&gt; GClosure m -&gt; m
fold :: forall m. Monoid m =&gt; GClosure m -&gt; m
$cfoldMap :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; GClosure a -&gt; m
foldMap :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; GClosure a -&gt; m
$cfoldMap' :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; GClosure a -&gt; m
foldMap' :: forall m a. Monoid m =&gt; (a -&gt; m) -&gt; GClosure a -&gt; m
$cfoldr :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
foldr :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
$cfoldr' :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
foldr' :: forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
$cfoldl :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
foldl :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
$cfoldl' :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
foldl' :: forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; GClosure a -&gt; b
$cfoldr1 :: forall a. (a -&gt; a -&gt; a) -&gt; GClosure a -&gt; a
foldr1 :: forall a. (a -&gt; a -&gt; a) -&gt; GClosure a -&gt; a
$cfoldl1 :: forall a. (a -&gt; a -&gt; a) -&gt; GClosure a -&gt; a
foldl1 :: forall a. (a -&gt; a -&gt; a) -&gt; GClosure a -&gt; a
$ctoList :: forall a. GClosure a -&gt; [a]
toList :: forall a. GClosure a -&gt; [a]
$cnull :: forall a. GClosure a -&gt; Bool
null :: forall a. GClosure a -&gt; Bool
$clength :: forall a. GClosure a -&gt; Int
length :: forall a. GClosure a -&gt; Int
$celem :: forall a. Eq a =&gt; a -&gt; GClosure a -&gt; Bool
elem :: forall a. Eq a =&gt; a -&gt; GClosure a -&gt; Bool
$cmaximum :: forall a. Ord a =&gt; GClosure a -&gt; a
maximum :: forall a. Ord a =&gt; GClosure a -&gt; a
$cminimum :: forall a. Ord a =&gt; GClosure a -&gt; a
minimum :: forall a. Ord a =&gt; GClosure a -&gt; a
$csum :: forall a. Num a =&gt; GClosure a -&gt; a
sum :: forall a. Num a =&gt; GClosure a -&gt; a
$cproduct :: forall a. Num a =&gt; GClosure a -&gt; a
product :: forall a. Num a =&gt; GClosure a -&gt; a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Foldable</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144184"><span id="local-6989586621680144200"><span id="local-6989586621680144206"><span id="local-6989586621680144211"><span class="annot"><span class="annottext">Functor GClosure
Foldable GClosure
(Functor GClosure, Foldable GClosure) =&gt;
(forall (f :: * -&gt; *) a b.
 Applicative f =&gt;
 (a -&gt; f b) -&gt; GClosure a -&gt; f (GClosure b))
-&gt; (forall (f :: * -&gt; *) a.
    Applicative f =&gt;
    GClosure (f a) -&gt; f (GClosure a))
-&gt; (forall (m :: * -&gt; *) a b.
    Monad m =&gt;
    (a -&gt; m b) -&gt; GClosure a -&gt; m (GClosure b))
-&gt; (forall (m :: * -&gt; *) a.
    Monad m =&gt;
    GClosure (m a) -&gt; m (GClosure a))
-&gt; Traversable GClosure
forall (t :: * -&gt; *).
(Functor t, Foldable t) =&gt;
(forall (f :: * -&gt; *) a b.
 Applicative f =&gt;
 (a -&gt; f b) -&gt; t a -&gt; f (t b))
-&gt; (forall (f :: * -&gt; *) a. Applicative f =&gt; t (f a) -&gt; f (t a))
-&gt; (forall (m :: * -&gt; *) a b.
    Monad m =&gt;
    (a -&gt; m b) -&gt; t a -&gt; m (t b))
-&gt; (forall (m :: * -&gt; *) a. Monad m =&gt; t (m a) -&gt; m (t a))
-&gt; Traversable t
forall (m :: * -&gt; *) a. Monad m =&gt; GClosure (m a) -&gt; m (GClosure a)
forall (f :: * -&gt; *) a.
Applicative f =&gt;
GClosure (f a) -&gt; f (GClosure a)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; GClosure a -&gt; m (GClosure b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; GClosure a -&gt; f (GClosure b)
$ctraverse :: forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; GClosure a -&gt; f (GClosure b)
traverse :: forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; GClosure a -&gt; f (GClosure b)
$csequenceA :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
GClosure (f a) -&gt; f (GClosure a)
sequenceA :: forall (f :: * -&gt; *) a.
Applicative f =&gt;
GClosure (f a) -&gt; f (GClosure a)
$cmapM :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; GClosure a -&gt; m (GClosure b)
mapM :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; GClosure a -&gt; m (GClosure b)
$csequence :: forall (m :: * -&gt; *) a. Monad m =&gt; GClosure (m a) -&gt; m (GClosure a)
sequence :: forall (m :: * -&gt; *) a. Monad m =&gt; GClosure (m a) -&gt; m (GClosure a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Traversable</span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span class="hs-comment">{- ORMOLU_ENABLE -}</span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">-- Singleton black hole value to avoid allocation.</span><span>
</span><span id="line-303"></span><span class="annot"><a href="Unison.Runtime.Stack.html#blackHole"><span class="hs-identifier hs-type">blackHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-304"></span><span id="blackHole"><span class="annot"><span class="annottext">blackHole :: BVal
</span><a href="Unison.Runtime.Stack.html#blackHole"><span class="hs-identifier hs-var hs-var">blackHole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GClosure (RComb Val) -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">GClosure (RComb Val)
forall comb. GClosure comb
</span><a href="Unison.Runtime.Stack.html#GBlackHole"><span class="hs-identifier hs-var">GBlackHole</span></a></span><span>
</span><span id="line-305"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#blackHole"><span class="hs-pragma hs-type">blackHole</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#PAp"><span class="hs-identifier hs-type">PAp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#CombIx"><span class="hs-identifier hs-type">CombIx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#GCombInfo"><span class="hs-identifier hs-type">GCombInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#RComb"><span class="hs-identifier hs-type">RComb</span></a></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-308"></span><span class="hs-keyword">pattern</span><span> </span><span id="PAp"><span id="%24mPAp"><span id="%24bPAp"><span class="annot"><span class="annottext">$mPAp :: forall {r}.
BVal
-&gt; (CombIx -&gt; GCombInfo (RComb Val) -&gt; Seg -&gt; r)
-&gt; ((# #) -&gt; r)
-&gt; r
$bPAp :: CombIx -&gt; GCombInfo (RComb Val) -&gt; Seg -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#PAp"><span class="hs-identifier hs-var hs-var hs-var">PAp</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144220"><span class="hs-identifier hs-type">cix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144221"><span class="hs-identifier hs-type">comb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144222"><span class="hs-identifier hs-type">seg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GPAp"><span class="hs-identifier hs-type">GPAp</span></a></span><span> </span><span id="local-6989586621680144220"><span class="annot"><a href="#local-6989586621680144220"><span class="hs-identifier hs-var">cix</span></a></span></span><span> </span><span id="local-6989586621680144221"><span class="annot"><a href="#local-6989586621680144221"><span class="hs-identifier hs-var">comb</span></a></span></span><span> </span><span id="local-6989586621680144222"><span class="annot"><a href="#local-6989586621680144222"><span class="hs-identifier hs-var">seg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-type">Enum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-311"></span><span class="hs-keyword">pattern</span><span> </span><span id="Enum"><span id="%24mEnum"><span id="%24bEnum"><span class="annot"><span class="annottext">$mEnum :: forall {r}.
BVal -&gt; (Reference -&gt; PackedTag -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bEnum :: Reference -&gt; PackedTag -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-var hs-var hs-var">Enum</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144225"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144226"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GEnum"><span class="hs-identifier hs-type">GEnum</span></a></span><span> </span><span id="local-6989586621680144225"><span class="annot"><a href="#local-6989586621680144225"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144226"><span class="annot"><a href="#local-6989586621680144226"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span class="hs-keyword">pattern</span><span> </span><span id="Data1"><span id="%24mData1"><span id="%24bData1"><span class="annot"><span class="annottext">$mData1 :: forall {r}.
BVal -&gt; (Reference -&gt; PackedTag -&gt; Val -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bData1 :: Reference -&gt; PackedTag -&gt; Val -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Data1"><span class="hs-identifier hs-var hs-var hs-var">Data1</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144229"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144230"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144231"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GData1"><span class="hs-identifier hs-type">GData1</span></a></span><span> </span><span id="local-6989586621680144229"><span class="annot"><a href="#local-6989586621680144229"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144230"><span class="annot"><a href="#local-6989586621680144230"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680144231"><span class="annot"><a href="#local-6989586621680144231"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-keyword">pattern</span><span> </span><span id="Data2"><span id="%24mData2"><span id="%24bData2"><span class="annot"><span class="annottext">$mData2 :: forall {r}.
BVal
-&gt; (Reference -&gt; PackedTag -&gt; Val -&gt; Val -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bData2 :: Reference -&gt; PackedTag -&gt; Val -&gt; Val -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Data2"><span class="hs-identifier hs-var hs-var hs-var">Data2</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144234"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144235"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144236"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144237"><span class="hs-identifier hs-type">j</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GData2"><span class="hs-identifier hs-type">GData2</span></a></span><span> </span><span id="local-6989586621680144234"><span class="annot"><a href="#local-6989586621680144234"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144235"><span class="annot"><a href="#local-6989586621680144235"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680144236"><span class="annot"><a href="#local-6989586621680144236"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144237"><span class="annot"><a href="#local-6989586621680144237"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="hs-keyword">pattern</span><span> </span><span id="DataG"><span id="%24mDataG"><span id="%24bDataG"><span class="annot"><span class="annottext">$mDataG :: forall {r}.
BVal -&gt; (Reference -&gt; PackedTag -&gt; Seg -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bDataG :: Reference -&gt; PackedTag -&gt; Seg -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#DataG"><span class="hs-identifier hs-var hs-var hs-var">DataG</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144240"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144241"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144242"><span class="hs-identifier hs-type">seg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GDataG"><span class="hs-identifier hs-type">GDataG</span></a></span><span> </span><span id="local-6989586621680144240"><span class="annot"><a href="#local-6989586621680144240"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144241"><span class="annot"><a href="#local-6989586621680144241"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680144242"><span class="annot"><a href="#local-6989586621680144242"><span class="hs-identifier hs-var">seg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-keyword">pattern</span><span> </span><span id="Captured"><span id="%24mCaptured"><span id="%24bCaptured"><span class="annot"><span class="annottext">$mCaptured :: forall {r}. BVal -&gt; (K -&gt; Int -&gt; Seg -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bCaptured :: K -&gt; Int -&gt; Seg -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Captured"><span class="hs-identifier hs-var hs-var hs-var">Captured</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144245"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144246"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144247"><span class="hs-identifier hs-type">seg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GCaptured"><span class="hs-identifier hs-type">GCaptured</span></a></span><span> </span><span id="local-6989586621680144245"><span class="annot"><a href="#local-6989586621680144245"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680144246"><span class="annot"><a href="#local-6989586621680144246"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680144247"><span class="annot"><a href="#local-6989586621680144247"><span class="hs-identifier hs-var">seg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-keyword">pattern</span><span> </span><span id="Foreign"><span id="%24mForeign"><span id="%24bForeign"><span class="annot"><span class="annottext">$mForeign :: forall {r}. BVal -&gt; (Foreign -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bForeign :: Foreign -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier hs-var hs-var hs-var">Foreign</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144250"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GForeign"><span class="hs-identifier hs-type">GForeign</span></a></span><span> </span><span id="local-6989586621680144250"><span class="annot"><a href="#local-6989586621680144250"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-keyword">pattern</span><span> </span><span id="BlackHole"><span id="%24mBlackHole"><span id="%24bBlackHole"><span class="annot"><span class="annottext">$mBlackHole :: forall {r}. BVal -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bBlackHole :: BVal
</span><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-identifier hs-var hs-var hs-var hs-var">BlackHole</span></a></span></span></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#GBlackHole"><span class="hs-identifier hs-type">GBlackHole</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#blackHole"><span class="hs-identifier hs-var">blackHole</span></a></span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span class="hs-keyword">pattern</span><span> </span><span id="UnboxedTypeTag"><span id="%24mUnboxedTypeTag"><span id="%24bUnboxedTypeTag"><span class="annot"><span class="annottext">$mUnboxedTypeTag :: forall {r}. BVal -&gt; (UnboxedTypeTag -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bUnboxedTypeTag :: UnboxedTypeTag -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier hs-var hs-var hs-var hs-var">UnboxedTypeTag</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144255"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#GUnboxedTypeTag"><span class="hs-identifier hs-type">GUnboxedTypeTag</span></a></span><span> </span><span id="local-6989586621680144255"><span class="annot"><a href="#local-6989586621680144255"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier hs-var">UnboxedTypeTag</span></a></span><span> </span><span id="local-6989586621680144256"><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="#local-6989586621680144256"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="#local-6989586621680144256"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-330"></span><span>      </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#CharTag"><span class="hs-identifier hs-var">CharTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#charTypeTag"><span class="hs-identifier hs-var">charTypeTag</span></a></span><span>
</span><span id="line-331"></span><span>      </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#FloatTag"><span class="hs-identifier hs-var">FloatTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#floatTypeTag"><span class="hs-identifier hs-var">floatTypeTag</span></a></span><span>
</span><span id="line-332"></span><span>      </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#IntTag"><span class="hs-identifier hs-var">IntTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#intTypeTag"><span class="hs-identifier hs-var">intTypeTag</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#NatTag"><span class="hs-identifier hs-var">NatTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-identifier hs-var">natTypeTag</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#PAp"><span class="hs-pragma hs-type">PAp</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-pragma hs-type">Enum</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Data1"><span class="hs-pragma hs-type">Data1</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Data2"><span class="hs-pragma hs-type">Data2</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DataG"><span class="hs-pragma hs-type">DataG</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Captured"><span class="hs-pragma hs-type">Captured</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-pragma hs-type">Foreign</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-pragma hs-type">UnboxedTypeTag</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-pragma hs-type">BlackHole</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DataC"><span class="hs-pragma hs-type">DataC</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#PAp"><span class="hs-pragma hs-type">PAp</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Captured"><span class="hs-pragma hs-type">Captured</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-pragma hs-type">Foreign</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-pragma hs-type">BlackHole</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-pragma hs-type">UnboxedTypeTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DataC"><span class="hs-pragma hs-type">DataC</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#PApV"><span class="hs-pragma hs-type">PApV</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Captured"><span class="hs-pragma hs-type">Captured</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-pragma hs-type">Foreign</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-pragma hs-type">BlackHole</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-pragma hs-type">UnboxedTypeTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DataC"><span class="hs-pragma hs-type">DataC</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#PApV"><span class="hs-pragma hs-type">PApV</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#CapV"><span class="hs-pragma hs-type">CapV</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-pragma hs-type">Foreign</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-pragma hs-type">BlackHole</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-pragma hs-type">UnboxedTypeTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="hs-comment">-- We can avoid allocating a closure for common type tags on each poke by having shared top-level closures for them.</span><span>
</span><span id="line-344"></span><span class="annot"><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-identifier hs-type">natTypeTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-345"></span><span id="natTypeTag"><span class="annot"><span class="annottext">natTypeTag :: BVal
</span><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-identifier hs-var hs-var">natTypeTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GClosure (RComb Val) -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboxedTypeTag -&gt; GClosure (RComb Val)
forall comb. UnboxedTypeTag -&gt; GClosure comb
</span><a href="Unison.Runtime.Stack.html#GUnboxedTypeTag"><span class="hs-identifier hs-var">GUnboxedTypeTag</span></a></span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#NatTag"><span class="hs-identifier hs-var">NatTag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-pragma hs-type">natTypeTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="annot"><a href="Unison.Runtime.Stack.html#intTypeTag"><span class="hs-identifier hs-type">intTypeTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-349"></span><span id="intTypeTag"><span class="annot"><span class="annottext">intTypeTag :: BVal
</span><a href="Unison.Runtime.Stack.html#intTypeTag"><span class="hs-identifier hs-var hs-var">intTypeTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GClosure (RComb Val) -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboxedTypeTag -&gt; GClosure (RComb Val)
forall comb. UnboxedTypeTag -&gt; GClosure comb
</span><a href="Unison.Runtime.Stack.html#GUnboxedTypeTag"><span class="hs-identifier hs-var">GUnboxedTypeTag</span></a></span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#IntTag"><span class="hs-identifier hs-var">IntTag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#intTypeTag"><span class="hs-pragma hs-type">intTypeTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="annot"><a href="Unison.Runtime.Stack.html#charTypeTag"><span class="hs-identifier hs-type">charTypeTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-353"></span><span id="charTypeTag"><span class="annot"><span class="annottext">charTypeTag :: BVal
</span><a href="Unison.Runtime.Stack.html#charTypeTag"><span class="hs-identifier hs-var hs-var">charTypeTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GClosure (RComb Val) -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboxedTypeTag -&gt; GClosure (RComb Val)
forall comb. UnboxedTypeTag -&gt; GClosure comb
</span><a href="Unison.Runtime.Stack.html#GUnboxedTypeTag"><span class="hs-identifier hs-var">GUnboxedTypeTag</span></a></span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#CharTag"><span class="hs-identifier hs-var">CharTag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#charTypeTag"><span class="hs-pragma hs-type">charTypeTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="annot"><a href="Unison.Runtime.Stack.html#floatTypeTag"><span class="hs-identifier hs-type">floatTypeTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-357"></span><span id="floatTypeTag"><span class="annot"><span class="annottext">floatTypeTag :: BVal
</span><a href="Unison.Runtime.Stack.html#floatTypeTag"><span class="hs-identifier hs-var hs-var">floatTypeTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GClosure (RComb Val) -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnboxedTypeTag -&gt; GClosure (RComb Val)
forall comb. UnboxedTypeTag -&gt; GClosure comb
</span><a href="Unison.Runtime.Stack.html#GUnboxedTypeTag"><span class="hs-identifier hs-var">GUnboxedTypeTag</span></a></span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#FloatTag"><span class="hs-identifier hs-var">FloatTag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#floatTypeTag"><span class="hs-pragma hs-type">floatTypeTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><a href="Unison.Runtime.Stack.html#traceK"><span class="hs-identifier hs-type">traceK</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-type">K</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-361"></span><span id="traceK"><span class="annot"><span class="annottext">traceK :: Reference -&gt; K -&gt; [(Reference, Int)]
</span><a href="Unison.Runtime.Stack.html#traceK"><span class="hs-identifier hs-var hs-var">traceK</span></a></span></span><span> </span><span id="local-6989586621680144257"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144257"><span class="hs-identifier hs-var">begin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference, Int) -&gt; K -&gt; [(Reference, Int)]
forall {b}. Num b =&gt; (Reference, b) -&gt; K -&gt; [(Reference, b)]
</span><a href="#local-6989586621680144258"><span class="hs-identifier hs-var">dedup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144257"><span class="hs-identifier hs-var">begin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-363"></span><span>    </span><span id="local-6989586621680144258"><span class="annot"><span class="annottext">dedup :: (Reference, b) -&gt; K -&gt; [(Reference, b)]
</span><a href="#local-6989586621680144258"><span class="hs-identifier hs-var hs-var">dedup</span></a></span></span><span> </span><span id="local-6989586621680144266"><span class="annot"><span class="annottext">(Reference, b)
</span><a href="#local-6989586621680144266"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Mark"><span class="hs-identifier hs-type">Mark</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EnumSet Word64
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EnumMap Word64 Val
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144267"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144267"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference, b) -&gt; K -&gt; [(Reference, b)]
</span><a href="#local-6989586621680144258"><span class="hs-identifier hs-var">dedup</span></a></span><span> </span><span class="annot"><span class="annottext">(Reference, b)
</span><a href="#local-6989586621680144266"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144267"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><a href="#local-6989586621680144258"><span class="hs-identifier hs-var">dedup</span></a></span><span> </span><span id="local-6989586621680144268"><span class="annot"><span class="annottext">p :: (Reference, b)
</span><a href="#local-6989586621680144268"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680144269"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144269"><span class="hs-identifier hs-var">cur</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144270"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680144270"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Push"><span class="hs-identifier hs-type">Push</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#CIx"><span class="hs-identifier hs-type">CIx</span></a></span><span> </span><span id="local-6989586621680144272"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144272"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RSection Val
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144273"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144273"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144269"><span class="hs-identifier hs-var">cur</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144272"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference, b) -&gt; K -&gt; [(Reference, b)]
</span><a href="#local-6989586621680144258"><span class="hs-identifier hs-var">dedup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144269"><span class="hs-identifier hs-var">cur</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680144270"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144273"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference, b)
</span><a href="#local-6989586621680144268"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">(Reference, b) -&gt; [(Reference, b)] -&gt; [(Reference, b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Reference, b) -&gt; K -&gt; [(Reference, b)]
</span><a href="#local-6989586621680144258"><span class="hs-identifier hs-var">dedup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144273"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><a href="#local-6989586621680144258"><span class="hs-identifier hs-var">dedup</span></a></span><span> </span><span id="local-6989586621680144275"><span class="annot"><span class="annottext">(Reference, b)
</span><a href="#local-6989586621680144275"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">K
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Reference, b)
</span><a href="#local-6989586621680144275"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="annot"><a href="Unison.Runtime.Stack.html#splitData"><span class="hs-identifier hs-type">splitData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier hs-type">SegList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span id="splitData"><span class="annot"><span class="annottext">splitData :: BVal -&gt; Maybe (Reference, PackedTag, SegList)
</span><a href="Unison.Runtime.Stack.html#splitData"><span class="hs-identifier hs-var hs-var">splitData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-type">Enum</span></a></span><span> </span><span id="local-6989586621680144277"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144277"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144278"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144278"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Reference, PackedTag, SegList)
-&gt; Maybe (Reference, PackedTag, SegList)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144277"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144278"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Data1"><span class="hs-identifier hs-type">Data1</span></a></span><span> </span><span id="local-6989586621680144279"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144279"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144280"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144280"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680144281"><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144281"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Reference, PackedTag, SegList)
-&gt; Maybe (Reference, PackedTag, SegList)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144279"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144280"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144281"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Data2"><span class="hs-identifier hs-type">Data2</span></a></span><span> </span><span id="local-6989586621680144282"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144282"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144283"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144283"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680144284"><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144284"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144285"><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144285"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Reference, PackedTag, SegList)
-&gt; Maybe (Reference, PackedTag, SegList)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144282"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144283"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144284"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144285"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#DataG"><span class="hs-identifier hs-type">DataG</span></a></span><span> </span><span id="local-6989586621680144286"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144286"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144287"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144287"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680144288"><span class="annot"><span class="annottext">Seg
</span><a href="#local-6989586621680144288"><span class="hs-identifier hs-var">seg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Reference, PackedTag, SegList)
-&gt; Maybe (Reference, PackedTag, SegList)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144286"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144287"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Seg -&gt; SegList
</span><a href="Unison.Runtime.Stack.html#segToList"><span class="hs-identifier hs-var">segToList</span></a></span><span> </span><span class="annot"><span class="annottext">Seg
</span><a href="#local-6989586621680144288"><span class="hs-identifier hs-var">seg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="annottext">BVal
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Reference, PackedTag, SegList)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><a href="Unison.Runtime.Stack.html#closureTag"><span class="hs-identifier hs-type">closureTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span>
</span><span id="line-378"></span><span id="closureTag"><span class="annot"><span class="annottext">closureTag :: BVal -&gt; PackedTag
</span><a href="Unison.Runtime.Stack.html#closureTag"><span class="hs-identifier hs-var hs-var">closureTag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-type">Enum</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144290"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144290"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144290"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-379"></span><span class="annot"><a href="Unison.Runtime.Stack.html#closureTag"><span class="hs-identifier hs-var">closureTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Data1"><span class="hs-identifier hs-type">Data1</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144291"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144291"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144291"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-380"></span><span class="annot"><a href="Unison.Runtime.Stack.html#closureTag"><span class="hs-identifier hs-var">closureTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Data2"><span class="hs-identifier hs-type">Data2</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144292"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144292"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144292"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-381"></span><span class="annot"><a href="Unison.Runtime.Stack.html#closureTag"><span class="hs-identifier hs-var">closureTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#DataG"><span class="hs-identifier hs-type">DataG</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144293"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144293"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Seg
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144293"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-382"></span><span class="annot"><a href="Unison.Runtime.Stack.html#closureTag"><span class="hs-identifier hs-var">closureTag</span></a></span><span> </span><span id="local-6989586621680144294"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144294"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><span class="annottext">RuntimePanic -&gt; PackedTag
forall a e. Exception e =&gt; e -&gt; a
</span><span class="hs-identifier hs-var">throw</span></span><span> </span><span class="annot"><span class="annottext">(RuntimePanic -&gt; PackedTag) -&gt; RuntimePanic -&gt; PackedTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe Val -&gt; RuntimePanic
</span><a href="Unison.Runtime.Stack.html#Panic"><span class="hs-identifier hs-var">Panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;closureTag: unexpected closure&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Val -&gt; Maybe Val
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Val -&gt; Maybe Val) -&gt; Val -&gt; Maybe Val
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-var">BoxedVal</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144294"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span class="hs-pragma">{-# inline</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#closureTag"><span class="hs-pragma hs-type">closureTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="hs-comment">-- | Converts a list of integers representing an unboxed segment back into the</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- appropriate segment. Segments are stored backwards in the runtime, so this</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- reverses the list.</span><span>
</span><span id="line-389"></span><span class="annot"><a href="Unison.Runtime.Stack.html#useg"><span class="hs-identifier hs-type">useg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#USeg"><span class="hs-identifier hs-type">USeg</span></a></span><span>
</span><span id="line-390"></span><span id="useg"><span class="annot"><span class="annottext">useg :: [Int] -&gt; ByteArray
</span><a href="Unison.Runtime.Stack.html#useg"><span class="hs-identifier hs-var hs-var">useg</span></a></span></span><span> </span><span id="local-6989586621680144296"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680144296"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Item (PrimArray Int)] -&gt; PrimArray Int
forall l. IsList l =&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">L.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Item (PrimArray Int)] -&gt; PrimArray Int)
-&gt; [Item (PrimArray Int)] -&gt; PrimArray Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680144296"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PrimArray</span></span><span> </span><span id="local-6989586621680144299"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621680144299"><span class="hs-identifier hs-var">ba</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteArray# -&gt; ByteArray
</span><span class="hs-identifier hs-var">ByteArray</span></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621680144299"><span class="hs-identifier hs-var">ba</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-comment">-- | Converts a boxed segment to a list of closures. The segments are stored</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- backwards, so this reverses the contents.</span><span>
</span><span id="line-395"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bsegToList"><span class="hs-identifier hs-type">bsegToList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BSeg"><span class="hs-identifier hs-type">BSeg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-396"></span><span id="bsegToList"><span class="annot"><span class="annottext">bsegToList :: BSeg -&gt; [BVal]
</span><a href="Unison.Runtime.Stack.html#bsegToList"><span class="hs-identifier hs-var hs-var">bsegToList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BVal] -&gt; [BVal]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([BVal] -&gt; [BVal]) -&gt; (BSeg -&gt; [BVal]) -&gt; BSeg -&gt; [BVal]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BSeg -&gt; [Item BSeg]
BSeg -&gt; [BVal]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><span class="hs-identifier hs-var">L.toList</span></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-comment">-- | Converts a list of closures back to a boxed segment. Segments are stored</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- backwards, so this reverses the contents.</span><span>
</span><span id="line-400"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bseg"><span class="hs-identifier hs-type">bseg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BSeg"><span class="hs-identifier hs-type">BSeg</span></a></span><span>
</span><span id="line-401"></span><span id="bseg"><span class="annot"><span class="annottext">bseg :: [BVal] -&gt; BSeg
</span><a href="Unison.Runtime.Stack.html#bseg"><span class="hs-identifier hs-var hs-var">bseg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Item BSeg] -&gt; BSeg
[BVal] -&gt; BSeg
forall l. IsList l =&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">L.fromList</span></span><span> </span><span class="annot"><span class="annottext">([BVal] -&gt; BSeg) -&gt; ([BVal] -&gt; [BVal]) -&gt; [BVal] -&gt; BSeg
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[BVal] -&gt; [BVal]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="annot"><a href="Unison.Runtime.Stack.html#formData"><span class="hs-identifier hs-type">formData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier hs-type">SegList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-404"></span><span id="formData"><span class="annot"><span class="annottext">formData :: Reference -&gt; PackedTag -&gt; SegList -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#formData"><span class="hs-identifier hs-var hs-var">formData</span></a></span></span><span> </span><span id="local-6989586621680144304"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144304"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144305"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144305"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; PackedTag -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-var">Enum</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144304"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144305"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-405"></span><span class="annot"><a href="Unison.Runtime.Stack.html#formData"><span class="hs-identifier hs-var">formData</span></a></span><span> </span><span id="local-6989586621680144306"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144306"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144307"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144307"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621680144308"><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144308"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; PackedTag -&gt; Val -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Data1"><span class="hs-identifier hs-var">Data1</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144306"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144307"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144308"><span class="hs-identifier hs-var">v1</span></a></span><span>
</span><span id="line-406"></span><span class="annot"><a href="Unison.Runtime.Stack.html#formData"><span class="hs-identifier hs-var">formData</span></a></span><span> </span><span id="local-6989586621680144309"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144309"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144310"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144310"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621680144311"><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144311"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144312"><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144312"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; PackedTag -&gt; Val -&gt; Val -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Data2"><span class="hs-identifier hs-var">Data2</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144309"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144310"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144311"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144312"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-407"></span><span class="annot"><a href="Unison.Runtime.Stack.html#formData"><span class="hs-identifier hs-var">formData</span></a></span><span> </span><span id="local-6989586621680144313"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144313"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144314"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144314"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680144315"><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144315"><span class="hs-identifier hs-var">segList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; PackedTag -&gt; Seg -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#DataG"><span class="hs-identifier hs-var">DataG</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144313"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144314"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegList -&gt; Seg
</span><a href="Unison.Runtime.Stack.html#segFromList"><span class="hs-identifier hs-var">segFromList</span></a></span><span> </span><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144315"><span class="hs-identifier hs-var">segList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span class="annot"><a href="Unison.Runtime.Stack.html#frameDataSize"><span class="hs-identifier hs-type">frameDataSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-type">K</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-410"></span><span id="frameDataSize"><span class="annot"><span class="annottext">frameDataSize :: K -&gt; Int
</span><a href="Unison.Runtime.Stack.html#frameDataSize"><span class="hs-identifier hs-var hs-var">frameDataSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; K -&gt; Int
</span><a href="#local-6989586621680144317"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621680144317"><span class="annot"><span class="annottext">go :: Int -&gt; K -&gt; Int
</span><a href="#local-6989586621680144317"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680144321"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144321"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="Unison.Runtime.Stack.html#KE"><span class="hs-identifier hs-var">KE</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144321"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><a href="#local-6989586621680144317"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680144322"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144322"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#CB"><span class="hs-identifier hs-type">CB</span></a></span><span> </span><span class="annot"><span class="annottext">Callback
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144322"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><a href="#local-6989586621680144317"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680144323"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144323"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Mark"><span class="hs-identifier hs-type">Mark</span></a></span><span> </span><span id="local-6989586621680144324"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144324"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">EnumSet Word64
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EnumMap Word64 Val
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144325"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144325"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; K -&gt; Int
</span><a href="#local-6989586621680144317"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144323"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144324"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144325"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><a href="#local-6989586621680144317"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680144326"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144326"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Push"><span class="hs-identifier hs-type">Push</span></a></span><span> </span><span id="local-6989586621680144327"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144327"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680144328"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144328"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">CombIx
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RSection Val
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144329"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144329"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>      </span><span class="annot"><span class="annottext">Int -&gt; K -&gt; Int
</span><a href="#local-6989586621680144317"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144326"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144327"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144328"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144329"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DataC"><span class="hs-identifier hs-type">DataC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.TypeTags.html#PackedTag"><span class="hs-identifier hs-type">PackedTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier hs-type">SegList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-419"></span><span class="hs-keyword">pattern</span><span> </span><span id="DataC"><span id="%24mDataC"><span id="%24bDataC"><span class="annot"><span class="annottext">$mDataC :: forall {r}.
BVal
-&gt; (Reference -&gt; PackedTag -&gt; SegList -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bDataC :: Reference -&gt; PackedTag -&gt; SegList -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#DataC"><span class="hs-identifier hs-var hs-var hs-var hs-var">DataC</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144332"><span class="hs-identifier hs-type">rf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144333"><span class="hs-identifier hs-type">ct</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144334"><span class="hs-identifier hs-type">segs</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#splitData"><span class="hs-identifier hs-type">splitData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144332"><span class="annot"><a href="#local-6989586621680144332"><span class="hs-identifier hs-var">rf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144333"><span class="annot"><a href="#local-6989586621680144333"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144334"><span class="annot"><a href="#local-6989586621680144334"><span class="hs-identifier hs-var">segs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#DataC"><span class="hs-identifier hs-var">DataC</span></a></span><span> </span><span id="local-6989586621680144335"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144335"><span class="hs-identifier hs-var">rf</span></a></span></span><span> </span><span id="local-6989586621680144336"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144336"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621680144337"><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144337"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; PackedTag -&gt; SegList -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#formData"><span class="hs-identifier hs-var">formData</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144335"><span class="hs-identifier hs-var">rf</span></a></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144336"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144337"><span class="hs-identifier hs-var">segs</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="annot"><a href="Unison.Runtime.Stack.html#matchCharVal"><span class="hs-identifier hs-type">matchCharVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-425"></span><span id="matchCharVal"><span class="annot"><span class="annottext">matchCharVal :: Val -&gt; Maybe Char
</span><a href="Unison.Runtime.Stack.html#matchCharVal"><span class="hs-identifier hs-var hs-var">matchCharVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier hs-type">UnboxedVal</span></a></span><span> </span><span id="local-6989586621680144339"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144339"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#CharTag"><span class="hs-identifier hs-var">CharTag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Maybe Char
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">Char.chr</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144339"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Char
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#CharVal"><span class="hs-identifier hs-type">CharVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-430"></span><span class="hs-keyword">pattern</span><span> </span><span id="CharVal"><span id="%24mCharVal"><span id="%24bCharVal"><span class="annot"><span class="annottext">$mCharVal :: forall {r}. Val -&gt; (Char -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bCharVal :: Char -&gt; Val
</span><a href="Unison.Runtime.Stack.html#CharVal"><span class="hs-identifier hs-var hs-var hs-var hs-var">CharVal</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144343"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#matchCharVal"><span class="hs-identifier hs-type">matchCharVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680144343"><span class="annot"><a href="#local-6989586621680144343"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#CharVal"><span class="hs-identifier hs-var">CharVal</span></a></span><span> </span><span id="local-6989586621680144344"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680144344"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">Char.ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680144344"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#charTypeTag"><span class="hs-identifier hs-var">charTypeTag</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="annot"><a href="Unison.Runtime.Stack.html#matchNatVal"><span class="hs-identifier hs-type">matchNatVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-435"></span><span id="matchNatVal"><span class="annot"><span class="annottext">matchNatVal :: Val -&gt; Maybe Word64
</span><a href="Unison.Runtime.Stack.html#matchNatVal"><span class="hs-identifier hs-var hs-var">matchNatVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier hs-type">UnboxedVal</span></a></span><span> </span><span id="local-6989586621680144348"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144348"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#NatTag"><span class="hs-identifier hs-var">NatTag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Maybe Word64
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144348"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>  </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Word64
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#NatVal"><span class="hs-identifier hs-type">NatVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-440"></span><span class="hs-keyword">pattern</span><span> </span><span id="NatVal"><span id="%24mNatVal"><span id="%24bNatVal"><span class="annot"><span class="annottext">$mNatVal :: forall {r}. Val -&gt; (Word64 -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bNatVal :: Word64 -&gt; Val
</span><a href="Unison.Runtime.Stack.html#NatVal"><span class="hs-identifier hs-var hs-var hs-var hs-var">NatVal</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144351"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#matchNatVal"><span class="hs-identifier hs-type">matchNatVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680144351"><span class="annot"><a href="#local-6989586621680144351"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#NatVal"><span class="hs-identifier hs-var">NatVal</span></a></span><span> </span><span id="local-6989586621680144352"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680144352"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680144352"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-identifier hs-var">natTypeTag</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="annot"><a href="Unison.Runtime.Stack.html#matchDoubleVal"><span class="hs-identifier hs-type">matchDoubleVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-445"></span><span id="matchDoubleVal"><span class="annot"><span class="annottext">matchDoubleVal :: Val -&gt; Maybe Double
</span><a href="Unison.Runtime.Stack.html#matchDoubleVal"><span class="hs-identifier hs-var hs-var">matchDoubleVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier hs-type">UnboxedVal</span></a></span><span> </span><span id="local-6989586621680144354"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144354"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#FloatTag"><span class="hs-identifier hs-var">FloatTag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Maybe Double
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
</span><a href="Unison.Runtime.Stack.html#intToDouble"><span class="hs-identifier hs-var">intToDouble</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144354"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>  </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Double
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DoubleVal"><span class="hs-identifier hs-type">DoubleVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-450"></span><span class="hs-keyword">pattern</span><span> </span><span id="DoubleVal"><span id="%24mDoubleVal"><span id="%24bDoubleVal"><span class="annot"><span class="annottext">$mDoubleVal :: forall {r}. Val -&gt; (Double -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bDoubleVal :: Double -&gt; Val
</span><a href="Unison.Runtime.Stack.html#DoubleVal"><span class="hs-identifier hs-var hs-var hs-var hs-var">DoubleVal</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144358"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#matchDoubleVal"><span class="hs-identifier hs-type">matchDoubleVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680144358"><span class="annot"><a href="#local-6989586621680144358"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-452"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#DoubleVal"><span class="hs-identifier hs-var">DoubleVal</span></a></span><span> </span><span id="local-6989586621680144359"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680144359"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Int
</span><a href="Unison.Runtime.Stack.html#doubleToInt"><span class="hs-identifier hs-var">doubleToInt</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680144359"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#floatTypeTag"><span class="hs-identifier hs-var">floatTypeTag</span></a></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="annot"><a href="Unison.Runtime.Stack.html#matchIntVal"><span class="hs-identifier hs-type">matchIntVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-455"></span><span id="matchIntVal"><span class="annot"><span class="annottext">matchIntVal :: Val -&gt; Maybe Int
</span><a href="Unison.Runtime.Stack.html#matchIntVal"><span class="hs-identifier hs-var hs-var">matchIntVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier hs-type">UnboxedVal</span></a></span><span> </span><span id="local-6989586621680144362"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144362"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnboxedTypeTag
</span><a href="Unison.Runtime.Stack.html#IntTag"><span class="hs-identifier hs-var">IntTag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144362"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-457"></span><span>  </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#IntVal"><span class="hs-identifier hs-type">IntVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-460"></span><span class="hs-keyword">pattern</span><span> </span><span id="IntVal"><span id="%24mIntVal"><span id="%24bIntVal"><span class="annot"><span class="annottext">$mIntVal :: forall {r}. Val -&gt; (Int -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bIntVal :: Int -&gt; Val
</span><a href="Unison.Runtime.Stack.html#IntVal"><span class="hs-identifier hs-var hs-var hs-var hs-var">IntVal</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144365"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#matchIntVal"><span class="hs-identifier hs-type">matchIntVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680144365"><span class="annot"><a href="#local-6989586621680144365"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-462"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#IntVal"><span class="hs-identifier hs-var">IntVal</span></a></span><span> </span><span id="local-6989586621680144366"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144366"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144366"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#intTypeTag"><span class="hs-identifier hs-var">intTypeTag</span></a></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="Unison.Runtime.Stack.html#matchBoolVal"><span class="hs-identifier hs-type">matchBoolVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-465"></span><span id="matchBoolVal"><span class="annot"><span class="annottext">matchBoolVal :: Val -&gt; Maybe Bool
</span><a href="Unison.Runtime.Stack.html#matchBoolVal"><span class="hs-identifier hs-var hs-var">matchBoolVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-type">BoxedVal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-type">Enum</span></a></span><span> </span><span id="local-6989586621680144368"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144368"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680144369"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144369"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680144368"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">Ty.booleanRef</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680144369"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">PackedTag -&gt; PackedTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="Unison.Runtime.TypeTags.html#falseTag"><span class="hs-identifier hs-var">TT.falseTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoolVal"><span class="hs-identifier hs-type">BoolVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-470"></span><span class="hs-keyword">pattern</span><span> </span><span id="BoolVal"><span id="%24mBoolVal"><span id="%24bBoolVal"><span class="annot"><span class="annottext">$mBoolVal :: forall {r}. Val -&gt; (Bool -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bBoolVal :: Bool -&gt; Val
</span><a href="Unison.Runtime.Stack.html#BoolVal"><span class="hs-identifier hs-var hs-var hs-var hs-var">BoolVal</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144374"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#matchBoolVal"><span class="hs-identifier hs-type">matchBoolVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680144374"><span class="annot"><a href="#local-6989586621680144374"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoolVal"><span class="hs-identifier hs-var">BoolVal</span></a></span><span> </span><span id="local-6989586621680144375"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144375"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144375"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="Unison.Runtime.Stack.html#trueVal"><span class="hs-identifier hs-var">trueVal</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="Unison.Runtime.Stack.html#falseVal"><span class="hs-identifier hs-var">falseVal</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="hs-comment">-- Define singletons we can use for the bools to prevent allocation where possible.</span><span>
</span><span id="line-475"></span><span class="annot"><a href="Unison.Runtime.Stack.html#falseVal"><span class="hs-identifier hs-type">falseVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-476"></span><span id="falseVal"><span class="annot"><span class="annottext">falseVal :: Val
</span><a href="Unison.Runtime.Stack.html#falseVal"><span class="hs-identifier hs-var hs-var">falseVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-var">BoxedVal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; PackedTag -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-var">Enum</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">Ty.booleanRef</span></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="Unison.Runtime.TypeTags.html#falseTag"><span class="hs-identifier hs-var">TT.falseTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#falseVal"><span class="hs-pragma hs-type">falseVal</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span class="annot"><a href="Unison.Runtime.Stack.html#trueVal"><span class="hs-identifier hs-type">trueVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-480"></span><span id="trueVal"><span class="annot"><span class="annottext">trueVal :: Val
</span><a href="Unison.Runtime.Stack.html#trueVal"><span class="hs-identifier hs-var hs-var">trueVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-var">BoxedVal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; PackedTag -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-var">Enum</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">Ty.booleanRef</span></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="Unison.Runtime.TypeTags.html#trueTag"><span class="hs-identifier hs-var">TT.trueTag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#trueVal"><span class="hs-pragma hs-type">trueVal</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="annot"><a href="Unison.Runtime.Stack.html#doubleToInt"><span class="hs-identifier hs-type">doubleToInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-484"></span><span id="doubleToInt"><span class="annot"><span class="annottext">doubleToInt :: Double -&gt; Int
</span><a href="Unison.Runtime.Stack.html#doubleToInt"><span class="hs-identifier hs-var hs-var">doubleToInt</span></a></span></span><span> </span><span id="local-6989586621680144377"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680144377"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Int
forall a. (() :: Constraint, Prim a) =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="Unison.Runtime.Array.html#indexByteArray"><span class="hs-identifier hs-var">indexByteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Double] -&gt; ByteArray
forall a. Prim a =&gt; [a] -&gt; ByteArray
</span><span class="hs-identifier hs-var">BA.byteArrayFromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680144377"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-485"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#doubleToInt"><span class="hs-pragma hs-type">doubleToInt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="annot"><a href="Unison.Runtime.Stack.html#intToDouble"><span class="hs-identifier hs-type">intToDouble</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-488"></span><span id="intToDouble"><span class="annot"><span class="annottext">intToDouble :: Int -&gt; Double
</span><a href="Unison.Runtime.Stack.html#intToDouble"><span class="hs-identifier hs-var hs-var">intToDouble</span></a></span></span><span> </span><span id="local-6989586621680144380"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144380"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Double
forall a. (() :: Constraint, Prim a) =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="Unison.Runtime.Array.html#indexByteArray"><span class="hs-identifier hs-var">indexByteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; ByteArray
forall a. Prim a =&gt; [a] -&gt; ByteArray
</span><span class="hs-identifier hs-var">BA.byteArrayFromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144380"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-489"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#intToDouble"><span class="hs-pragma hs-type">intToDouble</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span class="hs-keyword">type</span><span> </span><span id="SegList"><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier hs-var">SegList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#PApV"><span class="hs-identifier hs-type">PApV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#CombIx"><span class="hs-identifier hs-type">CombIx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#RCombInfo"><span class="hs-identifier hs-type">RCombInfo</span></a></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier hs-type">SegList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-494"></span><span class="hs-keyword">pattern</span><span> </span><span id="PApV"><span id="%24mPApV"><span id="%24bPApV"><span class="annot"><span class="annottext">$mPApV :: forall {r}.
BVal
-&gt; (CombIx -&gt; GCombInfo (RComb Val) -&gt; SegList -&gt; r)
-&gt; ((# #) -&gt; r)
-&gt; r
$bPApV :: CombIx -&gt; GCombInfo (RComb Val) -&gt; SegList -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#PApV"><span class="hs-identifier hs-var hs-var hs-var hs-var">PApV</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144384"><span class="hs-identifier hs-type">cix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144385"><span class="hs-identifier hs-type">rcomb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144386"><span class="hs-identifier hs-type">segs</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-495"></span><span>  </span><span class="annot"><a href="Unison.Runtime.Stack.html#PAp"><span class="hs-identifier hs-type">PAp</span></a></span><span> </span><span id="local-6989586621680144384"><span class="annot"><a href="#local-6989586621680144384"><span class="hs-identifier hs-var">cix</span></a></span></span><span> </span><span id="local-6989586621680144385"><span class="annot"><a href="#local-6989586621680144385"><span class="hs-identifier hs-var">rcomb</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#segToList"><span class="hs-identifier hs-type">segToList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680144386"><span class="annot"><a href="#local-6989586621680144386"><span class="hs-identifier hs-var">segs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-497"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#PApV"><span class="hs-identifier hs-var">PApV</span></a></span><span> </span><span id="local-6989586621680144387"><span class="annot"><span class="annottext">CombIx
</span><a href="#local-6989586621680144387"><span class="hs-identifier hs-var">cix</span></a></span></span><span> </span><span id="local-6989586621680144388"><span class="annot"><span class="annottext">GCombInfo (RComb Val)
</span><a href="#local-6989586621680144388"><span class="hs-identifier hs-var">rcomb</span></a></span></span><span> </span><span id="local-6989586621680144389"><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144389"><span class="hs-identifier hs-var">segs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CombIx -&gt; GCombInfo (RComb Val) -&gt; Seg -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#PAp"><span class="hs-identifier hs-var">PAp</span></a></span><span> </span><span class="annot"><span class="annottext">CombIx
</span><a href="#local-6989586621680144387"><span class="hs-identifier hs-var">cix</span></a></span><span> </span><span class="annot"><span class="annottext">GCombInfo (RComb Val)
</span><a href="#local-6989586621680144388"><span class="hs-identifier hs-var">rcomb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegList -&gt; Seg
</span><a href="Unison.Runtime.Stack.html#segFromList"><span class="hs-identifier hs-var">segFromList</span></a></span><span> </span><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144389"><span class="hs-identifier hs-var">segs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#CapV"><span class="hs-identifier hs-type">CapV</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-type">K</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier hs-type">SegList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-500"></span><span class="hs-keyword">pattern</span><span> </span><span id="CapV"><span id="%24mCapV"><span id="%24bCapV"><span class="annot"><span class="annottext">$mCapV :: forall {r}. BVal -&gt; (K -&gt; Int -&gt; SegList -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bCapV :: K -&gt; Int -&gt; SegList -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#CapV"><span class="hs-identifier hs-var hs-var hs-var hs-var">CapV</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144392"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144393"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144394"><span class="hs-identifier hs-type">segs</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Captured"><span class="hs-identifier hs-type">Captured</span></a></span><span> </span><span id="local-6989586621680144392"><span class="annot"><a href="#local-6989586621680144392"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680144393"><span class="annot"><a href="#local-6989586621680144393"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#segToList"><span class="hs-identifier hs-type">segToList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680144394"><span class="annot"><a href="#local-6989586621680144394"><span class="hs-identifier hs-var">segs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#CapV"><span class="hs-identifier hs-var">CapV</span></a></span><span> </span><span id="local-6989586621680144395"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144395"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621680144396"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144396"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680144397"><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144397"><span class="hs-identifier hs-var">segList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">K -&gt; Int -&gt; Seg -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Captured"><span class="hs-identifier hs-var">Captured</span></a></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680144395"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144396"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SegList -&gt; Seg
</span><a href="Unison.Runtime.Stack.html#segFromList"><span class="hs-identifier hs-var">segFromList</span></a></span><span> </span><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144397"><span class="hs-identifier hs-var">segList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="hs-comment">-- | Converts from the efficient stack form of a segment to the list representation. Segments are stored backwards,</span><span>
</span><span id="line-505"></span><span class="hs-comment">-- so this reverses the contents</span><span>
</span><span id="line-506"></span><span class="annot"><a href="Unison.Runtime.Stack.html#segToList"><span class="hs-identifier hs-type">segToList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier hs-type">SegList</span></a></span><span>
</span><span id="line-507"></span><span id="segToList"><span class="annot"><span class="annottext">segToList :: Seg -&gt; SegList
</span><a href="Unison.Runtime.Stack.html#segToList"><span class="hs-identifier hs-var hs-var">segToList</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144398"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144398"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144399"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144399"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-508"></span><span>  </span><span class="annot"><span class="annottext">(Int -&gt; BVal -&gt; Val) -&gt; [Int] -&gt; [BVal] -&gt; SegList
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray -&gt; [Int]
</span><a href="Unison.Runtime.Stack.html#ints"><span class="hs-identifier hs-var">ints</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144398"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BSeg -&gt; [BVal]
</span><a href="Unison.Runtime.Stack.html#bsegToList"><span class="hs-identifier hs-var">bsegToList</span></a></span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144399"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-comment">-- | Converts an unboxed segment to a list of integers for a more interchangeable</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- representation. The segments are stored in backwards order, so this reverses</span><span>
</span><span id="line-512"></span><span class="hs-comment">-- the contents.</span><span>
</span><span id="line-513"></span><span class="annot"><a href="Unison.Runtime.Stack.html#ints"><span class="hs-identifier hs-type">ints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteArray</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-514"></span><span id="ints"><span class="annot"><span class="annottext">ints :: ByteArray -&gt; [Int]
</span><a href="Unison.Runtime.Stack.html#ints"><span class="hs-identifier hs-var hs-var">ints</span></a></span></span><span> </span><span id="local-6989586621680144402"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144402"><span class="hs-identifier hs-var">ba</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Int
forall a. (() :: Constraint, Prim a) =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="Unison.Runtime.Array.html#indexByteArray"><span class="hs-identifier hs-var">indexByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144402"><span class="hs-identifier hs-var">ba</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144403"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144403"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-516"></span><span>    </span><span id="local-6989586621680144403"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621680144403"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int
</span><span class="hs-identifier hs-var">sizeofByteArray</span></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144402"><span class="hs-identifier hs-var">ba</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span class="hs-comment">-- | Converts from the list representation of a segment to the efficient stack form. Segments are stored backwards,</span><span>
</span><span id="line-519"></span><span class="hs-comment">-- so this reverses the contents.</span><span>
</span><span id="line-520"></span><span class="annot"><a href="Unison.Runtime.Stack.html#segFromList"><span class="hs-identifier hs-type">segFromList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SegList"><span class="hs-identifier hs-type">SegList</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span>
</span><span id="line-521"></span><span id="segFromList"><span class="annot"><span class="annottext">segFromList :: SegList -&gt; Seg
</span><a href="Unison.Runtime.Stack.html#segFromList"><span class="hs-identifier hs-var hs-var">segFromList</span></a></span></span><span> </span><span id="local-6989586621680144406"><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144406"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-522"></span><span>  </span><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680144406"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><span class="annottext">SegList -&gt; (SegList -&gt; ([Int], [BVal])) -&gt; ([Int], [BVal])
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Val -&gt; ([Int], [BVal])) -&gt; SegList -&gt; ([Int], [BVal])
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span id="local-6989586621680144409"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144409"><span class="hs-identifier hs-var">unboxed</span></a></span></span><span> </span><span id="local-6989586621680144410"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144410"><span class="hs-identifier hs-var">boxed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144409"><span class="hs-identifier hs-var">unboxed</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144410"><span class="hs-identifier hs-var">boxed</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>    </span><span class="annot"><span class="annottext">([Int], [BVal]) -&gt; (([Int], [BVal]) -&gt; Seg) -&gt; Seg
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680144411"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680144411"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144412"><span class="annot"><span class="annottext">[BVal]
</span><a href="#local-6989586621680144412"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; ByteArray
</span><a href="Unison.Runtime.Stack.html#useg"><span class="hs-identifier hs-var">useg</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680144411"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BVal] -&gt; BSeg
</span><a href="Unison.Runtime.Stack.html#bseg"><span class="hs-identifier hs-var">bseg</span></a></span><span> </span><span class="annot"><span class="annottext">[BVal]
</span><a href="#local-6989586621680144412"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="annot"><a href="Unison.Runtime.Stack.html#marshalToForeign"><span class="hs-identifier hs-type">marshalToForeign</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Foreign.html#Foreign"><span class="hs-identifier hs-type">Foreign</span></a></span><span>
</span><span id="line-529"></span><span id="marshalToForeign"><span class="annot"><span class="annottext">marshalToForeign :: HasCallStack =&gt; BVal -&gt; Foreign
</span><a href="Unison.Runtime.Stack.html#marshalToForeign"><span class="hs-identifier hs-var hs-var">marshalToForeign</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier hs-type">Foreign</span></a></span><span> </span><span id="local-6989586621680144420"><span class="annot"><span class="annottext">Foreign
</span><a href="#local-6989586621680144420"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Foreign
</span><a href="#local-6989586621680144420"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-530"></span><span class="annot"><a href="Unison.Runtime.Stack.html#marshalToForeign"><span class="hs-identifier hs-var">marshalToForeign</span></a></span><span> </span><span id="local-6989586621680144421"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144421"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-531"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Foreign
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Foreign) -&gt; String -&gt; Foreign
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;marshalToForeign: unhandled closure: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">BVal -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144421"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span class="hs-keyword">data</span><span> </span><span id="RuntimePanic"><span class="annot"><a href="Unison.Runtime.Stack.html#RuntimePanic"><span class="hs-identifier hs-var">RuntimePanic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Panic"><span class="annot"><a href="Unison.Runtime.Stack.html#Panic"><span class="hs-identifier hs-var">Panic</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144424"><span id="local-6989586621680144432"><span id="local-6989586621680144436"><span class="annot"><span class="annottext">Int -&gt; RuntimePanic -&gt; ShowS
[RuntimePanic] -&gt; ShowS
RuntimePanic -&gt; String
(Int -&gt; RuntimePanic -&gt; ShowS)
-&gt; (RuntimePanic -&gt; String)
-&gt; ([RuntimePanic] -&gt; ShowS)
-&gt; Show RuntimePanic
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; RuntimePanic -&gt; ShowS
showsPrec :: Int -&gt; RuntimePanic -&gt; ShowS
$cshow :: RuntimePanic -&gt; String
show :: RuntimePanic -&gt; String
$cshowList :: [RuntimePanic] -&gt; ShowS
showList :: [RuntimePanic] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680144444"><span id="local-6989586621680144447"><span id="local-6989586621680144450"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#RuntimePanic"><span class="hs-identifier hs-type">RuntimePanic</span></a></span></span></span></span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span id="local-6989586621680143170"><span class="annot"><a href="Unison.Runtime.Stack.html#marshalUnwrapForeignIO"><span class="hs-identifier hs-type">marshalUnwrapForeignIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680143170"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-539"></span><span id="marshalUnwrapForeignIO"><span class="annot"><span class="annottext">marshalUnwrapForeignIO :: forall a. HasCallStack =&gt; BVal -&gt; IO a
</span><a href="Unison.Runtime.Stack.html#marshalUnwrapForeignIO"><span class="hs-identifier hs-var hs-var">marshalUnwrapForeignIO</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier hs-type">Foreign</span></a></span><span> </span><span id="local-6989586621680144456"><span class="annot"><span class="annottext">Foreign
</span><a href="#local-6989586621680144456"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; IO a) -&gt; a -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Foreign -&gt; a
forall a. Foreign -&gt; a
</span><a href="Unison.Runtime.Foreign.html#unwrapForeign"><span class="hs-identifier hs-var">unwrapForeign</span></a></span><span> </span><span class="annot"><span class="annottext">Foreign
</span><a href="#local-6989586621680144456"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-540"></span><span class="annot"><a href="Unison.Runtime.Stack.html#marshalUnwrapForeignIO"><span class="hs-identifier hs-var">marshalUnwrapForeignIO</span></a></span><span> </span><span id="local-6989586621680144458"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144458"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><span class="annottext">RuntimePanic -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(RuntimePanic -&gt; IO a) -&gt; RuntimePanic -&gt; IO a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe Val -&gt; RuntimePanic
</span><a href="Unison.Runtime.Stack.html#Panic"><span class="hs-identifier hs-var">Panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;marshalUnwrapForeignIO: unhandled closure&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Val -&gt; Maybe Val
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="#local-6989586621680144459"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-543"></span><span>    </span><span id="local-6989586621680144459"><span class="annot"><span class="annottext">v :: Val
</span><a href="#local-6989586621680144459"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-var">BoxedVal</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144458"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span class="hs-keyword">type</span><span> </span><span id="Off"><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-var">Off</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="hs-keyword">type</span><span> </span><span id="SZ"><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-var">SZ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="hs-keyword">type</span><span> </span><span id="FP"><span class="annot"><a href="Unison.Runtime.Stack.html#FP"><span class="hs-identifier hs-var">FP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span class="hs-keyword">type</span><span> </span><span id="UA"><span class="annot"><a href="Unison.Runtime.Stack.html#UA"><span class="hs-identifier hs-var">UA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableByteArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimState</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="hs-keyword">type</span><span> </span><span id="BA"><span class="annot"><a href="Unison.Runtime.Stack.html#BA"><span class="hs-identifier hs-var">BA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimState</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span class="annot"><a href="Unison.Runtime.Stack.html#intSize"><span class="hs-identifier hs-type">intSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-556"></span><span id="intSize"><span class="annot"><span class="annottext">intSize :: Int
</span><a href="Unison.Runtime.Stack.html#intSize"><span class="hs-identifier hs-var hs-var">intSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Prim a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">sizeOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><a href="Unison.Runtime.Stack.html#words"><span class="hs-identifier hs-type">words</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-559"></span><span id="words"><span class="annot"><span class="annottext">words :: Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#words"><span class="hs-identifier hs-var hs-var">words</span></a></span></span><span> </span><span id="local-6989586621680144462"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144462"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144462"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Unison.Runtime.Stack.html#intSize"><span class="hs-identifier hs-var">intSize</span></a></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-type">bytes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-562"></span><span id="bytes"><span class="annot"><span class="annottext">bytes :: Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var hs-var">bytes</span></a></span></span><span> </span><span id="local-6989586621680144464"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144464"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144464"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Unison.Runtime.Stack.html#intSize"><span class="hs-identifier hs-var">intSize</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="hs-keyword">type</span><span> </span><span id="Arrs"><span class="annot"><a href="Unison.Runtime.Stack.html#Arrs"><span class="hs-identifier hs-var">Arrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#UA"><span class="hs-identifier hs-type">UA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BA"><span class="hs-identifier hs-type">BA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span class="annot"><a href="Unison.Runtime.Stack.html#argOnto"><span class="hs-identifier hs-type">argOnto</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Arrs"><span class="hs-identifier hs-type">Arrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Arrs"><span class="hs-identifier hs-type">Arrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#Args%27"><span class="hs-identifier hs-type">Args'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-567"></span><span id="argOnto"><span class="annot"><span class="annottext">argOnto :: Arrs -&gt; Int -&gt; Arrs -&gt; Int -&gt; Args' -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#argOnto"><span class="hs-identifier hs-var hs-var">argOnto</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144467"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144467"><span class="hs-identifier hs-var">srcUstk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144468"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144468"><span class="hs-identifier hs-var">srcBstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144469"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144469"><span class="hs-identifier hs-var">srcSp</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144470"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144470"><span class="hs-identifier hs-var">dstUstk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144471"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144471"><span class="hs-identifier hs-var">dstBstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144472"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144472"><span class="hs-identifier hs-var">dstSp</span></a></span></span><span> </span><span id="local-6989586621680144473"><span class="annot"><span class="annottext">Args'
</span><a href="#local-6989586621680144473"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-comment">-- Both new cp's should be the same, so we can just return one.</span><span>
</span><span id="line-569"></span><span>  </span><span id="local-6989586621680144474"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144474"><span class="hs-identifier hs-var">_cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; UA -&gt; Int -&gt; Args' -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#uargOnto"><span class="hs-identifier hs-var">uargOnto</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144467"><span class="hs-identifier hs-var">srcUstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144469"><span class="hs-identifier hs-var">srcSp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144470"><span class="hs-identifier hs-var">dstUstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144472"><span class="hs-identifier hs-var">dstSp</span></a></span><span> </span><span class="annot"><span class="annottext">Args'
</span><a href="#local-6989586621680144473"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-570"></span><span>  </span><span id="local-6989586621680144476"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144476"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BA -&gt; Int -&gt; Args' -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#bargOnto"><span class="hs-identifier hs-var">bargOnto</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144468"><span class="hs-identifier hs-var">srcBstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144469"><span class="hs-identifier hs-var">srcSp</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144471"><span class="hs-identifier hs-var">dstBstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144472"><span class="hs-identifier hs-var">dstSp</span></a></span><span> </span><span class="annot"><span class="annottext">Args'
</span><a href="#local-6989586621680144473"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144476"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span class="hs-comment">-- The Caller must ensure that when setting the unboxed stack, the equivalent</span><span>
</span><span id="line-574"></span><span class="hs-comment">-- boxed stack is zeroed out to BlackHole where necessary.</span><span>
</span><span id="line-575"></span><span class="annot"><a href="Unison.Runtime.Stack.html#uargOnto"><span class="hs-identifier hs-type">uargOnto</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UA"><span class="hs-identifier hs-type">UA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UA"><span class="hs-identifier hs-type">UA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#Args%27"><span class="hs-identifier hs-type">Args'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-576"></span><span id="uargOnto"><span class="annot"><span class="annottext">uargOnto :: UA -&gt; Int -&gt; UA -&gt; Int -&gt; Args' -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#uargOnto"><span class="hs-identifier hs-var hs-var">uargOnto</span></a></span></span><span> </span><span id="local-6989586621680144478"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144478"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144479"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144479"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144480"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144480"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621680144481"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144481"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#Arg1"><span class="hs-identifier hs-type">Arg1</span></a></span><span> </span><span id="local-6989586621680144483"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144483"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680144484"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144484"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144478"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144479"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144483"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144480"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144487"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144484"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144487"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-580"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621680144487"><span class="annot"><span class="annottext">cp :: Int
</span><a href="#local-6989586621680144487"><span class="hs-identifier hs-var hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144481"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-582"></span><span class="annot"><a href="Unison.Runtime.Stack.html#uargOnto"><span class="hs-identifier hs-var">uargOnto</span></a></span><span> </span><span id="local-6989586621680144488"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144488"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144489"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144489"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144490"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144490"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621680144491"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144491"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#Arg2"><span class="hs-identifier hs-type">Arg2</span></a></span><span> </span><span id="local-6989586621680144493"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144493"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144494"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144494"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680144495"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144495"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144488"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144489"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144493"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680144496"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144496"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144488"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144489"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144494"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144490"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144497"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144495"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-586"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144490"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144497"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144496"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144497"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-589"></span><span>    </span><span id="local-6989586621680144497"><span class="annot"><span class="annottext">cp :: Int
</span><a href="#local-6989586621680144497"><span class="hs-identifier hs-var hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144491"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-590"></span><span class="annot"><a href="Unison.Runtime.Stack.html#uargOnto"><span class="hs-identifier hs-var">uargOnto</span></a></span><span> </span><span id="local-6989586621680144498"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144498"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144499"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144499"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144500"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144500"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621680144501"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144501"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgN"><span class="hs-identifier hs-type">ArgN</span></a></span><span> </span><span id="local-6989586621680144503"><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144503"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-591"></span><span>  </span><span id="local-6989586621680144504"><span class="annot"><span class="annottext">MutableByteArray RealWorld
</span><a href="#local-6989586621680144504"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-592"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144505"><span class="hs-identifier hs-var">overwrite</span></a></span><span>
</span><span id="line-593"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO UA
forall (m :: * -&gt; *).
PrimMonad m =&gt;
Int -&gt; m (MutableByteArray (PrimState m))
</span><span class="hs-identifier hs-var">newByteArray</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO UA) -&gt; Int -&gt; IO UA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144507"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-594"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld -&gt; IO (MutableByteArray RealWorld)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144500"><span class="hs-identifier hs-var">cop</span></a></span><span>
</span><span id="line-595"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680144508"><span class="annot"><span class="annottext">loop :: Int -&gt; IO ()
</span><a href="#local-6989586621680144508"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621680144509"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144509"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144509"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-598"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680144511"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144511"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144498"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144499"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">PrimArray Int -&gt; Int -&gt; Int
forall a. (() :: Constraint, Prim a) =&gt; PrimArray a -&gt; Int -&gt; a
</span><a href="Unison.Runtime.Array.html#indexPrimArray"><span class="hs-identifier hs-var">indexPrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144503"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144509"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>            </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144504"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144513"><span class="hs-identifier hs-var">boff</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144509"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144511"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-600"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621680144508"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; Int -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144509"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-601"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621680144508"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; Int -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144507"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-602"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144505"><span class="hs-identifier hs-var">overwrite</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-603"></span><span>    </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; UA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *).
(() :: Constraint, PrimMonad m) =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; MutableByteArray (PrimState m) -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableByteArray"><span class="hs-identifier hs-var">copyMutableByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144500"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144501"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144504"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144507"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144516"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-606"></span><span>    </span><span id="local-6989586621680144516"><span class="annot"><span class="annottext">cp :: Int
</span><a href="#local-6989586621680144516"><span class="hs-identifier hs-var hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144501"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144507"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-607"></span><span>    </span><span id="local-6989586621680144507"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621680144507"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimArray Int -&gt; Int
forall a. Prim a =&gt; PrimArray a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofPrimArray</span></span><span> </span><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144503"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-608"></span><span>    </span><span id="local-6989586621680144505"><span class="annot"><span class="annottext">overwrite :: Bool
</span><a href="#local-6989586621680144505"><span class="hs-identifier hs-var hs-var">overwrite</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld -&gt; MutableByteArray RealWorld -&gt; Bool
forall s. MutableByteArray s -&gt; MutableByteArray s -&gt; Bool
</span><span class="hs-identifier hs-var">sameMutableByteArray</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144498"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144500"><span class="hs-identifier hs-var">cop</span></a></span><span>
</span><span id="line-609"></span><span>    </span><span id="local-6989586621680144513"><span class="annot"><span class="annottext">boff :: Int
</span><a href="#local-6989586621680144513"><span class="hs-identifier hs-var hs-var">boff</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144505"><span class="hs-identifier hs-var">overwrite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144507"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144501"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144507"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-610"></span><span class="annot"><a href="Unison.Runtime.Stack.html#uargOnto"><span class="hs-identifier hs-var">uargOnto</span></a></span><span> </span><span id="local-6989586621680144519"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144519"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144520"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144520"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144521"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144521"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621680144522"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144522"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgR"><span class="hs-identifier hs-type">ArgR</span></a></span><span> </span><span id="local-6989586621680144524"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144524"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144525"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144525"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-611"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; UA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *).
(() :: Constraint, PrimMonad m) =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; MutableByteArray (PrimState m) -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#moveByteArray"><span class="hs-identifier hs-var">moveByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144521"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144527"><span class="hs-identifier hs-var">cbp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144519"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144528"><span class="hs-identifier hs-var">sbp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144525"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144522"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144525"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-614"></span><span>    </span><span id="local-6989586621680144527"><span class="annot"><span class="annottext">cbp :: Int
</span><a href="#local-6989586621680144527"><span class="hs-identifier hs-var hs-var">cbp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144522"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-615"></span><span>    </span><span id="local-6989586621680144528"><span class="annot"><span class="annottext">sbp :: Int
</span><a href="#local-6989586621680144528"><span class="hs-identifier hs-var hs-var">sbp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144520"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144524"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144525"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bargOnto"><span class="hs-identifier hs-type">bargOnto</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BA"><span class="hs-identifier hs-type">BA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BA"><span class="hs-identifier hs-type">BA</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#Args%27"><span class="hs-identifier hs-type">Args'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-618"></span><span id="bargOnto"><span class="annot"><span class="annottext">bargOnto :: BA -&gt; Int -&gt; BA -&gt; Int -&gt; Args' -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#bargOnto"><span class="hs-identifier hs-var hs-var">bargOnto</span></a></span></span><span> </span><span id="local-6989586621680144529"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144529"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144530"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144530"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144531"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144531"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621680144532"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144532"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#Arg1"><span class="hs-identifier hs-type">Arg1</span></a></span><span> </span><span id="local-6989586621680144533"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144533"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-619"></span><span>  </span><span id="local-6989586621680144534"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144534"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; IO BVal
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144529"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144530"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144533"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>  </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BVal -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144531"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144537"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144534"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144537"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-622"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-623"></span><span>    </span><span id="local-6989586621680144537"><span class="annot"><span class="annottext">cp :: Int
</span><a href="#local-6989586621680144537"><span class="hs-identifier hs-var hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144532"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-624"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bargOnto"><span class="hs-identifier hs-var">bargOnto</span></a></span><span> </span><span id="local-6989586621680144538"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144538"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144539"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144539"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144540"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144540"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621680144541"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144541"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#Arg2"><span class="hs-identifier hs-type">Arg2</span></a></span><span> </span><span id="local-6989586621680144542"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144542"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144543"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144543"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-625"></span><span>  </span><span id="local-6989586621680144544"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144544"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; IO BVal
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144538"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144539"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144542"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>  </span><span id="local-6989586621680144545"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144545"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; IO BVal
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144538"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144539"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144543"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>  </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BVal -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144540"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144546"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144544"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BVal -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144540"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144546"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144545"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144546"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-631"></span><span>    </span><span id="local-6989586621680144546"><span class="annot"><span class="annottext">cp :: Int
</span><a href="#local-6989586621680144546"><span class="hs-identifier hs-var hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144541"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-632"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bargOnto"><span class="hs-identifier hs-var">bargOnto</span></a></span><span> </span><span id="local-6989586621680144547"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144547"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144548"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144548"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144549"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144549"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621680144550"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144550"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgN"><span class="hs-identifier hs-type">ArgN</span></a></span><span> </span><span id="local-6989586621680144551"><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144551"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>  </span><span id="local-6989586621680144552"><span class="annot"><span class="annottext">MutableArray RealWorld BVal
</span><a href="#local-6989586621680144552"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-634"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144553"><span class="hs-identifier hs-var">overwrite</span></a></span><span>
</span><span id="line-635"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; IO BA
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
Int -&gt; a -&gt; m (MutableArray (PrimState m) a)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144555"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">(BVal -&gt; IO BA) -&gt; BVal -&gt; IO BA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span>
</span><span id="line-636"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal -&gt; IO (MutableArray RealWorld BVal)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144549"><span class="hs-identifier hs-var">cop</span></a></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680144556"><span class="annot"><span class="annottext">loop :: Int -&gt; IO ()
</span><a href="#local-6989586621680144556"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621680144557"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144557"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-638"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144557"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-640"></span><span>            </span><span id="local-6989586621680144558"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144558"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; IO BVal
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144547"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO BVal) -&gt; Int -&gt; IO BVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144548"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">PrimArray Int -&gt; Int -&gt; Int
forall a. (() :: Constraint, Prim a) =&gt; PrimArray a -&gt; Int -&gt; a
</span><a href="Unison.Runtime.Array.html#indexPrimArray"><span class="hs-identifier hs-var">indexPrimArray</span></a></span><span> </span><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144551"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144557"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-641"></span><span>            </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BVal -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144552"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144559"><span class="hs-identifier hs-var">boff</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144557"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144558"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-642"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621680144556"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; Int -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144557"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-643"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621680144556"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; Int -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144555"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144553"><span class="hs-identifier hs-var">overwrite</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; MutableArray (PrimState m) a -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableArray"><span class="hs-identifier hs-var">copyMutableArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144549"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144550"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144552"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144555"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144561"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-648"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-649"></span><span>    </span><span id="local-6989586621680144561"><span class="annot"><span class="annottext">cp :: Int
</span><a href="#local-6989586621680144561"><span class="hs-identifier hs-var hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144550"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144555"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-650"></span><span>    </span><span id="local-6989586621680144555"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621680144555"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimArray Int -&gt; Int
forall a. Prim a =&gt; PrimArray a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofPrimArray</span></span><span> </span><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144551"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-651"></span><span>    </span><span id="local-6989586621680144553"><span class="annot"><span class="annottext">overwrite :: Bool
</span><a href="#local-6989586621680144553"><span class="hs-identifier hs-var hs-var">overwrite</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144547"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal -&gt; MutableArray RealWorld BVal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144549"><span class="hs-identifier hs-var">cop</span></a></span><span>
</span><span id="line-652"></span><span>    </span><span id="local-6989586621680144559"><span class="annot"><span class="annottext">boff :: Int
</span><a href="#local-6989586621680144559"><span class="hs-identifier hs-var hs-var">boff</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144553"><span class="hs-identifier hs-var">overwrite</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144555"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144550"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144555"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-653"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bargOnto"><span class="hs-identifier hs-var">bargOnto</span></a></span><span> </span><span id="local-6989586621680144562"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144562"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144563"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144563"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144564"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144564"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span id="local-6989586621680144565"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144565"><span class="hs-identifier hs-var">cp0</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgR"><span class="hs-identifier hs-type">ArgR</span></a></span><span> </span><span id="local-6989586621680144566"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144566"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144567"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144567"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-654"></span><span>  </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; MutableArray (PrimState m) a -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableArray"><span class="hs-identifier hs-var">copyMutableArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144564"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144565"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144562"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144563"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144566"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144567"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144567"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-655"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144565"><span class="hs-identifier hs-var">cp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144567"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span class="hs-keyword">data</span><span> </span><span id="Dump"><span class="annot"><a href="Unison.Runtime.Stack.html#Dump"><span class="hs-identifier hs-var">Dump</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="A"><span class="annot"><a href="Unison.Runtime.Stack.html#A"><span class="hs-identifier hs-var">A</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="F"><span class="annot"><a href="Unison.Runtime.Stack.html#F"><span class="hs-identifier hs-var">F</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="S"><span class="annot"><a href="Unison.Runtime.Stack.html#S"><span class="hs-identifier hs-var">S</span></a></span></span><span>
</span><span id="line-658"></span><span>
</span><span id="line-659"></span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpAP"><span class="hs-identifier hs-type">dumpAP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Dump"><span class="hs-identifier hs-type">Dump</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-660"></span><span id="dumpAP"><span class="annot"><span class="annottext">dumpAP :: Int -&gt; Int -&gt; Int -&gt; Dump -&gt; Int
</span><a href="Unison.Runtime.Stack.html#dumpAP"><span class="hs-identifier hs-var hs-var">dumpAP</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144571"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144571"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144572"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144572"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span id="local-6989586621680144573"><span class="annot"><span class="annottext">d :: Dump
</span><a href="#local-6989586621680144573"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144574"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144574"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Dump -&gt; Int
</span><a href="Unison.Runtime.Stack.html#dumpFP"><span class="hs-identifier hs-var">dumpFP</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144571"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144572"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Dump
</span><a href="#local-6989586621680144573"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144574"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-661"></span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpAP"><span class="hs-identifier hs-var">dumpAP</span></a></span><span> </span><span id="local-6989586621680144575"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144575"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Dump
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144575"><span class="hs-identifier hs-var">ap</span></a></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpFP"><span class="hs-identifier hs-type">dumpFP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Dump"><span class="hs-identifier hs-type">Dump</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-664"></span><span id="dumpFP"><span class="annot"><span class="annottext">dumpFP :: Int -&gt; Int -&gt; Dump -&gt; Int
</span><a href="Unison.Runtime.Stack.html#dumpFP"><span class="hs-identifier hs-var hs-var">dumpFP</span></a></span></span><span> </span><span id="local-6989586621680144576"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144576"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Dump
</span><a href="Unison.Runtime.Stack.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144576"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-665"></span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpFP"><span class="hs-identifier hs-var">dumpFP</span></a></span><span> </span><span id="local-6989586621680144577"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144577"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144578"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144578"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="annot"><span class="annottext">Dump
</span><a href="Unison.Runtime.Stack.html#A"><span class="hs-identifier hs-var">A</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144577"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144578"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-666"></span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpFP"><span class="hs-identifier hs-var">dumpFP</span></a></span><span> </span><span id="local-6989586621680144579"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144579"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144580"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144580"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span id="local-6989586621680144581"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144581"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144579"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144580"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144581"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="hs-comment">-- closure augmentation mode</span><span>
</span><span id="line-669"></span><span class="hs-comment">-- instruction, kontinuation, call</span><span>
</span><span id="line-670"></span><span class="hs-keyword">data</span><span> </span><span id="Augment"><span class="annot"><a href="Unison.Runtime.Stack.html#Augment"><span class="hs-identifier hs-var">Augment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="I"><span class="annot"><a href="Unison.Runtime.Stack.html#I"><span class="hs-identifier hs-var">I</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="K"><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-var">K</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="C"><span class="annot"><a href="Unison.Runtime.Stack.html#C"><span class="hs-identifier hs-var">C</span></a></span></span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span class="hs-keyword">data</span><span> </span><span id="Stack"><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Stack"><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span></span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aap%3AStack"><span class="annot"><span class="annottext">Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Aap%3AStack"><span class="hs-identifier hs-var hs-var">ap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- arg pointer</span><span>
</span><span id="line-674"></span><span>    </span><span id="%24sel%3Afp%3AStack"><span class="annot"><span class="annottext">Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Afp%3AStack"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- frame pointer</span><span>
</span><span id="line-675"></span><span>    </span><span id="%24sel%3Asp%3AStack"><span class="annot"><span class="annottext">Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Asp%3AStack"><span class="hs-identifier hs-var hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- stack pointer</span><span>
</span><span id="line-676"></span><span>    </span><span id="%24sel%3Austk%3AStack"><span class="annot"><span class="annottext">Stack -&gt; UA
</span><a href="Unison.Runtime.Stack.html#%24sel%3Austk%3AStack"><span class="hs-identifier hs-var hs-var">ustk</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableByteArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimState</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-677"></span><span>    </span><span id="%24sel%3Abstk%3AStack"><span class="annot"><span class="annottext">Stack -&gt; BA
</span><a href="Unison.Runtime.Stack.html#%24sel%3Abstk%3AStack"><span class="hs-identifier hs-var hs-var">bstk</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimState</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span class="hs-comment">-- Unboxed representation of the Stack, used to force GHC optimizations in a few spots.</span><span>
</span><span id="line-681"></span><span class="hs-keyword">type</span><span> </span><span id="XStack"><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier hs-var">XStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableByteArray#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimState</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableArray#</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimState</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="hs-keyword">type</span><span> </span><span id="IOXStack"><span class="annot"><a href="Unison.Runtime.Stack.html#IOXStack"><span class="hs-identifier hs-var">IOXStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier hs-type">XStack</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="hs-keyword">type</span><span> </span><span id="IOEXStack"><span class="annot"><a href="Unison.Runtime.Stack.html#IOEXStack"><span class="hs-identifier hs-var">IOEXStack</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-686"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">State#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier hs-type">XStack</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier hs-type">XStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int#</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableByteArray#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MutableArray#</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RealWorld</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-689"></span><span class="hs-keyword">pattern</span><span> </span><span id="XStack"><span id="%24mXStack"><span id="%24bXStack"><span class="annot"><span class="annottext">$mXStack :: forall {r}.
Stack
-&gt; (Int#
    -&gt; Int#
    -&gt; Int#
    -&gt; MutableByteArray# RealWorld
    -&gt; MutableArray# RealWorld BVal
    -&gt; r)
-&gt; ((# #) -&gt; r)
-&gt; r
$bXStack :: Int#
-&gt; Int#
-&gt; Int#
-&gt; MutableByteArray# RealWorld
-&gt; MutableArray# RealWorld BVal
-&gt; Stack
</span><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier hs-var hs-var hs-var">XStack</span></a></span></span></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AapX%3AXStack"><span class="annot"><span class="annottext">Stack -&gt; Int#
</span><a href="Unison.Runtime.Stack.html#%24sel%3AapX%3AXStack"><span class="hs-identifier hs-var hs-var hs-var">apX</span></a></span></span><span class="hs-special">,</span><span> </span><span id="%24sel%3AfpX%3AXStack"><span class="annot"><span class="annottext">Stack -&gt; Int#
</span><a href="Unison.Runtime.Stack.html#%24sel%3AfpX%3AXStack"><span class="hs-identifier hs-var hs-var hs-var">fpX</span></a></span></span><span class="hs-special">,</span><span> </span><span id="%24sel%3AspX%3AXStack"><span class="annot"><span class="annottext">Stack -&gt; Int#
</span><a href="Unison.Runtime.Stack.html#%24sel%3AspX%3AXStack"><span class="hs-identifier hs-var hs-var hs-var">spX</span></a></span></span><span class="hs-special">,</span><span> </span><span id="%24sel%3AustkX%3AXStack"><span class="annot"><span class="annottext">Stack -&gt; MutableByteArray# RealWorld
</span><a href="Unison.Runtime.Stack.html#%24sel%3AustkX%3AXStack"><span class="hs-identifier hs-var hs-var hs-var">ustkX</span></a></span></span><span class="hs-special">,</span><span> </span><span id="%24sel%3AbstkX%3AXStack"><span class="annot"><span class="annottext">Stack -&gt; MutableArray# RealWorld BVal
</span><a href="Unison.Runtime.Stack.html#%24sel%3AbstkX%3AXStack"><span class="hs-identifier hs-var hs-var hs-var">bstkX</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680144593"><span class="annot"><a href="#local-6989586621680144593"><span class="hs-identifier hs-var">apX</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680144594"><span class="annot"><a href="#local-6989586621680144594"><span class="hs-identifier hs-var">fpX</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680144595"><span class="annot"><a href="#local-6989586621680144595"><span class="hs-identifier hs-var">spX</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableByteArray</span></span><span> </span><span id="local-6989586621680144596"><span class="annot"><a href="#local-6989586621680144596"><span class="hs-identifier hs-var">ustkX</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span id="local-6989586621680144597"><span class="annot"><a href="#local-6989586621680144597"><span class="hs-identifier hs-var">bstkX</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-pragma hs-type">XStack</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-pragma hs-type">XStack</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span class="annot"><a href="Unison.Runtime.Stack.html#packXStack"><span class="hs-identifier hs-type">packXStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier hs-type">XStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-696"></span><span id="packXStack"><span class="annot"><span class="annottext">packXStack :: XStack -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#packXStack"><span class="hs-identifier hs-var hs-var">packXStack</span></a></span></span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680144600"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144600"><span class="hs-identifier hs-var">ap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144601"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144601"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144602"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144602"><span class="hs-identifier hs-var">sp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144603"><span class="annot"><span class="annottext">MutableByteArray# (PrimState IO)
</span><a href="#local-6989586621680144603"><span class="hs-identifier hs-var">ustk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144604"><span class="annot"><span class="annottext">MutableArray# (PrimState IO) BVal
</span><a href="#local-6989586621680144604"><span class="hs-identifier hs-var">bstk</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:ap:Stack :: Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Aap%3AStack"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144600"><span class="hs-identifier hs-var">ap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fp:Stack :: Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Afp%3AStack"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144601"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:sp:Stack :: Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Asp%3AStack"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int# -&gt; Int
</span><span class="hs-identifier hs-var">I#</span></span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144602"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:ustk:Stack :: UA
</span><a href="Unison.Runtime.Stack.html#%24sel%3Austk%3AStack"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# RealWorld -&gt; MutableByteArray RealWorld
forall s. MutableByteArray# s -&gt; MutableByteArray s
</span><span class="hs-identifier hs-var">MutableByteArray</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray# RealWorld
MutableByteArray# (PrimState IO)
</span><a href="#local-6989586621680144603"><span class="hs-identifier hs-var">ustk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:bstk:Stack :: BA
</span><a href="Unison.Runtime.Stack.html#%24sel%3Abstk%3AStack"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld BVal -&gt; MutableArray RealWorld BVal
forall s a. MutableArray# s a -&gt; MutableArray s a
</span><span class="hs-identifier hs-var">MutableArray</span></span><span> </span><span class="annot"><span class="annottext">MutableArray# RealWorld BVal
MutableArray# (PrimState IO) BVal
</span><a href="#local-6989586621680144604"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-697"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#packXStack"><span class="hs-pragma hs-type">packXStack</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span class="annot"><a href="Unison.Runtime.Stack.html#unpackXStack"><span class="hs-identifier hs-type">unpackXStack</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#XStack"><span class="hs-identifier hs-type">XStack</span></a></span><span>
</span><span id="line-700"></span><span id="unpackXStack"><span class="annot"><span class="annottext">unpackXStack :: Stack -&gt; XStack
</span><a href="Unison.Runtime.Stack.html#unpackXStack"><span class="hs-identifier hs-var hs-var">unpackXStack</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680144605"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144605"><span class="hs-identifier hs-var">ap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680144606"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144606"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I#</span></span><span> </span><span id="local-6989586621680144607"><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144607"><span class="hs-identifier hs-var">sp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableByteArray</span></span><span> </span><span id="local-6989586621680144608"><span class="annot"><span class="annottext">MutableByteArray# (PrimState IO)
</span><a href="#local-6989586621680144608"><span class="hs-identifier hs-var">ustk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MutableArray</span></span><span> </span><span id="local-6989586621680144609"><span class="annot"><span class="annottext">MutableArray# (PrimState IO) BVal
</span><a href="#local-6989586621680144609"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144605"><span class="hs-identifier hs-var">ap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144606"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int#
</span><a href="#local-6989586621680144607"><span class="hs-identifier hs-var">sp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MutableByteArray# (PrimState IO)
</span><a href="#local-6989586621680144608"><span class="hs-identifier hs-var">ustk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MutableArray# (PrimState IO) BVal
</span><a href="#local-6989586621680144609"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-701"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#unpackXStack"><span class="hs-pragma hs-type">unpackXStack</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span class="annot"><a href="Unison.Runtime.Stack.html#xStackIOToIO"><span class="hs-identifier hs-type">xStackIOToIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#IOXStack"><span class="hs-identifier hs-type">IOXStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-704"></span><span id="xStackIOToIO"><span class="annot"><span class="annottext">xStackIOToIO :: IOXStack -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#xStackIOToIO"><span class="hs-identifier hs-var hs-var">xStackIOToIO</span></a></span></span><span> </span><span id="local-6989586621680144610"><span class="annot"><span class="annottext">IOXStack
</span><a href="#local-6989586621680144610"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, Stack #)) -&gt; IO Stack
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, Stack #)) -&gt; IO Stack)
-&gt; (State# RealWorld -&gt; (# State# RealWorld, Stack #)) -&gt; IO Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680144611"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144611"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOXStack
</span><a href="#local-6989586621680144610"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144611"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680144612"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144612"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144613"><span class="annot"><span class="annottext">XStack
</span><a href="#local-6989586621680144613"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144612"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XStack -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#packXStack"><span class="hs-identifier hs-var">packXStack</span></a></span><span> </span><span class="annot"><span class="annottext">XStack
</span><a href="#local-6989586621680144613"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-705"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#xStackIOToIO"><span class="hs-pragma hs-type">xStackIOToIO</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="annot"><a href="Unison.Runtime.Stack.html#stackIOToIOX"><span class="hs-identifier hs-type">stackIOToIOX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#IOXStack"><span class="hs-identifier hs-type">IOXStack</span></a></span><span>
</span><span id="line-708"></span><span id="stackIOToIOX"><span class="annot"><span class="annottext">stackIOToIOX :: IO Stack -&gt; IOXStack
</span><a href="Unison.Runtime.Stack.html#stackIOToIOX"><span class="hs-identifier hs-var hs-var">stackIOToIOX</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span id="local-6989586621680144614"><span class="annot"><span class="annottext">State# RealWorld -&gt; (# State# RealWorld, Stack #)
</span><a href="#local-6989586621680144614"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680144615"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144615"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State# RealWorld -&gt; (# State# RealWorld, Stack #)
</span><a href="#local-6989586621680144614"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144615"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680144616"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144616"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144617"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144617"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144616"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; XStack
</span><a href="Unison.Runtime.Stack.html#unpackXStack"><span class="hs-identifier hs-var">unpackXStack</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144617"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-709"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#stackIOToIOX"><span class="hs-pragma hs-type">stackIOToIOX</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span class="annot"><a href="Unison.Runtime.Stack.html#estackIOToIOX"><span class="hs-identifier hs-type">estackIOToIOX</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#IOEXStack"><span class="hs-identifier hs-type">IOEXStack</span></a></span><span>
</span><span id="line-712"></span><span id="estackIOToIOX"><span class="annot"><span class="annottext">estackIOToIOX :: IO (Bool, Stack) -&gt; IOEXStack
</span><a href="Unison.Runtime.Stack.html#estackIOToIOX"><span class="hs-identifier hs-var hs-var">estackIOToIOX</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span id="local-6989586621680144618"><span class="annot"><span class="annottext">State# RealWorld -&gt; (# State# RealWorld, (Bool, Stack) #)
</span><a href="#local-6989586621680144618"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680144619"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144619"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State# RealWorld -&gt; (# State# RealWorld, (Bool, Stack) #)
</span><a href="#local-6989586621680144618"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144619"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680144620"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144620"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144621"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144621"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144622"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144622"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144620"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144621"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; XStack
</span><a href="Unison.Runtime.Stack.html#unpackXStack"><span class="hs-identifier hs-var">unpackXStack</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144622"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span class="annot"><a href="Unison.Runtime.Stack.html#exStackIOToIO"><span class="hs-identifier hs-type">exStackIOToIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#IOEXStack"><span class="hs-identifier hs-type">IOEXStack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span id="exStackIOToIO"><span class="annot"><span class="annottext">exStackIOToIO :: IOEXStack -&gt; IO (Bool, Stack)
</span><a href="Unison.Runtime.Stack.html#exStackIOToIO"><span class="hs-identifier hs-var hs-var">exStackIOToIO</span></a></span></span><span> </span><span id="local-6989586621680144623"><span class="annot"><span class="annottext">IOEXStack
</span><a href="#local-6989586621680144623"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(State# RealWorld -&gt; (# State# RealWorld, (Bool, Stack) #))
-&gt; IO (Bool, Stack)
forall a. (State# RealWorld -&gt; (# State# RealWorld, a #)) -&gt; IO a
</span><span class="hs-identifier hs-var">IO</span></span><span> </span><span class="annot"><span class="annottext">((State# RealWorld -&gt; (# State# RealWorld, (Bool, Stack) #))
 -&gt; IO (Bool, Stack))
-&gt; (State# RealWorld -&gt; (# State# RealWorld, (Bool, Stack) #))
-&gt; IO (Bool, Stack)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680144624"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144624"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOEXStack
</span><a href="#local-6989586621680144623"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144624"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-special">(#</span><span> </span><span id="local-6989586621680144625"><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144625"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144626"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144626"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144627"><span class="annot"><span class="annottext">XStack
</span><a href="#local-6989586621680144627"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">#)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(#</span><span> </span><span class="annot"><span class="annottext">State# RealWorld
</span><a href="#local-6989586621680144625"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144626"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">XStack -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#packXStack"><span class="hs-identifier hs-var">packXStack</span></a></span><span> </span><span class="annot"><span class="annottext">XStack
</span><a href="#local-6989586621680144627"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">#)</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680144629"><span id="local-6989586621680144634"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-720"></span><span>  </span><span id="local-6989586621680144643"><span class="annot"><span class="annottext">show :: Stack -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144644"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144644"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144645"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144645"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144646"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144646"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="annot"><span class="annottext">UA
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-721"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Stack &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144644"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144645"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144646"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="hs-keyword">type</span><span> </span><span id="UVal"><span class="annot"><a href="Unison.Runtime.Stack.html#UVal"><span class="hs-identifier hs-var">UVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="annot"><span class="hs-comment">-- | A runtime value, which is either a boxed or unboxed value, but we may not know which.</span></span><span>
</span><span id="line-726"></span><span class="hs-keyword">data</span><span> </span><span id="Val"><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Val"><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AgetUnboxedVal%3AVal"><span class="annot"><span class="annottext">Val -&gt; Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3AgetUnboxedVal%3AVal"><span class="hs-identifier hs-var hs-var">getUnboxedVal</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#UVal"><span class="hs-identifier hs-type">UVal</span></a></span><span class="hs-special">,</span><span> </span><span id="%24sel%3AgetBoxedVal%3AVal"><span class="annot"><span class="annottext">Val -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#%24sel%3AgetBoxedVal%3AVal"><span class="hs-identifier hs-var hs-var">getBoxedVal</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-type">BVal</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-comment">-- The Eq instance for Val is deliberately omitted because you need to take into account the fact that if a Val is boxed, the</span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-comment">-- unboxed side is garbage and should not be compared.</span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-comment">-- See universalEq.</span><span>
</span><span id="line-730"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144651"><span id="local-6989586621680144656"><span id="local-6989586621680144659"><span class="annot"><span class="annottext">Int -&gt; Val -&gt; ShowS
SegList -&gt; ShowS
Val -&gt; String
(Int -&gt; Val -&gt; ShowS)
-&gt; (Val -&gt; String) -&gt; (SegList -&gt; ShowS) -&gt; Show Val
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Val -&gt; ShowS
showsPrec :: Int -&gt; Val -&gt; ShowS
$cshow :: Val -&gt; String
show :: Val -&gt; String
$cshowList :: SegList -&gt; ShowS
showList :: SegList -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-731"></span><span>
</span><span id="line-732"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Unison.Runtime.Foreign.html#BuiltinForeign"><span class="hs-identifier hs-type">BuiltinForeign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-733"></span><span>  </span><span id="local-6989586621680144667"><span class="annot"><span class="annottext">foreignName :: Tagged (IORef Val) String
</span><a href="#local-6989586621680144667"><span class="hs-identifier hs-var hs-var hs-var hs-var">foreignName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Tagged (IORef Val) String
forall {k} (s :: k) b. b -&gt; Tagged s b
</span><span class="hs-identifier hs-var">Tagged</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;IORef&quot;</span></span><span>
</span><span id="line-734"></span><span>  </span><span id="local-6989586621680144670"><span class="annot"><span class="annottext">foreignRef :: Tagged (IORef Val) Reference
</span><a href="#local-6989586621680144670"><span class="hs-identifier hs-var hs-var hs-var hs-var">foreignRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Tagged (IORef Val) Reference
forall {k} (s :: k) b. b -&gt; Tagged s b
</span><span class="hs-identifier hs-var">Tagged</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">Ty.refRef</span></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span class="annot"><span class="hs-comment">-- | A nulled out value you can use when filling empty arrays, etc.</span></span><span>
</span><span id="line-737"></span><span class="annot"><a href="Unison.Runtime.Stack.html#emptyVal"><span class="hs-identifier hs-type">emptyVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-738"></span><span id="emptyVal"><span class="annot"><span class="annottext">emptyVal :: Val
</span><a href="Unison.Runtime.Stack.html#emptyVal"><span class="hs-identifier hs-var hs-var">emptyVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier hs-type">UnboxedVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier hs-type">UnboxedTypeTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-741"></span><span class="hs-keyword">pattern</span><span> </span><span id="UnboxedVal"><span id="%24mUnboxedVal"><span id="%24bUnboxedVal"><span class="annot"><span class="annottext">$mUnboxedVal :: forall {r}.
Val -&gt; (Int -&gt; UnboxedTypeTag -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bUnboxedVal :: Int -&gt; UnboxedTypeTag -&gt; Val
</span><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier hs-var hs-var hs-var">UnboxedVal</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144675"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680144676"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span id="local-6989586621680144675"><span class="annot"><a href="#local-6989586621680144675"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedTypeTag"><span class="hs-identifier hs-type">UnboxedTypeTag</span></a></span><span> </span><span id="local-6989586621680144676"><span class="annot"><a href="#local-6989586621680144676"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span class="annot"><a href="Unison.Runtime.Stack.html#valToBoxed"><span class="hs-identifier hs-type">valToBoxed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-744"></span><span id="valToBoxed"><span class="annot"><span class="annottext">valToBoxed :: Val -&gt; Maybe BVal
</span><a href="Unison.Runtime.Stack.html#valToBoxed"><span class="hs-identifier hs-var hs-var">valToBoxed</span></a></span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier hs-type">UnboxedVal</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe BVal
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-745"></span><span class="annot"><a href="Unison.Runtime.Stack.html#valToBoxed"><span class="hs-identifier hs-var">valToBoxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144678"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144678"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BVal -&gt; Maybe BVal
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144678"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span class="annot"><span class="hs-comment">-- | Matches a Val which is known to be boxed, and returns the closure portion.</span></span><span>
</span><span id="line-748"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-type">BoxedVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-749"></span><span class="hs-keyword">pattern</span><span> </span><span id="BoxedVal"><span id="%24mBoxedVal"><span id="%24bBoxedVal"><span class="annot"><span class="annottext">$mBoxedVal :: forall {r}. Val -&gt; (BVal -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bBoxedVal :: BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-var hs-var hs-var hs-var">BoxedVal</span></a></span></span></span></span><span> </span><span class="annot"><a href="#local-6989586621680144681"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#valToBoxed"><span class="hs-identifier hs-type">valToBoxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680144681"><span class="annot"><a href="#local-6989586621680144681"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-750"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-var">BoxedVal</span></a></span><span> </span><span id="local-6989586621680144682"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144682"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144682"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="hs-pragma">{-# COMPLETE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-pragma hs-type">UnboxedVal</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-pragma hs-type">BoxedVal</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-754"></span><span>
</span><span id="line-755"></span><span class="annot"><span class="hs-comment">-- | Lift a boxed val into an Val</span></span><span>
</span><span id="line-756"></span><span class="annot"><a href="Unison.Runtime.Stack.html#boxedVal"><span class="hs-identifier hs-type">boxedVal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-type">BVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-757"></span><span id="boxedVal"><span class="annot"><span class="annottext">boxedVal :: BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#boxedVal"><span class="hs-identifier hs-var hs-var">boxedVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="hs-keyword">type</span><span> </span><span id="USeg"><span class="annot"><a href="Unison.Runtime.Stack.html#USeg"><span class="hs-identifier hs-var">USeg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteArray</span></span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span class="hs-keyword">type</span><span> </span><span id="BVal"><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-var">BVal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span class="hs-keyword">type</span><span> </span><span id="BSeg"><span class="annot"><a href="Unison.Runtime.Stack.html#BSeg"><span class="hs-identifier hs-var">BSeg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Array</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span class="hs-keyword">type</span><span> </span><span id="Seg"><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-var">Seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#USeg"><span class="hs-identifier hs-type">USeg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BSeg"><span class="hs-identifier hs-type">BSeg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="annot"><a href="Unison.Runtime.Stack.html#alloc"><span class="hs-identifier hs-type">alloc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-768"></span><span id="alloc"><span class="annot"><span class="annottext">alloc :: IO Stack
</span><a href="Unison.Runtime.Stack.html#alloc"><span class="hs-identifier hs-var hs-var">alloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-769"></span><span>  </span><span id="local-6989586621680144683"><span class="annot"><span class="annottext">MutableByteArray RealWorld
</span><a href="#local-6989586621680144683"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO UA
forall (m :: * -&gt; *).
PrimMonad m =&gt;
Int -&gt; m (MutableByteArray (PrimState m))
</span><span class="hs-identifier hs-var">newByteArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4096</span></span><span>
</span><span id="line-770"></span><span>  </span><span id="local-6989586621680144684"><span class="annot"><span class="annottext">MutableArray RealWorld BVal
</span><a href="#local-6989586621680144684"><span class="hs-identifier hs-var">bstk</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; IO BA
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
Int -&gt; a -&gt; m (MutableArray (PrimState m) a)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">512</span></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:ap:Stack :: Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Aap%3AStack"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:fp:Stack :: Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Afp%3AStack"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:sp:Stack :: Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Asp%3AStack"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
$sel:ustk:Stack :: UA
ustk :: MutableByteArray RealWorld
</span><a href="Unison.Runtime.Stack.html#%24sel%3Austk%3AStack"><span class="hs-identifier hs-var hs-var">ustk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
$sel:bstk:Stack :: BA
bstk :: MutableArray RealWorld BVal
</span><a href="Unison.Runtime.Stack.html#%24sel%3Abstk%3AStack"><span class="hs-identifier hs-var hs-var">bstk</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-772"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#alloc"><span class="hs-pragma hs-type">alloc</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-773"></span><span>
</span><span id="line-774"></span><span class="hs-comment">{- ORMOLU_DISABLE -}</span><span>
</span><span id="line-775"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peek"><span class="hs-identifier hs-type">peek</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-776"></span><span id="peek"><span class="annot"><span class="annottext">peek :: (() :: Constraint) =&gt; Stack -&gt; IO Val
</span><a href="Unison.Runtime.Stack.html#peek"><span class="hs-identifier hs-var hs-var">peek</span></a></span></span><span> </span><span id="local-6989586621680144692"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680144692"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144693"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144693"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144694"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144694"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-777"></span><span>  </span><span class="hs-comment">-- Can't use upeek here because in stack-check mode it will assert that the stack slot is unboxed.</span><span>
</span><span id="line-778"></span><span>  </span><span id="local-6989586621680144695"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144695"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144694"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144693"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span id="local-6989586621680144696"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144696"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; IO BVal
Stack -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeek"><span class="hs-identifier hs-var">bpeek</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144692"><span class="hs-identifier hs-var">stk</span></a></span><span>
</span><span id="line-780"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144695"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144696"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peek"><span class="hs-pragma hs-type">peek</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekI"><span class="hs-identifier hs-type">peekI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-784"></span><span id="peekI"><span class="annot"><span class="annottext">peekI :: (() :: Constraint) =&gt; Stack -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#peekI"><span class="hs-identifier hs-var hs-var">peekI</span></a></span></span><span> </span><span id="local-6989586621680144701"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144701"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144702"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144702"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144703"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144703"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144703"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144702"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-789"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekI"><span class="hs-pragma hs-type">peekI</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-790"></span><span>
</span><span id="line-791"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffI"><span class="hs-identifier hs-type">peekOffI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-792"></span><span id="peekOffI"><span class="annot"><span class="annottext">peekOffI :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#peekOffI"><span class="hs-identifier hs-var hs-var">peekOffI</span></a></span></span><span> </span><span id="local-6989586621680144709"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144709"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144710"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144710"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144711"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144711"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144712"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144712"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-identifier">i</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144711"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144710"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144712"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffI"><span class="hs-pragma hs-type">peekOffI</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-798"></span><span>
</span><span id="line-799"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bpeek"><span class="hs-identifier hs-type">bpeek</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-type">BVal</span></a></span><span>
</span><span id="line-800"></span><span id="bpeek"><span class="annot"><span class="annottext">bpeek :: (() :: Constraint) =&gt; Stack -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeek"><span class="hs-identifier hs-var hs-var">bpeek</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144716"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144716"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="annot"><span class="annottext">UA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144717"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144717"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; IO BVal
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144717"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144716"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-801"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#bpeek"><span class="hs-pragma hs-type">bpeek</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span class="annot"><a href="Unison.Runtime.Stack.html#upeek"><span class="hs-identifier hs-type">upeek</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UVal"><span class="hs-identifier hs-type">UVal</span></a></span><span>
</span><span id="line-804"></span><span id="upeek"><span class="annot"><span class="annottext">upeek :: (() :: Constraint) =&gt; Stack -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#upeek"><span class="hs-identifier hs-var hs-var">upeek</span></a></span></span><span> </span><span id="local-6989586621680144722"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144722"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144723"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144723"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144724"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144724"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144724"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144723"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-809"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#upeek"><span class="hs-pragma hs-type">upeek</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOff"><span class="hs-identifier hs-type">peekOff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span>
</span><span id="line-812"></span><span id="peekOff"><span class="annot"><span class="annottext">peekOff :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO Val
</span><a href="Unison.Runtime.Stack.html#peekOff"><span class="hs-identifier hs-var hs-var">peekOff</span></a></span></span><span> </span><span id="local-6989586621680144733"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680144733"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144734"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144734"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144735"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144735"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144736"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144736"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-813"></span><span>  </span><span class="hs-comment">-- Can't use upeekOff here because in stack-check mode it will assert that the stack slot is unboxed.</span><span>
</span><span id="line-814"></span><span>  </span><span id="local-6989586621680144737"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144737"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144735"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144734"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144736"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span>  </span><span id="local-6989586621680144738"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144738"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO BVal
Stack -&gt; Int -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeekOff"><span class="hs-identifier hs-var">bpeekOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144733"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144736"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; Val
</span><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-var">Val</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144737"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144738"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-817"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOff"><span class="hs-pragma hs-type">peekOff</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bpeekOff"><span class="hs-identifier hs-type">bpeekOff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-type">BVal</span></a></span><span>
</span><span id="line-820"></span><span id="bpeekOff"><span class="annot"><span class="annottext">bpeekOff :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeekOff"><span class="hs-identifier hs-var hs-var">bpeekOff</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144743"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144743"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="annot"><span class="annottext">UA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144744"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144744"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144745"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144745"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; IO BVal
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144744"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144743"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144745"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#bpeekOff"><span class="hs-pragma hs-type">bpeekOff</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span class="annot"><a href="Unison.Runtime.Stack.html#upeekOff"><span class="hs-identifier hs-type">upeekOff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UVal"><span class="hs-identifier hs-type">UVal</span></a></span><span>
</span><span id="line-824"></span><span id="upeekOff"><span class="annot"><span class="annottext">upeekOff :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#upeekOff"><span class="hs-identifier hs-var hs-var">upeekOff</span></a></span></span><span> </span><span id="local-6989586621680144751"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144751"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144752"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144752"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144753"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144753"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144754"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144754"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-identifier">i</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144753"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144752"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144754"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#upeekOff"><span class="hs-pragma hs-type">upeekOff</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span class="annot"><a href="Unison.Runtime.Stack.html#upokeT"><span class="hs-identifier hs-type">upokeT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UVal"><span class="hs-identifier hs-type">UVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-type">BVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span id="upokeT"><span class="annot"><span class="annottext">upokeT :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#upokeT"><span class="hs-identifier hs-var hs-var">upokeT</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680144761"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680144761"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144762"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144762"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144763"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144763"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680144764"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144764"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621680144765"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144765"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-833"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; BVal -&gt; IO ()
Stack -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-var">bpoke</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144761"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144765"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-834"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144763"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144762"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144764"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-835"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#upokeT"><span class="hs-pragma hs-type">upokeT</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-836"></span><span>
</span><span id="line-837"></span><span class="annot"><a href="Unison.Runtime.Stack.html#poke"><span class="hs-identifier hs-type">poke</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-838"></span><span id="poke"><span class="annot"><span class="annottext">poke :: (() :: Constraint) =&gt; Stack -&gt; Val -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#poke"><span class="hs-identifier hs-var hs-var">poke</span></a></span></span><span> </span><span id="local-6989586621680144773"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144773"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144774"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144775"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144775"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144776"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144776"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span id="local-6989586621680144777"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144777"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680144778"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144778"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertBumped</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144775"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144774"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144777"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-843"></span><span>  </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BVal -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144776"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144774"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144778"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-844"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#poke"><span class="hs-pragma hs-type">poke</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span class="hs-comment">-- | Sometimes we get back an int from a foreign call which we want to use as a Nat.</span><span>
</span><span id="line-847"></span><span class="hs-comment">-- If we know it's positive and smaller than 2^63 then we can safely store the Int directly as a Nat without</span><span>
</span><span id="line-848"></span><span class="hs-comment">-- checks.</span><span>
</span><span id="line-849"></span><span class="annot"><a href="Unison.Runtime.Stack.html#unsafePokeIasN"><span class="hs-identifier hs-type">unsafePokeIasN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span id="unsafePokeIasN"><span class="annot"><span class="annottext">unsafePokeIasN :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#unsafePokeIasN"><span class="hs-identifier hs-var hs-var">unsafePokeIasN</span></a></span></span><span> </span><span id="local-6989586621680144781"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144781"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144782"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144782"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-851"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#upokeT"><span class="hs-identifier hs-var">upokeT</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144781"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144782"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-identifier hs-var">natTypeTag</span></a></span><span>
</span><span id="line-852"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#unsafePokeIasN"><span class="hs-pragma hs-type">unsafePokeIasN</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="hs-comment">-- | Store an unboxed tag to later match on.</span><span>
</span><span id="line-855"></span><span class="hs-comment">-- Often used to indicate the constructor of a data type that's been unpacked onto the stack,</span><span>
</span><span id="line-856"></span><span class="hs-comment">-- or some tag we're about to branch on.</span><span>
</span><span id="line-857"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeTag"><span class="hs-identifier hs-type">pokeTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span id="pokeTag"><span class="annot"><span class="annottext">pokeTag :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeTag"><span class="hs-identifier hs-var hs-var">pokeTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-859"></span><span>  </span><span class="hs-comment">-- For now we just use ints, but maybe should have a separate type for tags so we can detect if we're leaking them.</span><span>
</span><span id="line-860"></span><span>  </span><span class="annot"><span class="annottext">Stack -&gt; Int -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeI"><span class="hs-identifier hs-var">pokeI</span></a></span><span>
</span><span id="line-861"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeTag"><span class="hs-pragma hs-type">pokeTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekTag"><span class="hs-identifier hs-type">peekTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-864"></span><span id="peekTag"><span class="annot"><span class="annottext">peekTag :: (() :: Constraint) =&gt; Stack -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#peekTag"><span class="hs-identifier hs-var hs-var">peekTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; IO Int
Stack -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#peekI"><span class="hs-identifier hs-var">peekI</span></a></span><span>
</span><span id="line-865"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekTag"><span class="hs-pragma hs-type">peekTag</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekTagOff"><span class="hs-identifier hs-type">peekTagOff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-868"></span><span id="peekTagOff"><span class="annot"><span class="annottext">peekTagOff :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#peekTagOff"><span class="hs-identifier hs-var hs-var">peekTagOff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO Int
Stack -&gt; Int -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#peekOffI"><span class="hs-identifier hs-var">peekOffI</span></a></span><span>
</span><span id="line-869"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekTagOff"><span class="hs-pragma hs-type">peekTagOff</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeBool"><span class="hs-identifier hs-type">pokeBool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span id="pokeBool"><span class="annot"><span class="annottext">pokeBool :: (() :: Constraint) =&gt; Stack -&gt; Bool -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeBool"><span class="hs-identifier hs-var hs-var">pokeBool</span></a></span></span><span> </span><span id="local-6989586621680144790"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144790"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144791"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144791"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-873"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Val -&gt; IO ()
Stack -&gt; Val -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#poke"><span class="hs-identifier hs-var">poke</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144790"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">(Val -&gt; IO ()) -&gt; Val -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680144791"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="Unison.Runtime.Stack.html#trueVal"><span class="hs-identifier hs-var">trueVal</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Val
</span><a href="Unison.Runtime.Stack.html#falseVal"><span class="hs-identifier hs-var">falseVal</span></a></span><span>
</span><span id="line-874"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeBool"><span class="hs-pragma hs-type">pokeBool</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-875"></span><span>
</span><span id="line-876"></span><span class="hs-comment">-- | Store a boxed value.</span><span>
</span><span id="line-877"></span><span class="hs-comment">-- We don't bother nulling out the unboxed stack,</span><span>
</span><span id="line-878"></span><span class="hs-comment">-- it's extra work and there's nothing to garbage collect.</span><span>
</span><span id="line-879"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-type">bpoke</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-type">BVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span id="bpoke"><span class="annot"><span class="annottext">bpoke :: (() :: Constraint) =&gt; Stack -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-var hs-var">bpoke</span></a></span></span><span> </span><span id="local-6989586621680144795"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144795"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144796"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144796"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="annot"><span class="annottext">UA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144797"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144797"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144798"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144798"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertBumped</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BVal -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144797"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144796"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144798"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-885"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-pragma hs-type">bpoke</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOff"><span class="hs-identifier hs-type">pokeOff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span id="pokeOff"><span class="annot"><span class="annottext">pokeOff :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; Val -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeOff"><span class="hs-identifier hs-var hs-var">pokeOff</span></a></span></span><span> </span><span id="local-6989586621680144806"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144806"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144807"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144807"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span id="local-6989586621680144808"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144808"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680144809"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144809"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-889"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-var">bpokeOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144806"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144807"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144809"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-890"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stack -&gt; UA
</span><a href="Unison.Runtime.Stack.html#%24sel%3Austk%3AStack"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144806"><span class="hs-identifier hs-var">stk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Asp%3AStack"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144806"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144807"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144808"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-891"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOff"><span class="hs-pragma hs-type">pokeOff</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span class="annot"><a href="Unison.Runtime.Stack.html#upokeOffT"><span class="hs-identifier hs-type">upokeOffT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#UVal"><span class="hs-identifier hs-type">UVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-type">BVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-894"></span><span id="upokeOffT"><span class="annot"><span class="annottext">upokeOffT :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#upokeOffT"><span class="hs-identifier hs-var hs-var">upokeOffT</span></a></span></span><span> </span><span id="local-6989586621680144817"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144817"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680144818"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144818"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144819"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144819"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680144820"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144820"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-895"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-var">bpokeOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144817"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144818"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144820"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-896"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stack -&gt; UA
</span><a href="Unison.Runtime.Stack.html#%24sel%3Austk%3AStack"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144817"><span class="hs-identifier hs-var">stk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#%24sel%3Asp%3AStack"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144817"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144818"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144819"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-897"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#upokeOffT"><span class="hs-pragma hs-type">upokeOffT</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-898"></span><span>
</span><span id="line-899"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-type">bpokeOff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#DebugCallStack"><span class="hs-identifier hs-type">DebugCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Off"><span class="hs-identifier hs-type">Off</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BVal"><span class="hs-identifier hs-type">BVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span id="bpokeOff"><span class="annot"><span class="annottext">bpokeOff :: (() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-var hs-var">bpokeOff</span></a></span></span><span> </span><span id="local-6989586621680144825"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144825"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144826"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144826"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="annot"><span class="annottext">UA
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144827"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144827"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144828"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144828"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144829"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144829"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertBumped</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-identifier">i</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BVal -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144827"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144826"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144828"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680144829"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-905"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-pragma hs-type">bpokeOff</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span class="annot"><span class="hs-comment">-- | Eats up arguments</span></span><span>
</span><span id="line-908"></span><span class="annot"><a href="Unison.Runtime.Stack.html#grab"><span class="hs-identifier hs-type">grab</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span id="grab"><span class="annot"><span class="annottext">grab :: Stack -&gt; Int -&gt; IO (Seg, Stack)
</span><a href="Unison.Runtime.Stack.html#grab"><span class="hs-identifier hs-var hs-var">grab</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144830"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144831"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144831"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144832"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144832"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144833"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144833"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144834"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144834"><span class="hs-identifier hs-var">sze</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-910"></span><span>  </span><span id="local-6989586621680144835"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144835"><span class="hs-identifier hs-var">uSeg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteArray
</span><a href="#local-6989586621680144836"><span class="hs-identifier hs-var">ugrab</span></a></span><span>
</span><span id="line-911"></span><span>  </span><span id="local-6989586621680144837"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144837"><span class="hs-identifier hs-var">bSeg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO BSeg
</span><a href="#local-6989586621680144838"><span class="hs-identifier hs-var">bgrab</span></a></span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144835"><span class="hs-identifier hs-var">uSeg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144837"><span class="hs-identifier hs-var">bSeg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144834"><span class="hs-identifier hs-var">sze</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144834"><span class="hs-identifier hs-var">sze</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144831"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144834"><span class="hs-identifier hs-var">sze</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144832"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144833"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-914"></span><span>    </span><span id="local-6989586621680144836"><span class="annot"><span class="annottext">ugrab :: IO ByteArray
</span><a href="#local-6989586621680144836"><span class="hs-identifier hs-var hs-var">ugrab</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-915"></span><span>      </span><span id="local-6989586621680144839"><span class="annot"><span class="annottext">MutableByteArray RealWorld
</span><a href="#local-6989586621680144839"><span class="hs-identifier hs-var">mut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO UA
forall (m :: * -&gt; *).
PrimMonad m =&gt;
Int -&gt; m (MutableByteArray (PrimState m))
</span><span class="hs-identifier hs-var">newByteArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144840"><span class="hs-identifier hs-var">bsz</span></a></span><span>
</span><span id="line-916"></span><span>      </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; UA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *).
(() :: Constraint, PrimMonad m) =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; MutableByteArray (PrimState m) -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableByteArray"><span class="hs-identifier hs-var">copyMutableByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144839"><span class="hs-identifier hs-var">mut</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144832"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144841"><span class="hs-identifier hs-var">bfp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144840"><span class="hs-identifier hs-var">bsz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144840"><span class="hs-identifier hs-var">bsz</span></a></span><span>
</span><span id="line-917"></span><span>      </span><span id="local-6989586621680144842"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144842"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; IO ByteArray
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m) -&gt; m ByteArray
</span><span class="hs-identifier hs-var">unsafeFreezeByteArray</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144839"><span class="hs-identifier hs-var">mut</span></a></span><span>
</span><span id="line-918"></span><span>      </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; UA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *).
(() :: Constraint, PrimMonad m) =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; MutableByteArray (PrimState m) -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#moveByteArray"><span class="hs-identifier hs-var">moveByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144832"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144841"><span class="hs-identifier hs-var">bfp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144840"><span class="hs-identifier hs-var">bsz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144832"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144841"><span class="hs-identifier hs-var">bfp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144844"><span class="hs-identifier hs-var">fsz</span></a></span><span>
</span><span id="line-919"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144842"><span class="hs-identifier hs-var">seg</span></a></span><span>
</span><span id="line-920"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-921"></span><span>        </span><span id="local-6989586621680144840"><span class="annot"><span class="annottext">bsz :: Int
</span><a href="#local-6989586621680144840"><span class="hs-identifier hs-var hs-var">bsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144834"><span class="hs-identifier hs-var">sze</span></a></span><span>
</span><span id="line-922"></span><span>        </span><span id="local-6989586621680144841"><span class="annot"><span class="annottext">bfp :: Int
</span><a href="#local-6989586621680144841"><span class="hs-identifier hs-var hs-var">bfp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-923"></span><span>        </span><span id="local-6989586621680144844"><span class="annot"><span class="annottext">fsz :: Int
</span><a href="#local-6989586621680144844"><span class="hs-identifier hs-var hs-var">fsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144831"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-924"></span><span>    </span><span id="local-6989586621680144838"><span class="annot"><span class="annottext">bgrab :: IO BSeg
</span><a href="#local-6989586621680144838"><span class="hs-identifier hs-var hs-var">bgrab</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-925"></span><span>      </span><span id="local-6989586621680144845"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144845"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal -&gt; IO BSeg
BA -&gt; IO BSeg
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
MutableArray (PrimState m) a -&gt; m (Array a)
</span><span class="hs-identifier hs-var">unsafeFreezeArray</span></span><span> </span><span class="annot"><span class="annottext">(MutableArray RealWorld BVal -&gt; IO BSeg)
-&gt; IO (MutableArray RealWorld BVal) -&gt; IO BSeg
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; Int -&gt; IO BA
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; Int -&gt; m (MutableArray (PrimState m) a)
</span><a href="Unison.Runtime.Array.html#cloneMutableArray"><span class="hs-identifier hs-var">cloneMutableArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144833"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144834"><span class="hs-identifier hs-var">sze</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144834"><span class="hs-identifier hs-var">sze</span></a></span><span>
</span><span id="line-926"></span><span>      </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; MutableArray (PrimState m) a -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableArray"><span class="hs-identifier hs-var">copyMutableArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144833"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144834"><span class="hs-identifier hs-var">sze</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144833"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144849"><span class="hs-identifier hs-var">fsz</span></a></span><span>
</span><span id="line-927"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144845"><span class="hs-identifier hs-var">seg</span></a></span><span>
</span><span id="line-928"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-929"></span><span>        </span><span id="local-6989586621680144849"><span class="annot"><span class="annottext">fsz :: Int
</span><a href="#local-6989586621680144849"><span class="hs-identifier hs-var hs-var">fsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144831"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144830"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-930"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#grab"><span class="hs-pragma hs-type">grab</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span class="annot"><a href="Unison.Runtime.Stack.html#ensure"><span class="hs-identifier hs-type">ensure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-933"></span><span id="ensure"><span class="annot"><span class="annottext">ensure :: Stack -&gt; Int -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#ensure"><span class="hs-identifier hs-var hs-var">ensure</span></a></span></span><span> </span><span id="local-6989586621680144850"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680144850"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144851"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144851"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144852"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144852"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144853"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144853"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144854"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144854"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144855"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144855"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144856"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144856"><span class="hs-identifier hs-var">sze</span></a></span></span><span>
</span><span id="line-934"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144856"><span class="hs-identifier hs-var">sze</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144850"><span class="hs-identifier hs-var">stk</span></a></span><span>
</span><span id="line-935"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144853"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144856"><span class="hs-identifier hs-var">sze</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144858"><span class="hs-identifier hs-var">bsz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144850"><span class="hs-identifier hs-var">stk</span></a></span><span>
</span><span id="line-936"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-937"></span><span>      </span><span id="local-6989586621680144859"><span class="annot"><span class="annottext">MutableArray RealWorld BVal
</span><a href="#local-6989586621680144859"><span class="hs-identifier hs-var">bstk'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; IO BA
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
Int -&gt; a -&gt; m (MutableArray (PrimState m) a)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144858"><span class="hs-identifier hs-var">bsz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144860"><span class="hs-identifier hs-var">bext</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span>
</span><span id="line-938"></span><span>      </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; MutableArray (PrimState m) a -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableArray"><span class="hs-identifier hs-var">copyMutableArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144859"><span class="hs-identifier hs-var">bstk'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144855"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144853"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span>      </span><span id="local-6989586621680144861"><span class="annot"><span class="annottext">MutableByteArray RealWorld
</span><a href="#local-6989586621680144861"><span class="hs-identifier hs-var">ustk'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO UA
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; m (MutableByteArray (PrimState m))
</span><span class="hs-identifier hs-var">resizeMutableByteArray</span></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144854"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144863"><span class="hs-identifier hs-var">usz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144864"><span class="hs-identifier hs-var">uext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-940"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144851"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144852"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144853"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144861"><span class="hs-identifier hs-var">ustk'</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144859"><span class="hs-identifier hs-var">bstk'</span></a></span><span>
</span><span id="line-941"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-942"></span><span>    </span><span id="local-6989586621680144863"><span class="annot"><span class="annottext">usz :: Int
</span><a href="#local-6989586621680144863"><span class="hs-identifier hs-var hs-var">usz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld -&gt; Int
forall s. MutableByteArray s -&gt; Int
</span><span class="hs-identifier hs-var">sizeofMutableByteArray</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144854"><span class="hs-identifier hs-var">ustk</span></a></span><span>
</span><span id="line-943"></span><span>    </span><span id="local-6989586621680144858"><span class="annot"><span class="annottext">bsz :: Int
</span><a href="#local-6989586621680144858"><span class="hs-identifier hs-var hs-var">bsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal -&gt; Int
forall s a. MutableArray s a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofMutableArray</span></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144855"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-944"></span><span>    </span><span id="local-6989586621680144860"><span class="annot"><span class="annottext">bext :: Int
</span><a href="#local-6989586621680144860"><span class="hs-identifier hs-var hs-var">bext</span></a></span></span><span>
</span><span id="line-945"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144856"><span class="hs-identifier hs-var">sze</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1280</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144856"><span class="hs-identifier hs-var">sze</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">512</span></span><span>
</span><span id="line-946"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1280</span></span><span>
</span><span id="line-947"></span><span>    </span><span id="local-6989586621680144864"><span class="annot"><span class="annottext">uext :: Int
</span><a href="#local-6989586621680144864"><span class="hs-identifier hs-var hs-var">uext</span></a></span></span><span>
</span><span id="line-948"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144856"><span class="hs-identifier hs-var">sze</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10240</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144856"><span class="hs-identifier hs-var">sze</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4096</span></span><span>
</span><span id="line-949"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10240</span></span><span>
</span><span id="line-950"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#ensure"><span class="hs-pragma hs-type">ensure</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bump"><span class="hs-identifier hs-type">bump</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-953"></span><span id="bump"><span class="annot"><span class="annottext">bump :: Stack -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#bump"><span class="hs-identifier hs-var hs-var">bump</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144868"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144868"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144869"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144869"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144870"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144870"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144871"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144871"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144872"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144872"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680144873"><span class="annot"><span class="annottext">stk' :: Stack
</span><a href="#local-6989586621680144873"><span class="hs-identifier hs-var hs-var">stk'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144868"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144869"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144870"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144871"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144872"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">pokeSentinelOff</span><span> </span><span class="hs-identifier">stk'</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144873"><span class="hs-identifier hs-var">stk'</span></a></span><span>
</span><span id="line-959"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#bump"><span class="hs-pragma hs-type">bump</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bumpn"><span class="hs-identifier hs-type">bumpn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-962"></span><span id="bumpn"><span class="annot"><span class="annottext">bumpn :: Stack -&gt; Int -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#bumpn"><span class="hs-identifier hs-var hs-var">bumpn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144874"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144874"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144875"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144875"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144876"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144876"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144877"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144877"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144878"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144878"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144879"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144879"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-963"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680144880"><span class="annot"><span class="annottext">stk' :: Stack
</span><a href="#local-6989586621680144880"><span class="hs-identifier hs-var hs-var">stk'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144874"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144875"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144876"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144879"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144877"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144878"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">for_</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-identifier">n</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">]</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-966"></span><span>    </span><span class="hs-identifier">pokeSentinelOff</span><span> </span><span class="hs-identifier">stk'</span><span> </span><span class="hs-identifier">i</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144880"><span class="hs-identifier hs-var">stk'</span></a></span><span>
</span><span id="line-969"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#bumpn"><span class="hs-pragma hs-type">bumpn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span class="annot"><a href="Unison.Runtime.Stack.html#duplicate"><span class="hs-identifier hs-type">duplicate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-972"></span><span id="duplicate"><span class="annot"><span class="annottext">duplicate :: Stack -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#duplicate"><span class="hs-identifier hs-var hs-var">duplicate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144881"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144881"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144882"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144882"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144883"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144883"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144884"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144884"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144885"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144885"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-973"></span><span>  </span><span id="local-6989586621680144886"><span class="annot"><span class="annottext">MutableByteArray RealWorld
</span><a href="#local-6989586621680144886"><span class="hs-identifier hs-var">ustk'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MutableByteArray RealWorld)
</span><a href="#local-6989586621680144887"><span class="hs-identifier hs-var">dupUStk</span></a></span><span>
</span><span id="line-974"></span><span>  </span><span id="local-6989586621680144888"><span class="annot"><span class="annottext">MutableArray RealWorld BVal
</span><a href="#local-6989586621680144888"><span class="hs-identifier hs-var">bstk'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MutableArray RealWorld BVal)
IO BA
</span><a href="#local-6989586621680144889"><span class="hs-identifier hs-var">dupBStk</span></a></span><span>
</span><span id="line-975"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144881"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144882"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144883"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144886"><span class="hs-identifier hs-var">ustk'</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144888"><span class="hs-identifier hs-var">bstk'</span></a></span><span>
</span><span id="line-976"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-977"></span><span>    </span><span id="local-6989586621680144887"><span class="annot"><span class="annottext">dupUStk :: IO (MutableByteArray RealWorld)
</span><a href="#local-6989586621680144887"><span class="hs-identifier hs-var hs-var">dupUStk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-978"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680144890"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621680144890"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld -&gt; Int
forall s. MutableByteArray s -&gt; Int
</span><span class="hs-identifier hs-var">sizeofMutableByteArray</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144884"><span class="hs-identifier hs-var">ustk</span></a></span><span>
</span><span id="line-979"></span><span>      </span><span id="local-6989586621680144891"><span class="annot"><span class="annottext">MutableByteArray RealWorld
</span><a href="#local-6989586621680144891"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO UA
forall (m :: * -&gt; *).
PrimMonad m =&gt;
Int -&gt; m (MutableByteArray (PrimState m))
</span><span class="hs-identifier hs-var">newByteArray</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144890"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-980"></span><span>      </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; UA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *).
(() :: Constraint, PrimMonad m) =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; MutableByteArray (PrimState m) -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableByteArray"><span class="hs-identifier hs-var">copyMutableByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144891"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144884"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144890"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-981"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
</span><a href="#local-6989586621680144891"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-982"></span><span>    </span><span id="local-6989586621680144889"><span class="annot"><span class="annottext">dupBStk :: IO BA
</span><a href="#local-6989586621680144889"><span class="hs-identifier hs-var hs-var">dupBStk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-983"></span><span>      </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; Int -&gt; IO BA
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; Int -&gt; m (MutableArray (PrimState m) a)
</span><a href="Unison.Runtime.Array.html#cloneMutableArray"><span class="hs-identifier hs-var">cloneMutableArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144885"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MutableArray RealWorld BVal -&gt; Int
forall s a. MutableArray s a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofMutableArray</span></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144885"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#duplicate"><span class="hs-pragma hs-type">duplicate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span class="annot"><a href="Unison.Runtime.Stack.html#discardFrame"><span class="hs-identifier hs-type">discardFrame</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-987"></span><span id="discardFrame"><span class="annot"><span class="annottext">discardFrame :: Stack -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#discardFrame"><span class="hs-identifier hs-var hs-var">discardFrame</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144892"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144892"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144893"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144893"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144894"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144894"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144895"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144895"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; IO Stack) -&gt; Stack -&gt; IO Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144892"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144893"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144893"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144894"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144895"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-988"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#discardFrame"><span class="hs-pragma hs-type">discardFrame</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-989"></span><span>
</span><span id="line-990"></span><span class="annot"><a href="Unison.Runtime.Stack.html#saveFrame"><span class="hs-identifier hs-type">saveFrame</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span id="saveFrame"><span class="annot"><span class="annottext">saveFrame :: Stack -&gt; IO (Stack, Int, Int)
</span><a href="Unison.Runtime.Stack.html#saveFrame"><span class="hs-identifier hs-var hs-var">saveFrame</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144896"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144896"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144897"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144897"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144898"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144898"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144899"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144899"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144900"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144900"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Stack, Int, Int) -&gt; IO (Stack, Int, Int)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144898"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144898"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144898"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144899"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144900"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144898"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144897"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144897"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144896"><span class="hs-identifier hs-var">ap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-992"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#saveFrame"><span class="hs-pragma hs-type">saveFrame</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span class="annot"><a href="Unison.Runtime.Stack.html#saveArgs"><span class="hs-identifier hs-type">saveArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span id="saveArgs"><span class="annot"><span class="annottext">saveArgs :: Stack -&gt; IO (Stack, Int)
</span><a href="Unison.Runtime.Stack.html#saveArgs"><span class="hs-identifier hs-var hs-var">saveArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144901"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144901"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144902"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144902"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144903"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144903"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144904"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144904"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144905"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144905"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Stack, Int) -&gt; IO (Stack, Int)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144902"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144902"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144903"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144904"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144905"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144902"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144901"><span class="hs-identifier hs-var">ap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-996"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#saveArgs"><span class="hs-pragma hs-type">saveArgs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-997"></span><span>
</span><span id="line-998"></span><span class="annot"><a href="Unison.Runtime.Stack.html#restoreFrame"><span class="hs-identifier hs-type">restoreFrame</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-999"></span><span id="restoreFrame"><span class="annot"><span class="annottext">restoreFrame :: Stack -&gt; Int -&gt; Int -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#restoreFrame"><span class="hs-identifier hs-var hs-var">restoreFrame</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144906"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144906"><span class="hs-identifier hs-var">fp0</span></a></span></span><span> </span><span id="local-6989586621680144907"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144907"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144908"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144908"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144909"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144909"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144910"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144910"><span class="hs-identifier hs-var">fsz</span></a></span></span><span> </span><span id="local-6989586621680144911"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144911"><span class="hs-identifier hs-var">asz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; IO Stack) -&gt; Stack -&gt; IO Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144912"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144913"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144907"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144908"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144909"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-1000"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1001"></span><span>    </span><span id="local-6989586621680144913"><span class="annot"><span class="annottext">fp :: Int
</span><a href="#local-6989586621680144913"><span class="hs-identifier hs-var hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144906"><span class="hs-identifier hs-var">fp0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144910"><span class="hs-identifier hs-var">fsz</span></a></span><span>
</span><span id="line-1002"></span><span>    </span><span id="local-6989586621680144912"><span class="annot"><span class="annottext">ap :: Int
</span><a href="#local-6989586621680144912"><span class="hs-identifier hs-var hs-var">ap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144913"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144911"><span class="hs-identifier hs-var">asz</span></a></span><span>
</span><span id="line-1003"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#restoreFrame"><span class="hs-pragma hs-type">restoreFrame</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span class="annot"><a href="Unison.Runtime.Stack.html#prepareArgs"><span class="hs-identifier hs-type">prepareArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#Args%27"><span class="hs-identifier hs-type">Args'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-1006"></span><span id="prepareArgs"><span class="annot"><span class="annottext">prepareArgs :: Stack -&gt; Args' -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#prepareArgs"><span class="hs-identifier hs-var hs-var">prepareArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144914"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144914"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144915"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144915"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144916"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144916"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144917"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144917"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144918"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144918"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1007"></span><span>  </span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgR"><span class="hs-identifier hs-type">ArgR</span></a></span><span> </span><span id="local-6989586621680144919"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144919"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680144920"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144920"><span class="hs-identifier hs-var">l</span></a></span></span><span>
</span><span id="line-1008"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144915"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144920"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144919"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144916"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1009"></span><span>        </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; IO Stack) -&gt; Stack -&gt; IO Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144914"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144916"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144919"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144916"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144919"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144917"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144918"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-1010"></span><span>  </span><span id="local-6989586621680144921"><span class="annot"><span class="annottext">Args'
</span><a href="#local-6989586621680144921"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1011"></span><span>    </span><span id="local-6989586621680144922"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144922"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Arrs -&gt; Int -&gt; Arrs -&gt; Int -&gt; Args' -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#argOnto"><span class="hs-identifier hs-var">argOnto</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144917"><span class="hs-identifier hs-var">ustk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144918"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144916"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144917"><span class="hs-identifier hs-var">ustk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144918"><span class="hs-identifier hs-var">bstk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144915"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Args'
</span><a href="#local-6989586621680144921"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1012"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144914"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144922"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144922"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144917"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144918"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-1013"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#prepareArgs"><span class="hs-pragma hs-type">prepareArgs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span class="annot"><a href="Unison.Runtime.Stack.html#acceptArgs"><span class="hs-identifier hs-type">acceptArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-1016"></span><span id="acceptArgs"><span class="annot"><span class="annottext">acceptArgs :: Stack -&gt; Int -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#acceptArgs"><span class="hs-identifier hs-var hs-var">acceptArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144923"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144923"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144924"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144924"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144925"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144925"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144926"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144926"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144927"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144927"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144928"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144928"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; IO Stack) -&gt; Stack -&gt; IO Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144923"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144924"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144928"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144925"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144926"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144927"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-1017"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#acceptArgs"><span class="hs-pragma hs-type">acceptArgs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1018"></span><span>
</span><span id="line-1019"></span><span class="annot"><a href="Unison.Runtime.Stack.html#frameArgs"><span class="hs-identifier hs-type">frameArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-1020"></span><span id="frameArgs"><span class="annot"><span class="annottext">frameArgs :: Stack -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#frameArgs"><span class="hs-identifier hs-var hs-var">frameArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144929"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144929"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144930"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144930"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144931"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144931"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144932"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144932"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; IO Stack) -&gt; Stack -&gt; IO Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144929"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144929"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144930"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144931"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144932"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-1021"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#frameArgs"><span class="hs-pragma hs-type">frameArgs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span class="annot"><a href="Unison.Runtime.Stack.html#augSeg"><span class="hs-identifier hs-type">augSeg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Augment"><span class="hs-identifier hs-type">Augment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Runtime.MCode.html#Args%27"><span class="hs-identifier hs-type">Args'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span>
</span><span id="line-1024"></span><span id="augSeg"><span class="annot"><span class="annottext">augSeg :: Augment -&gt; Stack -&gt; Seg -&gt; Maybe Args' -&gt; IO Seg
</span><a href="Unison.Runtime.Stack.html#augSeg"><span class="hs-identifier hs-var hs-var">augSeg</span></a></span></span><span> </span><span id="local-6989586621680144933"><span class="annot"><span class="annottext">Augment
</span><a href="#local-6989586621680144933"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144934"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144934"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144935"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144935"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144936"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144936"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144937"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144937"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144938"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144938"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144939"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144939"><span class="hs-identifier hs-var">useg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144940"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144940"><span class="hs-identifier hs-var">bseg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144941"><span class="annot"><span class="annottext">Maybe Args'
</span><a href="#local-6989586621680144941"><span class="hs-identifier hs-var">margs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1025"></span><span>  </span><span id="local-6989586621680144942"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144942"><span class="hs-identifier hs-var">useg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ByteArray
</span><a href="#local-6989586621680144943"><span class="hs-identifier hs-var">unboxedSeg</span></a></span><span>
</span><span id="line-1026"></span><span>  </span><span id="local-6989586621680144944"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144944"><span class="hs-identifier hs-var">bseg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO BSeg
</span><a href="#local-6989586621680144945"><span class="hs-identifier hs-var">boxedSeg</span></a></span><span>
</span><span id="line-1027"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144942"><span class="hs-identifier hs-var">useg'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144944"><span class="hs-identifier hs-var">bseg'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1028"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1029"></span><span>    </span><span id="local-6989586621680144946"><span class="annot"><span class="annottext">bpsz :: Int
</span><a href="#local-6989586621680144946"><span class="hs-identifier hs-var hs-var">bpsz</span></a></span></span><span>
</span><span id="line-1030"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Augment
</span><a href="Unison.Runtime.Stack.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Augment
</span><a href="#local-6989586621680144933"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1031"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144935"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144934"><span class="hs-identifier hs-var">ap</span></a></span><span>
</span><span id="line-1032"></span><span>    </span><span id="local-6989586621680144943"><span class="annot"><span class="annottext">unboxedSeg :: IO ByteArray
</span><a href="#local-6989586621680144943"><span class="hs-identifier hs-var hs-var">unboxedSeg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1033"></span><span>      </span><span id="local-6989586621680144947"><span class="annot"><span class="annottext">MutableByteArray RealWorld
</span><a href="#local-6989586621680144947"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO UA
forall (m :: * -&gt; *).
PrimMonad m =&gt;
Int -&gt; m (MutableByteArray (PrimState m))
</span><span class="hs-identifier hs-var">newByteArray</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO UA) -&gt; Int -&gt; IO UA
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144948"><span class="hs-identifier hs-var">ssz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144949"><span class="hs-identifier hs-var">upsz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144950"><span class="hs-identifier hs-var">asz</span></a></span><span>
</span><span id="line-1034"></span><span>      </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *).
(() :: Constraint, PrimMonad m) =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyByteArray"><span class="hs-identifier hs-var">copyByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144947"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144952"><span class="hs-identifier hs-var">soff</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144939"><span class="hs-identifier hs-var">useg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144948"><span class="hs-identifier hs-var">ssz</span></a></span><span>
</span><span id="line-1035"></span><span>      </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; UA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *).
(() :: Constraint, PrimMonad m) =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; MutableByteArray (PrimState m) -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableByteArray"><span class="hs-identifier hs-var">copyMutableByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144947"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144937"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144934"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144949"><span class="hs-identifier hs-var">upsz</span></a></span><span>
</span><span id="line-1036"></span><span>      </span><span class="annot"><span class="annottext">Maybe Args' -&gt; (Args' -&gt; IO Int) -&gt; IO ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Args'
</span><a href="#local-6989586621680144941"><span class="hs-identifier hs-var">margs</span></a></span><span> </span><span class="annot"><span class="annottext">((Args' -&gt; IO Int) -&gt; IO ()) -&gt; (Args' -&gt; IO Int) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; UA -&gt; Int -&gt; Args' -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#uargOnto"><span class="hs-identifier hs-var">uargOnto</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144937"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144936"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144947"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144954"><span class="hs-identifier hs-var">poff</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144946"><span class="hs-identifier hs-var">bpsz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>      </span><span class="annot"><span class="annottext">UA -&gt; IO ByteArray
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m) -&gt; m ByteArray
</span><span class="hs-identifier hs-var">unsafeFreezeByteArray</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray RealWorld
UA
</span><a href="#local-6989586621680144947"><span class="hs-identifier hs-var">cop</span></a></span><span>
</span><span id="line-1038"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1039"></span><span>        </span><span id="local-6989586621680144948"><span class="annot"><span class="annottext">ssz :: Int
</span><a href="#local-6989586621680144948"><span class="hs-identifier hs-var hs-var">ssz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int
</span><span class="hs-identifier hs-var">sizeofByteArray</span></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144939"><span class="hs-identifier hs-var">useg</span></a></span><span>
</span><span id="line-1040"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680144954"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144954"><span class="hs-identifier hs-var">poff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144952"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144952"><span class="hs-identifier hs-var">soff</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1041"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Augment
</span><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-var">K</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Augment
</span><a href="#local-6989586621680144933"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144948"><span class="hs-identifier hs-var">ssz</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144949"><span class="hs-identifier hs-var">upsz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144950"><span class="hs-identifier hs-var">asz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1043"></span><span>        </span><span id="local-6989586621680144949"><span class="annot"><span class="annottext">upsz :: Int
</span><a href="#local-6989586621680144949"><span class="hs-identifier hs-var hs-var">upsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144946"><span class="hs-identifier hs-var">bpsz</span></a></span><span>
</span><span id="line-1044"></span><span>        </span><span id="local-6989586621680144950"><span class="annot"><span class="annottext">asz :: Int
</span><a href="#local-6989586621680144950"><span class="hs-identifier hs-var hs-var">asz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Args'
</span><a href="#local-6989586621680144941"><span class="hs-identifier hs-var">margs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1045"></span><span>          </span><span class="annot"><span class="annottext">Maybe Args'
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1046"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#Arg1"><span class="hs-identifier hs-type">Arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1047"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#Arg2"><span class="hs-identifier hs-type">Arg2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1048"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgN"><span class="hs-identifier hs-type">ArgN</span></a></span><span> </span><span id="local-6989586621680144955"><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144955"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimArray Int -&gt; Int
forall a. Prim a =&gt; PrimArray a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofPrimArray</span></span><span> </span><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144955"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1049"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgR"><span class="hs-identifier hs-type">ArgR</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144956"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144956"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144956"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1050"></span><span>    </span><span id="local-6989586621680144945"><span class="annot"><span class="annottext">boxedSeg :: IO BSeg
</span><a href="#local-6989586621680144945"><span class="hs-identifier hs-var hs-var">boxedSeg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1051"></span><span>      </span><span id="local-6989586621680144957"><span class="annot"><span class="annottext">MutableArray RealWorld BVal
</span><a href="#local-6989586621680144957"><span class="hs-identifier hs-var">cop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; BVal -&gt; IO BA
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
Int -&gt; a -&gt; m (MutableArray (PrimState m) a)
</span><span class="hs-identifier hs-var">newArray</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144958"><span class="hs-identifier hs-var">ssz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144946"><span class="hs-identifier hs-var">bpsz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144959"><span class="hs-identifier hs-var">asz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#BlackHole"><span class="hs-identifier hs-var">BlackHole</span></a></span><span>
</span><span id="line-1052"></span><span>      </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BSeg -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; Array a -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyArray"><span class="hs-identifier hs-var">copyArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144957"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144961"><span class="hs-identifier hs-var">soff</span></a></span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144940"><span class="hs-identifier hs-var">bseg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144958"><span class="hs-identifier hs-var">ssz</span></a></span><span>
</span><span id="line-1053"></span><span>      </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BA -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; MutableArray (PrimState m) a -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyMutableArray"><span class="hs-identifier hs-var">copyMutableArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144957"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144962"><span class="hs-identifier hs-var">poff</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144938"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144934"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144946"><span class="hs-identifier hs-var">bpsz</span></a></span><span>
</span><span id="line-1054"></span><span>      </span><span class="annot"><span class="annottext">Maybe Args' -&gt; (Args' -&gt; IO Int) -&gt; IO ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Args'
</span><a href="#local-6989586621680144941"><span class="hs-identifier hs-var">margs</span></a></span><span> </span><span class="annot"><span class="annottext">((Args' -&gt; IO Int) -&gt; IO ()) -&gt; (Args' -&gt; IO Int) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BA -&gt; Int -&gt; Args' -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#bargOnto"><span class="hs-identifier hs-var">bargOnto</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144938"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144936"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144957"><span class="hs-identifier hs-var">cop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144962"><span class="hs-identifier hs-var">poff</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144946"><span class="hs-identifier hs-var">bpsz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1055"></span><span>      </span><span class="annot"><span class="annottext">BA -&gt; IO BSeg
forall (m :: * -&gt; *) a.
PrimMonad m =&gt;
MutableArray (PrimState m) a -&gt; m (Array a)
</span><span class="hs-identifier hs-var">unsafeFreezeArray</span></span><span> </span><span class="annot"><span class="annottext">MutableArray RealWorld BVal
BA
</span><a href="#local-6989586621680144957"><span class="hs-identifier hs-var">cop</span></a></span><span>
</span><span id="line-1056"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1057"></span><span>        </span><span id="local-6989586621680144958"><span class="annot"><span class="annottext">ssz :: Int
</span><a href="#local-6989586621680144958"><span class="hs-identifier hs-var hs-var">ssz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BSeg -&gt; Int
forall a. Array a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofArray</span></span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144940"><span class="hs-identifier hs-var">bseg</span></a></span><span>
</span><span id="line-1058"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680144962"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144962"><span class="hs-identifier hs-var">poff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144961"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144961"><span class="hs-identifier hs-var">soff</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Augment
</span><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-var">K</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Augment
</span><a href="#local-6989586621680144933"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144958"><span class="hs-identifier hs-var">ssz</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144946"><span class="hs-identifier hs-var">bpsz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144959"><span class="hs-identifier hs-var">asz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1061"></span><span>        </span><span id="local-6989586621680144959"><span class="annot"><span class="annottext">asz :: Int
</span><a href="#local-6989586621680144959"><span class="hs-identifier hs-var hs-var">asz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Args'
</span><a href="#local-6989586621680144941"><span class="hs-identifier hs-var">margs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1062"></span><span>          </span><span class="annot"><span class="annottext">Maybe Args'
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1063"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#Arg1"><span class="hs-identifier hs-type">Arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1064"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#Arg2"><span class="hs-identifier hs-type">Arg2</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1065"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgN"><span class="hs-identifier hs-type">ArgN</span></a></span><span> </span><span id="local-6989586621680144964"><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144964"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimArray Int -&gt; Int
forall a. Prim a =&gt; PrimArray a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofPrimArray</span></span><span> </span><span class="annot"><span class="annottext">PrimArray Int
</span><a href="#local-6989586621680144964"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1066"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#ArgR"><span class="hs-identifier hs-type">ArgR</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144965"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144965"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144965"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1067"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#augSeg"><span class="hs-pragma hs-type">augSeg</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1068"></span><span>
</span><span id="line-1069"></span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpSeg"><span class="hs-identifier hs-type">dumpSeg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Dump"><span class="hs-identifier hs-type">Dump</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-1070"></span><span id="dumpSeg"><span class="annot"><span class="annottext">dumpSeg :: Stack -&gt; Seg -&gt; Dump -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#dumpSeg"><span class="hs-identifier hs-var hs-var">dumpSeg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144966"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144966"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144967"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144967"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144968"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144968"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144969"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144969"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144970"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144970"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680144971"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144971"><span class="hs-identifier hs-var">useg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680144972"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144972"><span class="hs-identifier hs-var">bseg</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144973"><span class="annot"><span class="annottext">Dump
</span><a href="#local-6989586621680144973"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1071"></span><span>  </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680144974"><span class="hs-identifier hs-var">dumpUSeg</span></a></span><span>
</span><span id="line-1072"></span><span>  </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621680144975"><span class="hs-identifier hs-var">dumpBSeg</span></a></span><span>
</span><span id="line-1073"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144976"><span class="hs-identifier hs-var">ap'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144977"><span class="hs-identifier hs-var">fp'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144978"><span class="hs-identifier hs-var">sp'</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144969"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144970"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-1074"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1075"></span><span>    </span><span id="local-6989586621680144979"><span class="annot"><span class="annottext">sz :: Int
</span><a href="#local-6989586621680144979"><span class="hs-identifier hs-var hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BSeg -&gt; Int
forall a. Array a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofArray</span></span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144972"><span class="hs-identifier hs-var">bseg</span></a></span><span>
</span><span id="line-1076"></span><span>    </span><span id="local-6989586621680144978"><span class="annot"><span class="annottext">sp' :: Int
</span><a href="#local-6989586621680144978"><span class="hs-identifier hs-var hs-var">sp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144968"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144979"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-1077"></span><span>    </span><span id="local-6989586621680144977"><span class="annot"><span class="annottext">fp' :: Int
</span><a href="#local-6989586621680144977"><span class="hs-identifier hs-var hs-var">fp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Dump -&gt; Int
</span><a href="Unison.Runtime.Stack.html#dumpFP"><span class="hs-identifier hs-var">dumpFP</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144967"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144979"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Dump
</span><a href="#local-6989586621680144973"><span class="hs-identifier hs-var">mode</span></a></span><span>
</span><span id="line-1078"></span><span>    </span><span id="local-6989586621680144976"><span class="annot"><span class="annottext">ap' :: Int
</span><a href="#local-6989586621680144976"><span class="hs-identifier hs-var hs-var">ap'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Dump -&gt; Int
</span><a href="Unison.Runtime.Stack.html#dumpAP"><span class="hs-identifier hs-var">dumpAP</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144966"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144967"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144979"><span class="hs-identifier hs-var">sz</span></a></span><span> </span><span class="annot"><span class="annottext">Dump
</span><a href="#local-6989586621680144973"><span class="hs-identifier hs-var">mode</span></a></span><span>
</span><span id="line-1079"></span><span>    </span><span id="local-6989586621680144974"><span class="annot"><span class="annottext">dumpUSeg :: IO ()
</span><a href="#local-6989586621680144974"><span class="hs-identifier hs-var hs-var">dumpUSeg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1080"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680144980"><span class="annot"><span class="annottext">ssz :: Int
</span><a href="#local-6989586621680144980"><span class="hs-identifier hs-var hs-var">ssz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int
</span><span class="hs-identifier hs-var">sizeofByteArray</span></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144971"><span class="hs-identifier hs-var">useg</span></a></span><span>
</span><span id="line-1081"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680144981"><span class="annot"><span class="annottext">bsp :: Int
</span><a href="#local-6989586621680144981"><span class="hs-identifier hs-var hs-var">bsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Unison.Runtime.Stack.html#bytes"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144968"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1082"></span><span>      </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *).
(() :: Constraint, PrimMonad m) =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyByteArray"><span class="hs-identifier hs-var">copyByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144969"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144981"><span class="hs-identifier hs-var">bsp</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680144971"><span class="hs-identifier hs-var">useg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144980"><span class="hs-identifier hs-var">ssz</span></a></span><span>
</span><span id="line-1083"></span><span>    </span><span id="local-6989586621680144975"><span class="annot"><span class="annottext">dumpBSeg :: IO ()
</span><a href="#local-6989586621680144975"><span class="hs-identifier hs-var hs-var">dumpBSeg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1084"></span><span>      </span><span class="annot"><span class="annottext">BA -&gt; Int -&gt; BSeg -&gt; Int -&gt; Int -&gt; IO ()
forall (m :: * -&gt; *) a.
(() :: Constraint, PrimMonad m) =&gt;
MutableArray (PrimState m) a
-&gt; Int -&gt; Array a -&gt; Int -&gt; Int -&gt; m ()
</span><a href="Unison.Runtime.Array.html#copyArray"><span class="hs-identifier hs-var">copyArray</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144970"><span class="hs-identifier hs-var">bstk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144968"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680144972"><span class="hs-identifier hs-var">bseg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144979"><span class="hs-identifier hs-var">sz</span></a></span><span>
</span><span id="line-1085"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#dumpSeg"><span class="hs-pragma hs-type">dumpSeg</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span class="annot"><a href="Unison.Runtime.Stack.html#adjustArgs"><span class="hs-identifier hs-type">adjustArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span>
</span><span id="line-1088"></span><span id="adjustArgs"><span class="annot"><span class="annottext">adjustArgs :: Stack -&gt; Int -&gt; IO Stack
</span><a href="Unison.Runtime.Stack.html#adjustArgs"><span class="hs-identifier hs-var hs-var">adjustArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144982"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144982"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144983"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144983"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144984"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144984"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144985"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144985"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span id="local-6989586621680144986"><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144986"><span class="hs-identifier hs-var">bstk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680144987"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144987"><span class="hs-identifier hs-var">sz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; IO Stack
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Stack -&gt; IO Stack) -&gt; Stack -&gt; IO Stack
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; UA -&gt; BA -&gt; Stack
</span><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-var">Stack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144982"><span class="hs-identifier hs-var">ap</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144987"><span class="hs-identifier hs-var">sz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144983"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144984"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144985"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">BA
</span><a href="#local-6989586621680144986"><span class="hs-identifier hs-var">bstk</span></a></span><span>
</span><span id="line-1089"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#adjustArgs"><span class="hs-pragma hs-type">adjustArgs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1090"></span><span>
</span><span id="line-1091"></span><span class="annot"><a href="Unison.Runtime.Stack.html#fsize"><span class="hs-identifier hs-type">fsize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span>
</span><span id="line-1092"></span><span id="fsize"><span class="annot"><span class="annottext">fsize :: Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#fsize"><span class="hs-identifier hs-var hs-var">fsize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144988"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144988"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621680144989"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144989"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="annot"><span class="annottext">UA
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144989"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144988"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-1093"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#fsize"><span class="hs-pragma hs-type">fsize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span class="annot"><a href="Unison.Runtime.Stack.html#asize"><span class="hs-identifier hs-type">asize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#SZ"><span class="hs-identifier hs-type">SZ</span></a></span><span>
</span><span id="line-1096"></span><span id="asize"><span class="annot"><span class="annottext">asize :: Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#asize"><span class="hs-identifier hs-var hs-var">asize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span id="local-6989586621680144990"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144990"><span class="hs-identifier hs-var">ap</span></a></span></span><span> </span><span id="local-6989586621680144991"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144991"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">UA
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144991"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144990"><span class="hs-identifier hs-var">ap</span></a></span><span>
</span><span id="line-1097"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#asize"><span class="hs-pragma hs-type">asize</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekN"><span class="hs-identifier hs-type">peekN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1100"></span><span id="peekN"><span class="annot"><span class="annottext">peekN :: Stack -&gt; IO Word64
</span><a href="Unison.Runtime.Stack.html#peekN"><span class="hs-identifier hs-var hs-var">peekN</span></a></span></span><span> </span><span id="local-6989586621680144992"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144992"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144993"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144993"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144994"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144994"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Word64
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144994"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144993"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-1105"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekN"><span class="hs-pragma hs-type">peekN</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1106"></span><span>
</span><span id="line-1107"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekD"><span class="hs-identifier hs-type">peekD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-1108"></span><span id="peekD"><span class="annot"><span class="annottext">peekD :: Stack -&gt; IO Double
</span><a href="Unison.Runtime.Stack.html#peekD"><span class="hs-identifier hs-var hs-var">peekD</span></a></span></span><span> </span><span id="local-6989586621680144995"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680144995"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680144996"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144996"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680144997"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144997"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-number">0</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Double
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680144997"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680144996"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-1113"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekD"><span class="hs-pragma hs-type">peekD</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1114"></span><span>
</span><span id="line-1115"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekC"><span class="hs-identifier hs-type">peekC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-1116"></span><span id="peekC"><span class="annot"><span class="annottext">peekC :: Stack -&gt; IO Char
</span><a href="Unison.Runtime.Stack.html#peekC"><span class="hs-identifier hs-var hs-var">peekC</span></a></span></span><span> </span><span id="local-6989586621680144998"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144998"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1117"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">Char.chr</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Char) -&gt; IO Int -&gt; IO Char
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; IO Int
Stack -&gt; IO Int
</span><a href="Unison.Runtime.Stack.html#peekI"><span class="hs-identifier hs-var">peekI</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680144998"><span class="hs-identifier hs-var">stk</span></a></span><span>
</span><span id="line-1118"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekC"><span class="hs-pragma hs-type">peekC</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1119"></span><span>
</span><span id="line-1120"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffN"><span class="hs-identifier hs-type">peekOffN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-1121"></span><span id="peekOffN"><span class="annot"><span class="annottext">peekOffN :: Stack -&gt; Int -&gt; IO Word64
</span><a href="Unison.Runtime.Stack.html#peekOffN"><span class="hs-identifier hs-var hs-var">peekOffN</span></a></span></span><span> </span><span id="local-6989586621680145000"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680145000"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145001"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145001"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145002"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145002"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145003"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145003"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-identifier">i</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Word64
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145002"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145001"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145003"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1126"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffN"><span class="hs-pragma hs-type">peekOffN</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1127"></span><span>
</span><span id="line-1128"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffD"><span class="hs-identifier hs-type">peekOffD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-1129"></span><span id="peekOffD"><span class="annot"><span class="annottext">peekOffD :: Stack -&gt; Int -&gt; IO Double
</span><a href="Unison.Runtime.Stack.html#peekOffD"><span class="hs-identifier hs-var hs-var">peekOffD</span></a></span></span><span> </span><span id="local-6989586621680145004"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680145004"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145005"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145005"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145006"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145006"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145007"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145007"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-identifier">i</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Double
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145006"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145005"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145007"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffD"><span class="hs-pragma hs-type">peekOffD</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1135"></span><span>
</span><span id="line-1136"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffC"><span class="hs-identifier hs-type">peekOffC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-1137"></span><span id="peekOffC"><span class="annot"><span class="annottext">peekOffC :: Stack -&gt; Int -&gt; IO Char
</span><a href="Unison.Runtime.Stack.html#peekOffC"><span class="hs-identifier hs-var hs-var">peekOffC</span></a></span></span><span> </span><span id="local-6989586621680145008"><span class="annot"><span class="annottext">_stk :: Stack
</span><a href="#local-6989586621680145008"><span class="hs-identifier hs-var">_stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145009"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145009"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145010"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145010"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145011"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145011"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#ifdef STACK_CHECK
</span><span>  </span><span class="hs-identifier">assertUnboxed</span><span> </span><span class="hs-identifier">_stk</span><span> </span><span class="hs-identifier">i</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Char
</span><span class="hs-identifier hs-var">Char.chr</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Char) -&gt; IO Int -&gt; IO Char
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; IO Int
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; m a
</span><a href="Unison.Runtime.Array.html#readByteArray"><span class="hs-identifier hs-var">readByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145010"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145009"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145011"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1142"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffC"><span class="hs-pragma hs-type">peekOffC</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1143"></span><span>
</span><span id="line-1144"></span><span class="hs-comment">{- ORMOLU_ENABLE -}</span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeN"><span class="hs-identifier hs-type">pokeN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span id="pokeN"><span class="annot"><span class="annottext">pokeN :: Stack -&gt; Word64 -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeN"><span class="hs-identifier hs-var hs-var">pokeN</span></a></span></span><span> </span><span id="local-6989586621680145012"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680145012"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145013"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145013"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145014"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145014"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145015"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680145015"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1148"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; BVal -&gt; IO ()
Stack -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-var">bpoke</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145012"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-identifier hs-var">natTypeTag</span></a></span><span>
</span><span id="line-1149"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Word64 -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145014"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145013"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680145015"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1150"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeN"><span class="hs-pragma hs-type">pokeN</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeD"><span class="hs-identifier hs-type">pokeD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1153"></span><span id="pokeD"><span class="annot"><span class="annottext">pokeD :: Stack -&gt; Double -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeD"><span class="hs-identifier hs-var hs-var">pokeD</span></a></span></span><span> </span><span id="local-6989586621680145016"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680145016"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145017"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145017"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145018"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145018"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145019"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680145019"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1154"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; BVal -&gt; IO ()
Stack -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-var">bpoke</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145016"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#floatTypeTag"><span class="hs-identifier hs-var">floatTypeTag</span></a></span><span>
</span><span id="line-1155"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Double -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145018"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145017"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680145019"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1156"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeD"><span class="hs-pragma hs-type">pokeD</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1157"></span><span>
</span><span id="line-1158"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeC"><span class="hs-identifier hs-type">pokeC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span id="pokeC"><span class="annot"><span class="annottext">pokeC :: Stack -&gt; Char -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeC"><span class="hs-identifier hs-var hs-var">pokeC</span></a></span></span><span> </span><span id="local-6989586621680145020"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680145020"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145021"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145021"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145022"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145022"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145023"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680145023"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1160"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; BVal -&gt; IO ()
Stack -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-var">bpoke</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145020"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#charTypeTag"><span class="hs-identifier hs-var">charTypeTag</span></a></span><span>
</span><span id="line-1161"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145022"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145021"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">Char.ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680145023"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1162"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeC"><span class="hs-pragma hs-type">pokeC</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1163"></span><span>
</span><span id="line-1164"></span><span class="annot"><span class="hs-comment">-- | Note: This is for poking an unboxed value that has the UNISON type 'int', not just any unboxed data.</span></span><span>
</span><span id="line-1165"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeI"><span class="hs-identifier hs-type">pokeI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1166"></span><span id="pokeI"><span class="annot"><span class="annottext">pokeI :: Stack -&gt; Int -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeI"><span class="hs-identifier hs-var hs-var">pokeI</span></a></span></span><span> </span><span id="local-6989586621680145024"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680145024"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145025"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145025"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145026"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145026"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145027"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145027"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1167"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; BVal -&gt; IO ()
Stack -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-var">bpoke</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145024"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#intTypeTag"><span class="hs-identifier hs-var">intTypeTag</span></a></span><span>
</span><span id="line-1168"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145026"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145025"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145027"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1169"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeI"><span class="hs-pragma hs-type">pokeI</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1170"></span><span>
</span><span id="line-1171"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeByte"><span class="hs-identifier hs-type">pokeByte</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span id="pokeByte"><span class="annot"><span class="annottext">pokeByte :: Stack -&gt; Word8 -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeByte"><span class="hs-identifier hs-var hs-var">pokeByte</span></a></span></span><span> </span><span id="local-6989586621680145028"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145028"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145029"><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680145029"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1173"></span><span>  </span><span class="hs-comment">-- NOTE: currently we just store bytes as Word64s, but we should have a separate type runtime type tag for them.</span><span>
</span><span id="line-1174"></span><span>  </span><span class="annot"><span class="annottext">Stack -&gt; Word64 -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeN"><span class="hs-identifier hs-var">pokeN</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145028"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Word64
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><a href="#local-6989586621680145029"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeByte"><span class="hs-pragma hs-type">pokeByte</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1176"></span><span>
</span><span id="line-1177"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffN"><span class="hs-identifier hs-type">pokeOffN</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1178"></span><span id="pokeOffN"><span class="annot"><span class="annottext">pokeOffN :: Stack -&gt; Int -&gt; Word64 -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeOffN"><span class="hs-identifier hs-var hs-var">pokeOffN</span></a></span></span><span> </span><span id="local-6989586621680145030"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680145030"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145031"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145031"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145032"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145032"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145033"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145033"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680145034"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680145034"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1179"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-var">bpokeOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145030"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145033"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#natTypeTag"><span class="hs-identifier hs-var">natTypeTag</span></a></span><span>
</span><span id="line-1180"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Word64 -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145032"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145031"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145033"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621680145034"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1181"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffN"><span class="hs-pragma hs-type">pokeOffN</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffD"><span class="hs-identifier hs-type">pokeOffD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1184"></span><span id="pokeOffD"><span class="annot"><span class="annottext">pokeOffD :: Stack -&gt; Int -&gt; Double -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeOffD"><span class="hs-identifier hs-var hs-var">pokeOffD</span></a></span></span><span> </span><span id="local-6989586621680145035"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680145035"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145036"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145036"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145037"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145037"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145038"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145038"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680145039"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680145039"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1185"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-var">bpokeOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145035"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145038"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#floatTypeTag"><span class="hs-identifier hs-var">floatTypeTag</span></a></span><span>
</span><span id="line-1186"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Double -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145037"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145036"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145038"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680145039"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-1187"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffD"><span class="hs-pragma hs-type">pokeOffD</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1188"></span><span>
</span><span id="line-1189"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffI"><span class="hs-identifier hs-type">pokeOffI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1190"></span><span id="pokeOffI"><span class="annot"><span class="annottext">pokeOffI :: Stack -&gt; Int -&gt; Int -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeOffI"><span class="hs-identifier hs-var hs-var">pokeOffI</span></a></span></span><span> </span><span id="local-6989586621680145040"><span class="annot"><span class="annottext">stk :: Stack
</span><a href="#local-6989586621680145040"><span class="hs-identifier hs-var">stk</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145041"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145041"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621680145042"><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145042"><span class="hs-identifier hs-var">ustk</span></a></span></span><span> </span><span class="annot"><span class="annottext">BA
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680145043"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145043"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680145044"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145044"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1191"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-var">bpokeOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145040"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145043"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#intTypeTag"><span class="hs-identifier hs-var">intTypeTag</span></a></span><span>
</span><span id="line-1192"></span><span>  </span><span class="annot"><span class="annottext">UA -&gt; Int -&gt; Int -&gt; IO ()
forall a (m :: * -&gt; *).
(() :: Constraint, PrimMonad m, Prim a) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="Unison.Runtime.Array.html#writeByteArray"><span class="hs-identifier hs-var">writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">UA
</span><a href="#local-6989586621680145042"><span class="hs-identifier hs-var">ustk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145041"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145043"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145044"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1193"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffI"><span class="hs-pragma hs-type">pokeOffI</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1194"></span><span>
</span><span id="line-1195"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffC"><span class="hs-identifier hs-type">pokeOffC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1196"></span><span id="pokeOffC"><span class="annot"><span class="annottext">pokeOffC :: Stack -&gt; Int -&gt; Char -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeOffC"><span class="hs-identifier hs-var hs-var">pokeOffC</span></a></span></span><span> </span><span id="local-6989586621680145045"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145045"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145046"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145046"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680145047"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680145047"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1197"></span><span>  </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#upokeOffT"><span class="hs-identifier hs-var">upokeOffT</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145045"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145046"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Int
</span><span class="hs-identifier hs-var">Char.ord</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680145047"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="Unison.Runtime.Stack.html#charTypeTag"><span class="hs-identifier hs-var">charTypeTag</span></a></span><span>
</span><span id="line-1198"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffC"><span class="hs-pragma hs-type">pokeOffC</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span id="local-6989586621680143249"><span class="annot"><a href="Unison.Runtime.Stack.html#pokeBi"><span class="hs-identifier hs-type">pokeBi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Foreign.html#BuiltinForeign"><span class="hs-identifier hs-type">BuiltinForeign</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680143249"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680143249"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1201"></span><span id="pokeBi"><span class="annot"><span class="annottext">pokeBi :: forall b. BuiltinForeign b =&gt; Stack -&gt; b -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeBi"><span class="hs-identifier hs-var hs-var">pokeBi</span></a></span></span><span> </span><span id="local-6989586621680145051"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145051"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145052"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680145052"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; BVal -&gt; IO ()
Stack -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-var">bpoke</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145051"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Foreign -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier hs-var">Foreign</span></a></span><span> </span><span class="annot"><span class="annottext">(Foreign -&gt; BVal) -&gt; Foreign -&gt; BVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Foreign
forall f. BuiltinForeign f =&gt; f -&gt; Foreign
</span><a href="Unison.Runtime.Foreign.html#wrapBuiltin"><span class="hs-identifier hs-var">wrapBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680145052"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1202"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeBi"><span class="hs-pragma hs-type">pokeBi</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span id="local-6989586621680143252"><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffBi"><span class="hs-identifier hs-type">pokeOffBi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Foreign.html#BuiltinForeign"><span class="hs-identifier hs-type">BuiltinForeign</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680143252"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680143252"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1205"></span><span id="pokeOffBi"><span class="annot"><span class="annottext">pokeOffBi :: forall b. BuiltinForeign b =&gt; Stack -&gt; Int -&gt; b -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeOffBi"><span class="hs-identifier hs-var hs-var">pokeOffBi</span></a></span></span><span> </span><span id="local-6989586621680145057"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145057"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145058"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145058"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680145059"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680145059"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-var">bpokeOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145057"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145058"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Foreign -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier hs-var">Foreign</span></a></span><span> </span><span class="annot"><span class="annottext">(Foreign -&gt; BVal) -&gt; Foreign -&gt; BVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Foreign
forall f. BuiltinForeign f =&gt; f -&gt; Foreign
</span><a href="Unison.Runtime.Foreign.html#wrapBuiltin"><span class="hs-identifier hs-var">wrapBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680145059"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1206"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffBi"><span class="hs-pragma hs-type">pokeOffBi</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span id="local-6989586621680143254"><span class="annot"><a href="Unison.Runtime.Stack.html#peekBi"><span class="hs-identifier hs-type">peekBi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Foreign.html#BuiltinForeign"><span class="hs-identifier hs-type">BuiltinForeign</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680143254"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680143254"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-1209"></span><span id="peekBi"><span class="annot"><span class="annottext">peekBi :: forall b. BuiltinForeign b =&gt; Stack -&gt; IO b
</span><a href="Unison.Runtime.Stack.html#peekBi"><span class="hs-identifier hs-var hs-var">peekBi</span></a></span></span><span> </span><span id="local-6989586621680145065"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145065"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Foreign -&gt; b
forall a. Foreign -&gt; a
</span><a href="Unison.Runtime.Foreign.html#unwrapForeign"><span class="hs-identifier hs-var">unwrapForeign</span></a></span><span> </span><span class="annot"><span class="annottext">(Foreign -&gt; b) -&gt; (BVal -&gt; Foreign) -&gt; BVal -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; BVal -&gt; Foreign
BVal -&gt; Foreign
</span><a href="Unison.Runtime.Stack.html#marshalToForeign"><span class="hs-identifier hs-var">marshalToForeign</span></a></span><span> </span><span class="annot"><span class="annottext">(BVal -&gt; b) -&gt; IO BVal -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; IO BVal
Stack -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeek"><span class="hs-identifier hs-var">bpeek</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145065"><span class="hs-identifier hs-var">stk</span></a></span><span>
</span><span id="line-1210"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekBi"><span class="hs-pragma hs-type">peekBi</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1211"></span><span>
</span><span id="line-1212"></span><span id="local-6989586621680143256"><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffBi"><span class="hs-identifier hs-type">peekOffBi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Foreign.html#BuiltinForeign"><span class="hs-identifier hs-type">BuiltinForeign</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680143256"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621680143256"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-1213"></span><span id="peekOffBi"><span class="annot"><span class="annottext">peekOffBi :: forall b. BuiltinForeign b =&gt; Stack -&gt; Int -&gt; IO b
</span><a href="Unison.Runtime.Stack.html#peekOffBi"><span class="hs-identifier hs-var hs-var">peekOffBi</span></a></span></span><span> </span><span id="local-6989586621680145071"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145071"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145072"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145072"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Foreign -&gt; b
forall a. Foreign -&gt; a
</span><a href="Unison.Runtime.Foreign.html#unwrapForeign"><span class="hs-identifier hs-var">unwrapForeign</span></a></span><span> </span><span class="annot"><span class="annottext">(Foreign -&gt; b) -&gt; (BVal -&gt; Foreign) -&gt; BVal -&gt; b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; BVal -&gt; Foreign
BVal -&gt; Foreign
</span><a href="Unison.Runtime.Stack.html#marshalToForeign"><span class="hs-identifier hs-var">marshalToForeign</span></a></span><span> </span><span class="annot"><span class="annottext">(BVal -&gt; b) -&gt; IO BVal -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO BVal
Stack -&gt; Int -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeekOff"><span class="hs-identifier hs-var">bpeekOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145071"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145072"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1214"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffBi"><span class="hs-pragma hs-type">peekOffBi</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1215"></span><span>
</span><span id="line-1216"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekBool"><span class="hs-identifier hs-type">peekBool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1217"></span><span id="peekBool"><span class="annot"><span class="annottext">peekBool :: Stack -&gt; IO Bool
</span><a href="Unison.Runtime.Stack.html#peekBool"><span class="hs-identifier hs-var hs-var">peekBool</span></a></span></span><span> </span><span id="local-6989586621680145073"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145073"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1218"></span><span>  </span><span id="local-6989586621680145074"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145074"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; IO BVal
Stack -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeek"><span class="hs-identifier hs-var">bpeek</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145073"><span class="hs-identifier hs-var">stk</span></a></span><span>
</span><span id="line-1219"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145074"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1220"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-type">Enum</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145075"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680145075"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680145075"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">PackedTag -&gt; PackedTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="Unison.Runtime.TypeTags.html#falseTag"><span class="hs-identifier hs-var">TT.falseTag</span></a></span><span>
</span><span id="line-1221"></span><span>    </span><span class="annot"><span class="annottext">BVal
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;peekBool: not a boolean&quot;</span></span><span>
</span><span id="line-1222"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekBool"><span class="hs-pragma hs-type">peekBool</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffBool"><span class="hs-identifier hs-type">peekOffBool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1225"></span><span id="peekOffBool"><span class="annot"><span class="annottext">peekOffBool :: Stack -&gt; Int -&gt; IO Bool
</span><a href="Unison.Runtime.Stack.html#peekOffBool"><span class="hs-identifier hs-var hs-var">peekOffBool</span></a></span></span><span> </span><span id="local-6989586621680145077"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145077"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145078"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145078"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1226"></span><span>  </span><span id="local-6989586621680145079"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145079"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO BVal
Stack -&gt; Int -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeekOff"><span class="hs-identifier hs-var">bpeekOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145077"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145078"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1227"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145079"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1228"></span><span>    </span><span class="annot"><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-type">Enum</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145080"><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680145080"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="#local-6989586621680145080"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">PackedTag -&gt; PackedTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="Unison.Runtime.TypeTags.html#falseTag"><span class="hs-identifier hs-var">TT.falseTag</span></a></span><span>
</span><span id="line-1229"></span><span>    </span><span class="annot"><span class="annottext">BVal
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;peekOffBool: not a boolean&quot;</span></span><span>
</span><span id="line-1230"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffBool"><span class="hs-pragma hs-type">peekOffBool</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1231"></span><span>
</span><span id="line-1232"></span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffS"><span class="hs-identifier hs-type">peekOffS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#USeq"><span class="hs-identifier hs-type">USeq</span></a></span><span>
</span><span id="line-1233"></span><span id="peekOffS"><span class="annot"><span class="annottext">peekOffS :: Stack -&gt; Int -&gt; IO USeq
</span><a href="Unison.Runtime.Stack.html#peekOffS"><span class="hs-identifier hs-var hs-var">peekOffS</span></a></span></span><span> </span><span id="local-6989586621680145081"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145081"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145082"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145082"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1234"></span><span>  </span><span class="annot"><span class="annottext">Foreign -&gt; USeq
forall a. Foreign -&gt; a
</span><a href="Unison.Runtime.Foreign.html#unwrapForeign"><span class="hs-identifier hs-var">unwrapForeign</span></a></span><span> </span><span class="annot"><span class="annottext">(Foreign -&gt; USeq) -&gt; (BVal -&gt; Foreign) -&gt; BVal -&gt; USeq
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; BVal -&gt; Foreign
BVal -&gt; Foreign
</span><a href="Unison.Runtime.Stack.html#marshalToForeign"><span class="hs-identifier hs-var">marshalToForeign</span></a></span><span> </span><span class="annot"><span class="annottext">(BVal -&gt; USeq) -&gt; IO BVal -&gt; IO USeq
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO BVal
Stack -&gt; Int -&gt; IO BVal
</span><a href="Unison.Runtime.Stack.html#bpeekOff"><span class="hs-identifier hs-var">bpeekOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145081"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145082"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1235"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#peekOffS"><span class="hs-pragma hs-type">peekOffS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1236"></span><span>
</span><span id="line-1237"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeS"><span class="hs-identifier hs-type">pokeS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#USeq"><span class="hs-identifier hs-type">USeq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1238"></span><span id="pokeS"><span class="annot"><span class="annottext">pokeS :: Stack -&gt; USeq -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeS"><span class="hs-identifier hs-var hs-var">pokeS</span></a></span></span><span> </span><span id="local-6989586621680145083"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145083"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145084"><span class="annot"><span class="annottext">USeq
</span><a href="#local-6989586621680145084"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; BVal -&gt; IO ()
Stack -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpoke"><span class="hs-identifier hs-var">bpoke</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145083"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Foreign -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier hs-var">Foreign</span></a></span><span> </span><span class="annot"><span class="annottext">(Foreign -&gt; BVal) -&gt; Foreign -&gt; BVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; USeq -&gt; Foreign
forall e. Reference -&gt; e -&gt; Foreign
</span><a href="Unison.Runtime.Foreign.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">Ty.listRef</span></span><span> </span><span class="annot"><span class="annottext">USeq
</span><a href="#local-6989586621680145084"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1239"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeS"><span class="hs-pragma hs-type">pokeS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffS"><span class="hs-identifier hs-type">pokeOffS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#USeq"><span class="hs-identifier hs-type">USeq</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span id="pokeOffS"><span class="annot"><span class="annottext">pokeOffS :: Stack -&gt; Int -&gt; USeq -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#pokeOffS"><span class="hs-identifier hs-var hs-var">pokeOffS</span></a></span></span><span> </span><span id="local-6989586621680145087"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145087"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span id="local-6989586621680145088"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145088"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680145089"><span class="annot"><span class="annottext">USeq
</span><a href="#local-6989586621680145089"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; BVal -&gt; IO ()
Stack -&gt; Int -&gt; BVal -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#bpokeOff"><span class="hs-identifier hs-var">bpokeOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145087"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145088"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Foreign -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier hs-var">Foreign</span></a></span><span> </span><span class="annot"><span class="annottext">(Foreign -&gt; BVal) -&gt; Foreign -&gt; BVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; USeq -&gt; Foreign
forall e. Reference -&gt; e -&gt; Foreign
</span><a href="Unison.Runtime.Foreign.html#Wrap"><span class="hs-identifier hs-var">Wrap</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">Ty.listRef</span></span><span> </span><span class="annot"><span class="annottext">USeq
</span><a href="#local-6989586621680145089"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1243"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#pokeOffS"><span class="hs-pragma hs-type">pokeOffS</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span class="annot"><a href="Unison.Runtime.Stack.html#unull"><span class="hs-identifier hs-type">unull</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#USeg"><span class="hs-identifier hs-type">USeg</span></a></span><span>
</span><span id="line-1246"></span><span id="unull"><span class="annot"><span class="annottext">unull :: ByteArray
</span><a href="Unison.Runtime.Stack.html#unull"><span class="hs-identifier hs-var hs-var">unull</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; ByteArray
forall a. Prim a =&gt; Int -&gt; [a] -&gt; ByteArray
</span><span class="hs-identifier hs-var">byteArrayFromListN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1247"></span><span>
</span><span id="line-1248"></span><span class="annot"><a href="Unison.Runtime.Stack.html#bnull"><span class="hs-identifier hs-type">bnull</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BSeg"><span class="hs-identifier hs-type">BSeg</span></a></span><span>
</span><span id="line-1249"></span><span id="bnull"><span class="annot"><span class="annottext">bnull :: BSeg
</span><a href="Unison.Runtime.Stack.html#bnull"><span class="hs-identifier hs-var hs-var">bnull</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Item BSeg] -&gt; BSeg
forall l. IsList l =&gt; Int -&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">fromListN</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1250"></span><span>
</span><span id="line-1251"></span><span class="annot"><a href="Unison.Runtime.Stack.html#nullSeg"><span class="hs-identifier hs-type">nullSeg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span>
</span><span id="line-1252"></span><span id="nullSeg"><span class="annot"><span class="annottext">nullSeg :: Seg
</span><a href="Unison.Runtime.Stack.html#nullSeg"><span class="hs-identifier hs-var hs-var">nullSeg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray
</span><a href="Unison.Runtime.Stack.html#unull"><span class="hs-identifier hs-var">unull</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="Unison.Runtime.Stack.html#bnull"><span class="hs-identifier hs-var">bnull</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1253"></span><span>
</span><span id="line-1254"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680145092"><span id="local-6989586621680145096"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-type">K</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1255"></span><span>  </span><span id="local-6989586621680145100"><span class="annot"><span class="annottext">show :: K -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span id="local-6989586621680145101"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145101"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; K -&gt; String
</span><a href="#local-6989586621680145102"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145101"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1256"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1257"></span><span>      </span><span id="local-6989586621680145102"><span class="annot"><span class="annottext">go :: String -&gt; K -&gt; String
</span><a href="#local-6989586621680145102"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="Unison.Runtime.Stack.html#KE"><span class="hs-identifier hs-var">KE</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-1258"></span><span>      </span><span class="annot"><a href="#local-6989586621680145102"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#CB"><span class="hs-identifier hs-type">CB</span></a></span><span> </span><span class="annot"><span class="annottext">Callback
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-1259"></span><span>      </span><span class="annot"><a href="#local-6989586621680145102"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680145118"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680145118"><span class="hs-identifier hs-var">com</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Push"><span class="hs-identifier hs-type">Push</span></a></span><span> </span><span id="local-6989586621680145119"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145119"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680145120"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145120"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680145121"><span class="annot"><span class="annottext">CombIx
</span><a href="#local-6989586621680145121"><span class="hs-identifier hs-var">ci</span></a></span></span><span> </span><span id="local-6989586621680145122"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145122"><span class="hs-identifier hs-var">_g</span></a></span></span><span> </span><span id="local-6989586621680145123"><span class="annot"><span class="annottext">RSection Val
</span><a href="#local-6989586621680145123"><span class="hs-identifier hs-var">_rsect</span></a></span></span><span> </span><span id="local-6989586621680145124"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145124"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1260"></span><span>        </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680145118"><span class="hs-identifier hs-var">com</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int, CombIx) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145119"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145120"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CombIx
</span><a href="#local-6989586621680145121"><span class="hs-identifier hs-var">ci</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; K -&gt; String
</span><a href="#local-6989586621680145102"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145124"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1261"></span><span>      </span><span class="annot"><a href="#local-6989586621680145102"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680145125"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680145125"><span class="hs-identifier hs-var">com</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Mark"><span class="hs-identifier hs-type">Mark</span></a></span><span> </span><span id="local-6989586621680145126"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145126"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680145127"><span class="annot"><span class="annottext">EnumSet Word64
</span><a href="#local-6989586621680145127"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="annot"><span class="annottext">EnumMap Word64 Val
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145128"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145128"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1262"></span><span>        </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680145125"><span class="hs-identifier hs-var">com</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;M &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145126"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">EnumSet Word64 -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">EnumSet Word64
</span><a href="#local-6989586621680145127"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; K -&gt; String
</span><a href="#local-6989586621680145102"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145128"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1263"></span><span>
</span><span id="line-1264"></span><span class="annot"><a href="Unison.Runtime.Stack.html#frameView"><span class="hs-identifier hs-type">frameView</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Stack"><span class="hs-identifier hs-type">Stack</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1265"></span><span id="frameView"><span class="annot"><span class="annottext">frameView :: Stack -&gt; IO ()
</span><a href="Unison.Runtime.Stack.html#frameView"><span class="hs-identifier hs-var hs-var">frameView</span></a></span></span><span> </span><span id="local-6989586621680145129"><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145129"><span class="hs-identifier hs-var">stk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;|&quot;</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621680145131"><span class="hs-identifier hs-var">gof</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1266"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1267"></span><span>    </span><span id="local-6989586621680145132"><span class="annot"><span class="annottext">fsz :: Int
</span><a href="#local-6989586621680145132"><span class="hs-identifier hs-var hs-var">fsz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#fsize"><span class="hs-identifier hs-var">fsize</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145129"><span class="hs-identifier hs-var">stk</span></a></span><span>
</span><span id="line-1268"></span><span>    </span><span id="local-6989586621680145133"><span class="annot"><span class="annottext">asz :: Int
</span><a href="#local-6989586621680145133"><span class="hs-identifier hs-var hs-var">asz</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stack -&gt; Int
</span><a href="Unison.Runtime.Stack.html#asize"><span class="hs-identifier hs-var">asize</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145129"><span class="hs-identifier hs-var">stk</span></a></span><span>
</span><span id="line-1269"></span><span>    </span><span id="local-6989586621680145131"><span class="annot"><span class="annottext">gof :: Bool -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621680145131"><span class="hs-identifier hs-var hs-var">gof</span></a></span></span><span> </span><span id="local-6989586621680145134"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680145134"><span class="hs-identifier hs-var">delim</span></a></span></span><span> </span><span id="local-6989586621680145135"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145135"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-1270"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145135"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145132"><span class="hs-identifier hs-var">fsz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;|&quot;</span></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall a b. IO a -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621680145136"><span class="hs-identifier hs-var">goa</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1271"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1272"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680145134"><span class="hs-identifier hs-var">delim</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-1273"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (Val -&gt; String) -&gt; Val -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Val -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Val -&gt; IO ()) -&gt; IO Val -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO Val
Stack -&gt; Int -&gt; IO Val
</span><a href="Unison.Runtime.Stack.html#peekOff"><span class="hs-identifier hs-var">peekOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145129"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145135"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1274"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621680145131"><span class="hs-identifier hs-var">gof</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145135"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1275"></span><span>    </span><span id="local-6989586621680145136"><span class="annot"><span class="annottext">goa :: Bool -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621680145136"><span class="hs-identifier hs-var hs-var">goa</span></a></span></span><span> </span><span id="local-6989586621680145137"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680145137"><span class="hs-identifier hs-var">delim</span></a></span></span><span> </span><span id="local-6989586621680145138"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145138"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-1276"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145138"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145133"><span class="hs-identifier hs-var">asz</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;|..&quot;</span></span><span>
</span><span id="line-1277"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1278"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680145137"><span class="hs-identifier hs-var">delim</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-1279"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; (Val -&gt; String) -&gt; Val -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Val -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Val -&gt; IO ()) -&gt; IO Val -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(() :: Constraint) =&gt; Stack -&gt; Int -&gt; IO Val
Stack -&gt; Int -&gt; IO Val
</span><a href="Unison.Runtime.Stack.html#peekOff"><span class="hs-identifier hs-var">peekOff</span></a></span><span> </span><span class="annot"><span class="annottext">Stack
</span><a href="#local-6989586621680145129"><span class="hs-identifier hs-var">stk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145132"><span class="hs-identifier hs-var">fsz</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145138"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1280"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621680145136"><span class="hs-identifier hs-var">goa</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145138"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1281"></span><span>
</span><span id="line-1282"></span><span class="annot"><a href="Unison.Runtime.Stack.html#scount"><span class="hs-identifier hs-type">scount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Seg"><span class="hs-identifier hs-type">Seg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1283"></span><span id="scount"><span class="annot"><span class="annottext">scount :: Seg -&gt; Int
</span><a href="Unison.Runtime.Stack.html#scount"><span class="hs-identifier hs-var hs-var">scount</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteArray
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680145140"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680145140"><span class="hs-identifier hs-var">bseg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BSeg -&gt; Int
</span><a href="#local-6989586621680145141"><span class="hs-identifier hs-var">bscount</span></a></span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680145140"><span class="hs-identifier hs-var">bseg</span></a></span><span>
</span><span id="line-1284"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1285"></span><span>    </span><span class="annot"><a href="#local-6989586621680145141"><span class="hs-identifier hs-type">bscount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#BSeg"><span class="hs-identifier hs-type">BSeg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1286"></span><span>    </span><span id="local-6989586621680145141"><span class="annot"><span class="annottext">bscount :: BSeg -&gt; Int
</span><a href="#local-6989586621680145141"><span class="hs-identifier hs-var hs-var">bscount</span></a></span></span><span> </span><span id="local-6989586621680145142"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680145142"><span class="hs-identifier hs-var">seg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BSeg -&gt; Int
forall a. Array a -&gt; Int
</span><span class="hs-identifier hs-var">sizeofArray</span></span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680145142"><span class="hs-identifier hs-var">seg</span></a></span><span>
</span><span id="line-1287"></span><span>
</span><span id="line-1288"></span><span id="local-6989586621680143267"><span class="annot"><a href="Unison.Runtime.Stack.html#closureTermRefs"><span class="hs-identifier hs-type">closureTermRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621680143267"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680143267"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680143267"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1289"></span><span id="closureTermRefs"><span class="annot"><span class="annottext">closureTermRefs :: forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; BVal -&gt; m
</span><a href="Unison.Runtime.Stack.html#closureTermRefs"><span class="hs-identifier hs-var hs-var">closureTermRefs</span></a></span></span><span> </span><span id="local-6989586621680145165"><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145165"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1290"></span><span>  </span><span class="annot"><a href="Unison.Runtime.Stack.html#PAp"><span class="hs-identifier hs-type">PAp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#CIx"><span class="hs-identifier hs-type">CIx</span></a></span><span> </span><span id="local-6989586621680145166"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680145166"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GCombInfo (RComb Val)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680145167"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680145167"><span class="hs-identifier hs-var">_useg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680145168"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680145168"><span class="hs-identifier hs-var">bseg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1291"></span><span>    </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145165"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680145166"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(BVal -&gt; m) -&gt; BSeg -&gt; m
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Array a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Reference -&gt; m) -&gt; BVal -&gt; m
forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; BVal -&gt; m
</span><a href="Unison.Runtime.Stack.html#closureTermRefs"><span class="hs-identifier hs-var">closureTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145165"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680145168"><span class="hs-identifier hs-var">bseg</span></a></span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#DataC"><span class="hs-identifier hs-type">DataC</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145169"><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680145169"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1293"></span><span>    </span><span class="annot"><span class="annottext">SegList
</span><a href="#local-6989586621680145169"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="annot"><span class="annottext">SegList -&gt; (SegList -&gt; m) -&gt; m
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Val -&gt; m) -&gt; SegList -&gt; m
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1294"></span><span>      </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-type">BoxedVal</span></a></span><span> </span><span id="local-6989586621680145170"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145170"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; m) -&gt; BVal -&gt; m
forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; BVal -&gt; m
</span><a href="Unison.Runtime.Stack.html#closureTermRefs"><span class="hs-identifier hs-var">closureTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145165"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145170"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-1295"></span><span>      </span><span class="annot"><a href="Unison.Runtime.Stack.html#UnboxedVal"><span class="hs-identifier hs-type">UnboxedVal</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1296"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Captured"><span class="hs-identifier hs-type">Captured</span></a></span><span> </span><span id="local-6989586621680145171"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145171"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680145172"><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621680145172"><span class="hs-identifier hs-var">_useg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680145173"><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680145173"><span class="hs-identifier hs-var">bseg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1297"></span><span>    </span><span class="annot"><span class="annottext">(Reference -&gt; m) -&gt; K -&gt; m
forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; K -&gt; m
</span><a href="Unison.Runtime.Stack.html#contTermRefs"><span class="hs-identifier hs-var">contTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145165"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145171"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(BVal -&gt; m) -&gt; BSeg -&gt; m
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Array a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Reference -&gt; m) -&gt; BVal -&gt; m
forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; BVal -&gt; m
</span><a href="Unison.Runtime.Stack.html#closureTermRefs"><span class="hs-identifier hs-var">closureTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145165"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BSeg
</span><a href="#local-6989586621680145173"><span class="hs-identifier hs-var">bseg</span></a></span><span>
</span><span id="line-1298"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Foreign"><span class="hs-identifier hs-type">Foreign</span></a></span><span> </span><span id="local-6989586621680145175"><span class="annot"><span class="annottext">Foreign
</span><a href="#local-6989586621680145175"><span class="hs-identifier hs-var">fo</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680145176"><span class="annot"><span class="annottext">USeq
</span><a href="#local-6989586621680145176"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#USeq"><span class="hs-identifier hs-type">USeq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Foreign -&gt; Maybe USeq
forall a. Reference -&gt; Foreign -&gt; Maybe a
</span><a href="Unison.Runtime.Foreign.html#maybeUnwrapForeign"><span class="hs-identifier hs-var">maybeUnwrapForeign</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">Ty.listRef</span></span><span> </span><span class="annot"><span class="annottext">Foreign
</span><a href="#local-6989586621680145175"><span class="hs-identifier hs-var">fo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1300"></span><span>        </span><span class="annot"><span class="annottext">(Val -&gt; m) -&gt; USeq -&gt; m
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Seq a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span id="local-6989586621680145178"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680145178"><span class="hs-identifier hs-var">_i</span></a></span></span><span> </span><span id="local-6989586621680145179"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145179"><span class="hs-identifier hs-var">clos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; m) -&gt; BVal -&gt; m
forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; BVal -&gt; m
</span><a href="Unison.Runtime.Stack.html#closureTermRefs"><span class="hs-identifier hs-var">closureTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145165"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145179"><span class="hs-identifier hs-var">clos</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">USeq
</span><a href="#local-6989586621680145176"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1301"></span><span>  </span><span class="annot"><span class="annottext">BVal
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1302"></span><span>
</span><span id="line-1303"></span><span id="local-6989586621680143272"><span class="annot"><a href="Unison.Runtime.Stack.html#contTermRefs"><span class="hs-identifier hs-type">contTermRefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="#local-6989586621680143272"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680143272"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#K"><span class="hs-identifier hs-type">K</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680143272"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-1304"></span><span id="contTermRefs"><span class="annot"><span class="annottext">contTermRefs :: forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; K -&gt; m
</span><a href="Unison.Runtime.Stack.html#contTermRefs"><span class="hs-identifier hs-var hs-var">contTermRefs</span></a></span></span><span> </span><span id="local-6989586621680145192"><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145192"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Mark"><span class="hs-identifier hs-type">Mark</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EnumSet Word64
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145193"><span class="annot"><span class="annottext">EnumMap Word64 Val
</span><a href="#local-6989586621680145193"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621680145194"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145194"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1305"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">EnumMap Word64 Val
</span><a href="#local-6989586621680145193"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">EnumMap Word64 Val -&gt; (EnumMap Word64 Val -&gt; m) -&gt; m
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Val -&gt; m) -&gt; EnumMap Word64 Val -&gt; m
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; EnumMap Word64 a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1306"></span><span>      </span><span class="annot"><a href="Unison.Runtime.Stack.html#BoxedVal"><span class="hs-identifier hs-type">BoxedVal</span></a></span><span> </span><span id="local-6989586621680145195"><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145195"><span class="hs-identifier hs-var">clo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; m) -&gt; BVal -&gt; m
forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; BVal -&gt; m
</span><a href="Unison.Runtime.Stack.html#closureTermRefs"><span class="hs-identifier hs-var">closureTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145192"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">BVal
</span><a href="#local-6989586621680145195"><span class="hs-identifier hs-var">clo</span></a></span><span>
</span><span id="line-1307"></span><span>      </span><span class="annot"><span class="annottext">Val
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1308"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span>    </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; m) -&gt; K -&gt; m
forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; K -&gt; m
</span><a href="Unison.Runtime.Stack.html#contTermRefs"><span class="hs-identifier hs-var">contTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145192"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145194"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1310"></span><span class="annot"><a href="Unison.Runtime.Stack.html#contTermRefs"><span class="hs-identifier hs-var">contTermRefs</span></a></span><span> </span><span id="local-6989586621680145196"><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145196"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.Stack.html#Push"><span class="hs-identifier hs-type">Push</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Runtime.MCode.html#CIx"><span class="hs-identifier hs-type">CIx</span></a></span><span> </span><span id="local-6989586621680145197"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680145197"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">RSection Val
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680145198"><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145198"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1311"></span><span>  </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145196"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621680145197"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">m -&gt; m -&gt; m
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; m) -&gt; K -&gt; m
forall m. Monoid m =&gt; (Reference -&gt; m) -&gt; K -&gt; m
</span><a href="Unison.Runtime.Stack.html#contTermRefs"><span class="hs-identifier hs-var">contTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><a href="#local-6989586621680145196"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">K
</span><a href="#local-6989586621680145198"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-1312"></span><span class="annot"><a href="Unison.Runtime.Stack.html#contTermRefs"><span class="hs-identifier hs-var">contTermRefs</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">K
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1313"></span><span>
</span><span id="line-1314"></span><span class="annot"><a href="Unison.Runtime.Stack.html#hasNoAllocations"><span class="hs-identifier hs-type">hasNoAllocations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TI.Obligation</span></span><span>
</span><span id="line-1315"></span><span id="hasNoAllocations"><span class="annot"><span class="annottext">hasNoAllocations :: Name -&gt; Obligation
</span><a href="Unison.Runtime.Stack.html#hasNoAllocations"><span class="hs-identifier hs-var hs-var">hasNoAllocations</span></a></span></span><span> </span><span id="local-6989586621680145199"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680145199"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Property -&gt; Obligation
</span><span class="hs-identifier hs-var">TI.mkObligation</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680145199"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Property
</span><span class="hs-identifier hs-var">TI.NoAllocation</span></span><span>
</span><span id="line-1316"></span><span>
</span><span id="line-1317"></span><span class="annot"><a href="Unison.Runtime.Stack.html#unitClosure"><span class="hs-identifier hs-type">unitClosure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span>
</span><span id="line-1318"></span><span id="unitClosure"><span class="annot"><span class="annottext">unitClosure :: BVal
</span><a href="Unison.Runtime.Stack.html#unitClosure"><span class="hs-identifier hs-var hs-var">unitClosure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; PackedTag -&gt; BVal
</span><a href="Unison.Runtime.Stack.html#Enum"><span class="hs-identifier hs-var">Enum</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">Ty.unitRef</span></span><span> </span><span class="annot"><span class="annottext">PackedTag
</span><a href="Unison.Runtime.TypeTags.html#unitTag"><span class="hs-identifier hs-var">TT.unitTag</span></a></span><span>
</span><span id="line-1319"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Unison.Runtime.Stack.html#unitClosure"><span class="hs-pragma hs-type">unitClosure</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1320"></span></pre></body></html>